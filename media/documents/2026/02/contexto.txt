claude, poderia me ajudar com a estrutura desse projeto e deixando esses detalhes mais claros pra mim? n√£o consegui entender corretamente. n√£o precisa me passar codigo, mas foca na parte de desenvolvimento, como seria essa aplica√ß√£o em django da melhor forma, como seria a estrutura de mvp funcional que n√£o me desse problemas e dores de cabe√ßa no futuro conforme fosse crescendo, adicionando mais coisa, escalando e etc, como organizar tudo, melhores estruturas e padr√µes de projeto e assim vai.
9 de jan.

Vou te ajudar a estruturar isso de forma clara e profissional. Vou focar na arquitetura e organiza√ß√£o, n√£o em c√≥digo espec√≠fico.
üéØ Conceitos Fundamentais (entenda isso primeiro)
Multi-tenancy L√≥gico

Voc√™ vai ter:

    1 aplica√ß√£o Django
    1 banco de dados (inicialmente)
    M√∫ltiplas organiza√ß√µes isoladas logicamente

N√£o crie inst√¢ncias separadas. Tudo roda junto, mas os dados s√£o completamente isolados por filtros autom√°ticos.
Hierarquia de Entidades

Plataforma (voc√™ - Levi)
  ‚îî‚îÄ‚îÄ Organization (conta pagante - ex: "Escrit√≥rio Silva & Advogados")
       ‚îî‚îÄ‚îÄ Office (filiais/departamentos - ex: "Matriz SP", "Filial RJ")
            ‚îî‚îÄ‚îÄ Users (advogados, estagi√°rios, financeiro)
                 ‚îî‚îÄ‚îÄ Dados Jur√≠dicos (processos, clientes, documentos)

Regra de ouro: Tudo pertence a uma Organization e a um Office.
üìÅ Estrutura de Apps Django (MVP S√≥lido)
Apps Core (essenciais desde o in√≠cio)

    accounts - Autentica√ß√£o e usu√°rios
        User model (extendendo AbstractUser)
        Autentica√ß√£o JWT/Session
        Profile b√°sico
    organizations - Contas pagantes
        Organization model
        Configura√ß√µes da organiza√ß√£o
        Planos/billing (simples no MVP)
    offices - Escrit√≥rios/filiais
        Office model
        Relacionamento com Organization
        Configura√ß√µes por escrit√≥rio
    memberships - V√≠nculo usu√°rio-organiza√ß√£o-papel
        Membership model (a chave do sistema)
        Roles (org_admin, office_admin, lawyer, intern, finance)
        Permiss√µes por papel

Apps de Dom√≠nio Jur√≠dico

    customers - Clientes
        Pessoas f√≠sicas e jur√≠dicas
        Contatos
        Isolado por organization + office
    processes - Processos judiciais
        N√∫mero CNJ, tribunal, vara
        Fases processuais
        Partes do processo (separado - n√£o misture com customers)
    deadlines - Prazos e compromissos
        App separado (n√£o dentro de processes)
        Pode ser vinculado a processo, contrato, tarefa
        Sistema de alertas
    documents - Gest√£o documental
        Upload/storage
        Vincula√ß√£o flex√≠vel (processo, cliente, contrato)
        Versionamento b√°sico
    finance - Financeiro (simplificado no MVP)
        Honor√°rios
        Contratos de honor√°rios
        Controle b√°sico de recebimentos

Apps de Infraestrutura

    shared ou core**
        Base models abstratos
        Managers customizados
        Middleware
        Mixins de permiss√£o
        Utilities

üîë Models Cr√≠ticos (estrutura conceitual)
Membership - O Cora√ß√£o do Sistema

Membership:
  - user (FK para User)
  - organization (FK para Organization)
  - office (FK para Office, nullable)
  - role (choices: org_admin, office_admin, lawyer, etc)
  
  unique_together: (user, organization, office)

Por que isso √© genial:

    Um usu√°rio pode estar em m√∫ltiplas organiza√ß√µes
    Pode ter pap√©is diferentes em cada escrit√≥rio
    office = NULL ‚Üí Organization Admin (v√™ tudo da org)
    office = escrit√≥rio X ‚Üí v√™ s√≥ aquele escrit√≥rio

Base Model para Isolamento

Todos os models de dom√≠nio herdam de:

OrganizationScopedModel (abstract):
  - organization (FK obrigat√≥rio)
  - office (FK obrigat√≥rio)
  - created_at
  - updated_at

Benef√≠cio: Voc√™ nunca esquece de isolar dados.
üõ°Ô∏è Isolamento de Dados (a parte mais importante)
3 Camadas de Seguran√ßa

    No Model: Campos organization + office obrigat√≥rios
    No Manager: QuerySets que filtram automaticamente

   Process.objects.for_request(request)
   # Filtra automaticamente por request.organization e request.office

    No Middleware: Injeta organization/office no request

   OrganizationMiddleware:
     - Pega o usu√°rio autenticado
     - Busca o Membership ativo
     - Seta request.organization e request.office

Regra Absoluta

NUNCA fa√ßa queries sem filtrar por organization/office. Use sempre os managers customizados.
üé® Pain√©is Separados
1. Platform Admin (Django Admin nativo)

URL: /admin/

Acesso: S√≥ voc√™ e equipe t√©cnica (is_staff=True)

Models registrados:

    Organization
    Plan/Subscription
    Billing
    Logs de sistema

Models N√ÉO registrados:

    Process, Customer, Document, Deadline
    ‚ùå Voc√™ n√£o v√™ dados jur√≠dicos dos clientes

Fun√ß√£o: Opera√ß√£o da plataforma, n√£o uso jur√≠dico
2. Organization Panel (Frontend customizado)

URL: /app/ ou /dashboard/

Acesso: Clientes pagantes

Tecnologia: React/Vue + Django REST Framework (ou Django Templates se preferir)

Funcionalidades:

    Organization Admin:
        Criar/gerenciar offices
        Convidar usu√°rios
        Definir pap√©is
        Ver uso/billing
    Office Admin / Lawyers:
        CRUD de clientes
        CRUD de processos
        Gerenciar prazos
        Upload de documentos
        Financeiro

Importante: N√£o √© Django Admin customizado, √© uma aplica√ß√£o pr√≥pria.
üöÄ MVP Funcional (escopo m√≠nimo vi√°vel)
Fase 1: Funda√ß√£o Multi-tenant

    Autentica√ß√£o (JWT ou Session)
    Organization CRUD (via Django Admin)
    Office CRUD (via API/painel)
    Membership system
    Middleware de isolamento
    Managers com filtros autom√°ticos

Fase 2: Jur√≠dico B√°sico

    Customers (CRUD completo)
    Processes (CRUD + n√∫mero CNJ)
    Deadlines (CRUD + alertas simples)
    Documents (upload b√°sico)

Fase 3: Controle de Acesso

    Sistema de permiss√µes por role
    Testes de isolamento
    Auditoria b√°sica (quem fez o qu√™)

Fase 4: Financeiro B√°sico

    Contratos de honor√°rios
    Controle de recebimentos
    Vincula√ß√£o processo ‚Üí honor√°rio

‚ö†Ô∏è Erros Fatais a Evitar
‚ùå N√£o fa√ßa:

    Processos dentro de Customers
        S√£o entidades independentes
        Use relacionamento N:N atrav√©s de ProcessParty
    Prazos dentro de Processes
        Crie app deadlines separado
        Vincula√ß√£o flex√≠vel (GenericForeignKey ou campo type+id)
    Misturar Django Admin com painel do cliente
        Admin = voc√™
        Frontend pr√≥prio = cliente
    Criar inst√¢ncia Django por organiza√ß√£o
        1 app serve todos
        Isolamento √© l√≥gico, n√£o f√≠sico
    Acoplamento entre domains
        Finance n√£o deve importar de Processes
        Use eventos/signals quando necess√°rio

üìä Estrutura de Pastas Recomendada

legaltech/
‚îú‚îÄ‚îÄ config/                    # Settings, URLs, WSGI
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dev.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prod.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py
‚îÇ
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ accounts/              # Auth, User
‚îÇ   ‚îú‚îÄ‚îÄ organizations/         # Organizations
‚îÇ   ‚îú‚îÄ‚îÄ offices/               # Offices
‚îÇ   ‚îú‚îÄ‚îÄ memberships/           # User-Org-Office roles
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ customers/             # Clientes
‚îÇ   ‚îú‚îÄ‚îÄ processes/             # Processos
‚îÇ   ‚îú‚îÄ‚îÄ deadlines/             # Prazos
‚îÇ   ‚îú‚îÄ‚îÄ documents/             # Documentos
‚îÇ   ‚îú‚îÄ‚îÄ finance/               # Financeiro
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ shared/                # Base models, mixins, utils
‚îÇ       ‚îú‚îÄ‚îÄ models.py          # OrganizationScopedModel
‚îÇ       ‚îú‚îÄ‚îÄ managers.py        # Filtros autom√°ticos
‚îÇ       ‚îú‚îÄ‚îÄ middleware.py      # Organization injection
‚îÇ       ‚îî‚îÄ‚îÄ permissions.py     # DRF permissions
‚îÇ
‚îú‚îÄ‚îÄ frontend/                  # React/Vue (se usar)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ media/
‚îú‚îÄ‚îÄ templates/
‚îî‚îÄ‚îÄ manage.py

üîí Seguran√ßa e Compliance
LGPD by Design

    Voc√™ (platform admin) n√£o acessa dados jur√≠dicos
    Logs de acesso por usu√°rio
    Criptografia de dados sens√≠veis
    Backup por organiza√ß√£o

Auditoria

    Middleware registra todas as a√ß√µes
    Model: AuditLog(user, action, model, object_id, organization)

üéØ Pr√≥ximos Passos (p√≥s-MVP)
V2 - CRM Jur√≠dico

    Leads
    Funil de capta√ß√£o
    Portal do cliente

V3 - Automa√ß√£o

    Workflows por tipo de processo
    Integra√ß√£o com tribunais (PJe, e-SAJ)
    Alertas inteligentes

V4 - Analytics

    Dashboard de m√©tricas
    Relat√≥rios por advogado
    Previs√£o de √™xito

üí° Decis√µes Arquiteturais Importantes
1. Banco de Dados

    MVP: PostgreSQL √∫nico
    Futuro: Possibilidade de sharding por organization (enterprise)

2. Autentica√ß√£o

    JWT para API (mobile/SPA)
    Session para Django Admin

3. Permiss√µes

    Django Guardian (object-level)
    DRF Permissions customizadas

4. Storage

    MVP: Local storage ou S3
    Produ√ß√£o: S3 com bucket por organization

‚úÖ Checklist de Valida√ß√£o

Antes de considerar o MVP pronto:

    Usu√°rio pode estar em 2 organiza√ß√µes diferentes
    Dados de Org A s√£o invis√≠veis para Org B
    Dados de Office 1 s√£o invis√≠veis para Office 2 (mesma org)
    Voc√™ (admin) n√£o consegue ver processos/clientes
    Organization admin consegue gerenciar m√∫ltiplos offices
    Advogado comum s√≥ v√™ seu office
    Queries sem filtro de organization falham ou retornam vazio

üéì Resumo Executivo

Arquitetura: Multi-tenant l√≥gico (1 app, 1 DB, isolamento por filtro)

Hierarquia: Platform ‚Üí Organization ‚Üí Office ‚Üí Users ‚Üí Data

Chave: Membership (user + organization + office + role)

Pain√©is: Django Admin (voc√™) + Frontend pr√≥prio (clientes)

Isolamento: 3 camadas (model + manager + middleware)

MVP: Organization + Office + Membership + CRUD jur√≠dico b√°sico

Escalabilidade: Modelagem permite CRM, automa√ß√£o, IA, enterprise sem refatora√ß√£o

Quer que eu aprofunde em alguma parte espec√≠fica? (Ex: detalhamento do sistema de permiss√µes, estrat√©gia de API REST, ou fluxo de onboarding de novos clientes)

mais ou menos essa estrutura ent√£o? tem a pasta juridicflow. dentro dela rodei "django-admin startproject app .". depois, a partir dai fui rodando python manage.py startapp e o nome dos apps que voce mandou. esta certo?
9 de jan.

Quase! Mas tem alguns ajustes importantes para ficar profissional e escal√°vel:
üî¥ Problemas na estrutura atual

    Projeto chamado "app" - nome gen√©rico demais
    Apps na raiz - vai virar bagun√ßa quando crescer
    Falta organiza√ß√£o de settings
    Sem pasta shared/core

‚úÖ Estrutura Correta

juridicflow/
‚îú‚îÄ‚îÄ manage.py
‚îÇ
‚îú‚îÄ‚îÄ config/                    # ‚Üê renomear "app" para "config"
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings/              # ‚Üê dividir settings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dev.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prod.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ asgi.py
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py
‚îÇ
‚îú‚îÄ‚îÄ apps/                      # ‚Üê criar pasta apps/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ accounts/
‚îÇ   ‚îú‚îÄ‚îÄ organizations/
‚îÇ   ‚îú‚îÄ‚îÄ offices/
‚îÇ   ‚îú‚îÄ‚îÄ memberships/
‚îÇ   ‚îú‚îÄ‚îÄ customers/
‚îÇ   ‚îú‚îÄ‚îÄ processes/
‚îÇ   ‚îú‚îÄ‚îÄ deadlines/
‚îÇ   ‚îú‚îÄ‚îÄ documents/
‚îÇ   ‚îú‚îÄ‚îÄ finance/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ shared/               # ‚Üê app especial
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ models.py         # Base models abstratos
‚îÇ       ‚îú‚îÄ‚îÄ managers.py       # Managers customizados
‚îÇ       ‚îú‚îÄ‚îÄ middleware.py     # Organization middleware
‚îÇ       ‚îú‚îÄ‚îÄ permissions.py    # Permiss√µes DRF
‚îÇ       ‚îî‚îÄ‚îÄ utils.py
‚îÇ
‚îú‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ media/
‚îú‚îÄ‚îÄ templates/
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ venv/

üõ†Ô∏è Como Corrigir (passo a passo)
1. Renomear "app" para "config"

No VS Code ou terminal:
bash

mv app config

2. Criar pasta apps/
bash

mkdir apps
touch apps/__init__.py

3. Mover todos os apps para dentro de apps/
bash

mv accounts apps/
mv customers apps/
mv deadlines apps/
mv documents apps/
mv finance apps/
mv memberships apps/
mv offices apps/
mv organizations apps/
mv processes apps/
mv shared apps/

4. Ajustar INSTALLED_APPS no settings

Antes (errado):
python

INSTALLED_APPS = [
    'accounts',
    'customers',
    # ...
]

Depois (correto):
python

INSTALLED_APPS = [
    # Django
    'django.contrib.admin',
    'django.contrib.auth',
    # ...
    
    # Seus apps
    'apps.accounts',
    'apps.organizations',
    'apps.offices',
    'apps.memberships',
    'apps.customers',
    'apps.processes',
    'apps.deadlines',
    'apps.documents',
    'apps.finance',
    'apps.shared',
]

5. Ajustar config no manage.py
python

# manage.py
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings.dev')

6. Ajustar config no wsgi.py e asgi.py
python

# config/wsgi.py
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings.prod')

üìÇ Criar app shared/ corretamente

Esse app √© especial - n√£o use startapp:
bash

mkdir apps/shared
touch apps/shared/__init__.py
touch apps/shared/models.py
touch apps/shared/managers.py
touch apps/shared/middleware.py
touch apps/shared/permissions.py
touch apps/shared/utils.py

Por qu√™?

    N√£o tem views, n√£o tem admin, n√£o tem serializers
    √â s√≥ infraestrutura compartilhada

üéØ Ordem de Cria√ß√£o dos Apps (import√¢ncia)

Se voc√™ fosse fazer do zero, seria assim:
bash

# 1. Funda√ß√£o
python manage.py startapp accounts
python manage.py startapp organizations
python manage.py startapp offices
python manage.py startapp memberships

# 2. Dom√≠nio jur√≠dico
python manage.py startapp customers
python manage.py startapp processes
python manage.py startapp deadlines
python manage.py startapp documents

# 3. Financeiro
python manage.py startapp finance

# 4. Infraestrutura (criar manualmente)
mkdir apps/shared

üìù Dividir Settings (importante!)
config/settings/base.py (comum a todos)
python

# Configura√ß√µes compartilhadas
INSTALLED_APPS = [...]
MIDDLEWARE = [...]
DATABASES = {...}  # com vari√°veis de ambiente

config/settings/dev.py
python

from .base import *

DEBUG = True
ALLOWED_HOSTS = ['localhost', '127.0.0.1']

# Email de debug
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

config/settings/prod.py
python

from .base import *

DEBUG = False
ALLOWED_HOSTS = ['seudominio.com']

# Configura√ß√µes de seguran√ßa
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True

‚öôÔ∏è Ajustar manage.py para usar settings dividido
python

# manage.py
import os
import sys
from pathlib import Path

if __name__ == '__main__':
    # Usar dev por padr√£o
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings.dev')
    
    # ... resto do c√≥digo

üö® Apps que devem ter apps.py configurado

Quando voc√™ move apps para apps/, precisa ajustar:
python

# apps/accounts/apps.py
class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.accounts'  # ‚Üê adicionar apps.

Fa√ßa isso para todos os apps.
‚úÖ Checklist Final

Depois de reorganizar:

    Pasta app/ renomeada para config/
    Pasta apps/ criada
    Todos os apps dentro de apps/
    apps/__init__.py existe
    INSTALLED_APPS usa apps.nome_do_app
    apps.py de cada app tem name = 'apps.xxx'
    Settings dividido em base.py, dev.py, prod.py
    manage.py aponta para config.settings.dev
    shared/ criado manualmente (sem startapp)

üéì Por que essa estrutura?
Vantagem	Explica√ß√£o
Escal√°vel	F√°cil adicionar 20+ apps depois
Organizado	Apps separados de config
Profissional	Padr√£o usado em projetos grandes
Flex√≠vel	Settings por ambiente
Limpo	Raiz do projeto n√£o fica bagun√ßada
üí° Pr√≥ximo Passo

Depois de reorganizar, voc√™ vai:

    Criar os models base em shared/
    Configurar User customizado em accounts/
    Criar Organization e Office
    Implementar Membership

Quer que eu te mostre como criar os models base em shared/ agora?

o que seria models base? s√£o models que eu posso usar em mais de um app, por isso vou cadastrar em shared ao inves de cadastrar dentro de um app especifico, tipo customers, que pode ser usado dentro do app custormers para mostrar customers ou dentro do app finance para mostrar folhas de pagamentos, contratos de honorarios, promissorias e etc associadas a customers?
9 de jan.
Exatamente! Voc√™ entendeu perfeitamente! üéØ

Mas vou refinar um pouco o conceito porque tem 2 tipos de models que v√£o em shared/:
üì¶ O que vai em shared/models.py
1. Models Abstratos (Base Models) ‚≠ê

Esses n√£o viram tabelas no banco, s√£o s√≥ "templates" que outros models herdam.
Exemplo: OrganizationScopedModel
python

# apps/shared/models.py
from django.db import models

class OrganizationScopedModel(models.Model):
    """
    Modelo abstrato para tudo que pertence a uma organiza√ß√£o e escrit√≥rio.
    """
    organization = models.ForeignKey(
        'organizations.Organization',
        on_delete=models.CASCADE
    )
    office = models.ForeignKey(
        'offices.Office',
        on_delete=models.CASCADE
    )
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        abstract = True  # ‚Üê Isso que faz ser abstrato

Uso:
python

# apps/customers/models.py
from apps.shared.models import OrganizationScopedModel

class Customer(OrganizationScopedModel):
    name = models.CharField(max_length=255)
    document = models.CharField(max_length=20)
    # N√£o precisa repetir organization, office, created_at, updated_at

python

# apps/processes/models.py
from apps.shared.models import OrganizationScopedModel

class Process(OrganizationScopedModel):
    number = models.CharField(max_length=25)
    court = models.CharField(max_length=255)
    # Tamb√©m herda os campos automaticamente

‚úÖ Vantagem: Voc√™ n√£o repete c√≥digo e garante que todos os models tenham isolamento.
2. Models Concretos Compartilhados (mais raro)

Esses viram tabelas e s√£o usados por v√°rios apps.
Exemplo: Address (endere√ßo)
python

# apps/shared/models.py
class Address(OrganizationScopedModel):
    """
    Endere√ßo que pode ser usado por Customer, Office, etc.
    """
    street = models.CharField(max_length=255)
    number = models.CharField(max_length=10)
    city = models.CharField(max_length=100)
    state = models.CharField(max_length=2)
    zip_code = models.CharField(max_length=10)
    
    # Campos para relacionamento polim√≥rfico
    content_type = models.ForeignKey(ContentType, on_delete=models.CASCADE)
    object_id = models.PositiveIntegerField()
    content_object = GenericForeignKey('content_type', 'object_id')

Uso:

    Customer pode ter Address
    Office pode ter Address
    Process pode ter Address (local da audi√™ncia)

Mas cuidado: s√≥ crie models concretos em shared/ se realmente forem usados por 3+ apps. Se n√£o, fica no app espec√≠fico.
‚ùå O que N√ÉO vai em shared/
Customer N√ÉO vai em shared/

Por qu√™?

    Customer √© uma entidade de neg√≥cio
    Pertence ao dom√≠nio customers/
    Outros apps s√≥ importam ele, n√£o herdam

Jeito certo:
python

# apps/customers/models.py
class Customer(OrganizationScopedModel):
    name = models.CharField(max_length=255)
    # ...

python

# apps/finance/models.py
from apps.customers.models import Customer

class FeeAgreement(OrganizationScopedModel):
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    # ...

‚úÖ Voc√™ importa Customer em finance, mas ele n√£o est√° em shared.
üìã Checklist: O que vai em shared/?
Tipo	Vai em shared?	Exemplo
Models abstratos (heran√ßa)	‚úÖ SIM	OrganizationScopedModel, TimestampedModel, SoftDeleteModel
Models de infraestrutura	‚úÖ SIM	AuditLog, Notification
Models polim√≥rficos gen√©ricos	‚úÖ SIM (com cautela)	Address, Comment, Attachment
Models de dom√≠nio	‚ùå N√ÉO	Customer, Process, Deadline
Models muito espec√≠ficos	‚ùå N√ÉO	FeeAgreement, ProcessParty
üß± Estrutura Completa de shared/
python

# apps/shared/models.py

# ===== MODELS ABSTRATOS (base classes) =====

class TimestampedModel(models.Model):
    """Adiciona created_at e updated_at"""
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        abstract = True


class OrganizationScopedModel(TimestampedModel):
    """Base para tudo que pertence a organiza√ß√£o + escrit√≥rio"""
    organization = models.ForeignKey(
        'organizations.Organization',
        on_delete=models.CASCADE
    )
    office = models.ForeignKey(
        'offices.Office',
        on_delete=models.CASCADE
    )
    
    class Meta:
        abstract = True


class SoftDeleteModel(models.Model):
    """Soft delete (n√£o apaga do banco)"""
    is_deleted = models.BooleanField(default=False)
    deleted_at = models.DateTimeField(null=True, blank=True)
    
    class Meta:
        abstract = True


# ===== MODELS CONCRETOS (usados por v√°rios apps) =====

class AuditLog(models.Model):
    """Registra todas as a√ß√µes no sistema"""
    user = models.ForeignKey('accounts.User', on_delete=models.SET_NULL, null=True)
    organization = models.ForeignKey('organizations.Organization', on_delete=models.CASCADE)
    action = models.CharField(max_length=50)  # 'create', 'update', 'delete'
    model_name = models.CharField(max_length=100)
    object_id = models.PositiveIntegerField()
    changes = models.JSONField(default=dict)
    ip_address = models.GenericIPAddressField(null=True)
    timestamp = models.DateTimeField(auto_now_add=True)


class Notification(OrganizationScopedModel):
    """Notifica√ß√µes do sistema"""
    user = models.ForeignKey('accounts.User', on_delete=models.CASCADE)
    title = models.CharField(max_length=255)
    message = models.TextField()
    is_read = models.BooleanField(default=False)
    notification_type = models.CharField(max_length=50)  # 'deadline', 'process_update', etc

üéØ Exemplo Pr√°tico Completo
Cen√°rio: Customer usado em m√∫ltiplos apps
python

# apps/customers/models.py
from apps.shared.models import OrganizationScopedModel, SoftDeleteModel

class Customer(OrganizationScopedModel, SoftDeleteModel):
    name = models.CharField(max_length=255)
    document = models.CharField(max_length=20)
    email = models.EmailField()
    phone = models.CharField(max_length=20)

python

# apps/processes/models.py
from apps.shared.models import OrganizationScopedModel
from apps.customers.models import Customer

class Process(OrganizationScopedModel):
    number = models.CharField(max_length=25)
    # ...

class ProcessParty(models.Model):
    """Relacionamento N:N entre Process e Customer"""
    process = models.ForeignKey(Process, on_delete=models.CASCADE)
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    role = models.CharField(max_length=50)  # 'autor', 'r√©u', etc

python

# apps/finance/models.py
from apps.shared.models import OrganizationScopedModel
from apps.customers.models import Customer
from apps.processes.models import Process

class FeeAgreement(OrganizationScopedModel):
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    process = models.ForeignKey(Process, on_delete=models.SET_NULL, null=True)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    payment_type = models.CharField(max_length=50)  # 'monthly', 'success', etc

üß† Regra Mental Simples

Pergunta: "Esse model √© uma base/template ou uma entidade de neg√≥cio?"

    Base/template ‚Üí shared/ como abstrato
    Infraestrutura ‚Üí shared/ como concreto
    Entidade de neg√≥cio ‚Üí app espec√≠fico, outros importam

‚úÖ Resumo Executivo
Item	Local	Tipo
OrganizationScopedModel	shared/models.py	Abstrato
TimestampedModel	shared/models.py	Abstrato
SoftDeleteModel	shared/models.py	Abstrato
AuditLog	shared/models.py	Concreto
Notification	shared/models.py	Concreto
Customer	customers/models.py	Concreto
Process	processes/models.py	Concreto
Deadline	deadlines/models.py	Concreto

Golden rule:

    Heran√ßa = shared/ (abstrato)
    Importa√ß√£o = app espec√≠fico (concreto)

Agora faz sentido? Quer que eu te mostre como criar os managers customizados em shared/managers.py? (√â o pr√≥ximo passo importante)

ok ent√£o. vamos come√ßar a desenvolver. quero come√ßar pela fase 1, passo 1 ou passo 1 e 2(autentica√ß√£o e organization crud).
9 de jan.
Perfeito! Vamos come√ßar pela Fase 1 - Funda√ß√£o Multi-tenant üöÄ

Vou te guiar passo a passo, de forma pr√°tica e ordenada.
üìã Roadmap da Fase 1

‚úÖ Passo 1: User customizado (accounts)
‚úÖ Passo 2: Organization model (organizations)
‚¨ú Passo 3: Office model (offices)
‚¨ú Passo 4: Membership system (memberships)
‚¨ú Passo 5: Autentica√ß√£o JWT/Session
‚¨ú Passo 6: Django Admin para Platform

Vamos fazer Passo 1 e 2 agora (User + Organization).
üéØ PASSO 1: User Customizado
Por que customizar o User logo no in√≠cio?

‚ö†Ô∏è Regra de ouro do Django: Se voc√™ vai customizar o User, fa√ßa ANTES da primeira migration.

Depois fica muito mais dif√≠cil.
1.1 Criar o Model User
python

# apps/accounts/models.py

from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    """
    User customizado.
    No MVP, s√≥ adiciona email obrigat√≥rio.
    Depois voc√™ pode adicionar phone, avatar, etc.
    """
    email = models.EmailField(
        unique=True,
        error_messages={
            'unique': "J√° existe um usu√°rio com este email."
        }
    )
    
    # Campos que voc√™ pode adicionar depois:
    # phone = models.CharField(max_length=20, blank=True)
    # avatar = models.ImageField(upload_to='avatars/', null=True, blank=True)
    # language = models.CharField(max_length=10, default='pt-br')
    
    USERNAME_FIELD = 'email'  # Login com email ao inv√©s de username
    REQUIRED_FIELDS = ['username']  # username ainda √© obrigat√≥rio no createsuperuser
    
    class Meta:
        verbose_name = 'Usu√°rio'
        verbose_name_plural = 'Usu√°rios'
    
    def __str__(self):
        return self.email

1.2 Configurar o apps.py
python

# apps/accounts/apps.py

from django.apps import AppConfig

class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.accounts'  # ‚Üê Importante: apps.accounts
    verbose_name = 'Autentica√ß√£o e Usu√°rios'

1.3 Configurar no settings
python

# config/settings/base.py

INSTALLED_APPS = [
    # Django
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Seus apps
    'apps.accounts',
    'apps.organizations',
    'apps.offices',
    'apps.memberships',
    'apps.customers',
    'apps.processes',
    'apps.deadlines',
    'apps.documents',
    'apps.finance',
    'apps.shared',
]

# ‚≠ê CRITICAL: Informar ao Django qual √© o User model
AUTH_USER_MODEL = 'accounts.User'

1.4 Registrar no Django Admin (tempor√°rio)
python

# apps/accounts/admin.py

from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from .models import User

@admin.register(User)
class UserAdmin(BaseUserAdmin):
    """
    Admin customizado para o User.
    Por enquanto, usa o padr√£o do Django.
    """
    list_display = ['email', 'username', 'first_name', 'last_name', 'is_staff', 'is_active']
    list_filter = ['is_staff', 'is_active', 'date_joined']
    search_fields = ['email', 'username', 'first_name', 'last_name']
    ordering = ['-date_joined']
    
    # Campos que aparecem no formul√°rio de edi√ß√£o
    fieldsets = (
        (None, {'fields': ('username', 'password')}),
        ('Informa√ß√µes Pessoais', {'fields': ('first_name', 'last_name', 'email')}),
        ('Permiss√µes', {'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions')}),
        ('Datas Importantes', {'fields': ('last_login', 'date_joined')}),
    )

üéØ PASSO 2: Organization Model
2.1 Criar o Model Organization
python

# apps/organizations/models.py

from django.db import models
from django.utils.translation import gettext_lazy as _

class Organization(models.Model):
    """
    Organiza√ß√£o = conta pagante no sistema.
    Exemplo: "Escrit√≥rio Silva & Advogados Associados"
    """
    
    PLAN_CHOICES = [
        ('free', 'Gratuito'),
        ('basic', 'B√°sico'),
        ('professional', 'Profissional'),
        ('enterprise', 'Enterprise'),
    ]
    
    name = models.CharField(
        'Nome',
        max_length=255,
        help_text='Nome da organiza√ß√£o/escrit√≥rio'
    )
    
    document = models.CharField(
        'CNPJ',
        max_length=18,
        unique=True,
        help_text='CNPJ da organiza√ß√£o'
    )
    
    plan = models.CharField(
        'Plano',
        max_length=20,
        choices=PLAN_CHOICES,
        default='free'
    )
    
    is_active = models.BooleanField(
        'Ativa',
        default=True,
        help_text='Organiza√ß√£o ativa no sistema'
    )
    
    # JSON para configura√ß√µes flex√≠veis
    settings = models.JSONField(
        'Configura√ß√µes',
        default=dict,
        blank=True,
        help_text='Configura√ß√µes customizadas da organiza√ß√£o'
    )
    
    # Datas
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        verbose_name = 'Organiza√ß√£o'
        verbose_name_plural = 'Organiza√ß√µes'
        ordering = ['-created_at']
    
    def __str__(self):
        return self.name
    
    @property
    def total_offices(self):
        """Retorna quantidade de escrit√≥rios"""
        return self.offices.count()
    
    @property
    def total_users(self):
        """Retorna quantidade de usu√°rios"""
        return self.memberships.values('user').distinct().count()

2.2 Configurar apps.py
python

# apps/organizations/apps.py

from django.apps import AppConfig

class OrganizationsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.organizations'
    verbose_name = 'Organiza√ß√µes'

2.3 Registrar no Django Admin
python

# apps/organizations/admin.py

from django.contrib import admin
from .models import Organization

@admin.register(Organization)
class OrganizationAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar organiza√ß√µes.
    Este admin √© S√ì PARA VOC√ä (platform admin).
    """
    list_display = [
        'name',
        'document',
        'plan',
        'is_active',
        'total_offices',
        'total_users',
        'created_at'
    ]
    
    list_filter = ['plan', 'is_active', 'created_at']
    
    search_fields = ['name', 'document']
    
    readonly_fields = ['created_at', 'updated_at', 'total_offices', 'total_users']
    
    fieldsets = (
        ('Informa√ß√µes B√°sicas', {
            'fields': ('name', 'document')
        }),
        ('Plano e Status', {
            'fields': ('plan', 'is_active')
        }),
        ('Configura√ß√µes', {
            'fields': ('settings',),
            'classes': ('collapse',)  # Come√ßa fechado
        }),
        ('Estat√≠sticas', {
            'fields': ('total_offices', 'total_users'),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def total_offices(self, obj):
        return obj.total_offices
    total_offices.short_description = 'Escrit√≥rios'
    
    def total_users(self, obj):
        return obj.total_users
    total_users.short_description = 'Usu√°rios'

‚öôÔ∏è Configura√ß√µes Finais
Ajustar settings.py
python

# config/settings/base.py

import os
from pathlib import Path

BASE_DIR = Path(__file__).resolve().parent.parent.parent

SECRET_KEY = 'your-secret-key-here'  # ‚ö†Ô∏è Depois mova para .env

DEBUG = True

ALLOWED_HOSTS = []

# ===== APPS =====
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Seus apps
    'apps.accounts',
    'apps.organizations',
    'apps.offices',
    'apps.memberships',
    'apps.customers',
    'apps.processes',
    'apps.deadlines',
    'apps.documents',
    'apps.finance',
    'apps.shared',
]

# ===== MIDDLEWARE =====
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'config.urls'

# ===== TEMPLATES =====
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

# ===== DATABASE =====
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
        # ‚ö†Ô∏è Depois voc√™ vai mudar para PostgreSQL
    }
}

# ===== AUTH =====
AUTH_USER_MODEL = 'accounts.User'

AUTH_PASSWORD_VALIDATORS = [
    {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'},
    {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator'},
    {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator'},
    {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator'},
]

# ===== INTERNACIONALIZA√á√ÉO =====
LANGUAGE_CODE = 'pt-br'
TIME_ZONE = 'America/Sao_Paulo'
USE_I18N = True
USE_TZ = True

# ===== STATIC E MEDIA =====
STATIC_URL = 'static/'
STATIC_ROOT = BASE_DIR / 'staticfiles'

MEDIA_URL = 'media/'
MEDIA_ROOT = BASE_DIR / 'media'

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

üöÄ Executar as Migrations

Agora sim, vamos criar o banco:
bash

# 1. Criar as migrations
python manage.py makemigrations

# 2. Aplicar no banco
python manage.py migrate

# 3. Criar superuser (voc√™)
python manage.py createsuperuser
# Email: seu@email.com
# Username: admin (ou qualquer um)
# Password: ******

‚úÖ Testar no Django Admin
bash

python manage.py runserver

Acesse: http://localhost:8000/admin/

O que voc√™ deve ver:

    ‚úÖ Login com email e senha
    ‚úÖ Se√ß√£o "AUTENTICA√á√ÉO E USU√ÅRIOS" ‚Üí Users
    ‚úÖ Se√ß√£o "ORGANIZA√á√ïES" ‚Üí Organiza√ß√µes

Teste:

    Criar uma organiza√ß√£o de teste
    Preencher: nome, CNPJ, plano
    Salvar

üìä Checklist de Valida√ß√£o

    User model criado com email √∫nico
    AUTH_USER_MODEL configurado
    Organization model criado
    Migrations rodaram sem erro
    Superuser criado
    Django Admin acess√≠vel
    Consegue criar Organization no admin

üéØ Pr√≥ximos Passos

Agora que voc√™ tem User e Organization, o pr√≥ximo √©:

Passo 3: Office model (escrit√≥rios/filiais) Passo 4: Membership (v√≠nculo user-organization-office-role)

Quer continuar com o Passo 3 (Office) agora, ou prefere que eu te ajude a testar melhor o que j√° foi feito?

sei que para o organization admin, admin dos escritorios, advogados, usuarios e etc, tenho que fazer um painel proprio, talvez em react/vue, mas para o admin da aplica√ß√£o, no caso eu, posso usar jazzmin?
9 de jan.
Sim! Pode e deve usar Jazzmin! üé®

√â uma excelente escolha para o Platform Admin (voc√™).
‚úÖ Por que Jazzmin √© perfeito aqui?
Aspecto	Django Admin padr√£o	Com Jazzmin
Visual	Anos 2000	Moderno, limpo
UX	B√°sica	Intuitiva
Dashboards	N√£o tem	Tem widgets customiz√°veis
Mobile	Ruim	Responsivo
Tema escuro	N√£o	Sim
Customiza√ß√£o	CSS manual	Configura√ß√£o JSON

Importante: Jazzmin n√£o muda nada da l√≥gica, s√≥ melhora a interface do Django Admin.
üöÄ Como Instalar e Configurar
1. Instalar
bash

pip install django-jazzmin

2. Adicionar ao INSTALLED_APPS
python

# config/settings/base.py

INSTALLED_APPS = [
    'jazzmin',  # ‚≠ê ANTES de 'django.contrib.admin'
    
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Seus apps
    'apps.accounts',
    'apps.organizations',
    # ...
]

‚ö†Ô∏è CR√çTICO: jazzmin TEM QUE vir ANTES de django.contrib.admin.
3. Configura√ß√£o B√°sica (recomendada)
python

# config/settings/base.py

JAZZMIN_SETTINGS = {
    # T√≠tulo do site
    "site_title": "JuridicFlow Admin",
    "site_header": "JuridicFlow",
    "site_brand": "JuridicFlow Platform",
    
    # Logo (opcional)
    # "site_logo": "img/logo.png",
    # "site_logo_classes": "img-circle",
    
    # √çcone de boas-vindas
    "welcome_sign": "Bem-vindo ao Painel de Administra√ß√£o",
    
    # Copyright
    "copyright": "JuridicFlow - Levi",
    
    # Links no topo
    "topmenu_links": [
        {"name": "Home", "url": "admin:index", "permissions": ["auth.view_user"]},
        {"name": "Suporte", "url": "https://seusite.com/suporte", "new_window": True},
    ],
    
    # Ordem dos apps no menu lateral
    "order_with_respect_to": [
        "accounts",
        "organizations", 
        "offices",
        "memberships",
        "auth",  # Groups e Permissions do Django
    ],
    
    # √çcones personalizados para cada app
    "icons": {
        "auth": "fas fa-users-cog",
        "auth.user": "fas fa-user",
        "auth.Group": "fas fa-users",
        
        "accounts.User": "fas fa-user-circle",
        "organizations.Organization": "fas fa-building",
        "offices.Office": "fas fa-briefcase",
        "memberships.Membership": "fas fa-id-card",
    },
    
    # Tema de cores
    "default_icon_parents": "fas fa-chevron-circle-right",
    "default_icon_children": "fas fa-circle",
    
    # Mostrar √≠cones nos models
    "show_sidebar": True,
    "navigation_expanded": True,
    
    # Tema (light ou dark)
    "theme": "flatly",  # Outros: darkly, cosmo, cyborg, etc
    
    # Tema escuro autom√°tico
    "show_ui_builder": False,  # Desabilita o personalizador de tema
    
    # Links customizados no menu
    "custom_links": {
        "organizations": [{
            "name": "Relat√≥rio de Uso", 
            "url": "admin:organizations_usage_report",
            "icon": "fas fa-chart-line",
        }]
    },
    
    # Ocultar apps do Django que voc√™ n√£o usa
    "hide_apps": [],
    
    # Ocultar models espec√≠ficos
    "hide_models": [],
    
    # Bot√µes de a√ß√£o personalizados
    "changeform_format": "horizontal_tabs",  # ou "vertical_tabs", "collapsible", "carousel"
}

# UI Builder (permite customizar tema no pr√≥prio admin)
JAZZMIN_UI_TWEAKS = {
    "navbar_small_text": False,
    "footer_small_text": False,
    "body_small_text": False,
    "brand_small_text": False,
    "brand_colour": "navbar-primary",
    "accent": "accent-primary",
    "navbar": "navbar-dark",
    "no_navbar_border": False,
    "navbar_fixed": False,
    "layout_boxed": False,
    "footer_fixed": False,
    "sidebar_fixed": False,
    "sidebar": "sidebar-dark-primary",
    "sidebar_nav_small_text": False,
    "sidebar_disable_expand": False,
    "sidebar_nav_child_indent": False,
    "sidebar_nav_compact_style": False,
    "sidebar_nav_legacy_style": False,
    "sidebar_nav_flat_style": False,
    "theme": "flatly",  # Temas: darkly, flatly, cosmo, cyborg, etc
    "dark_mode_theme": "darkly",
    "button_classes": {
        "primary": "btn-primary",
        "secondary": "btn-secondary",
        "info": "btn-info",
        "warning": "btn-warning",
        "danger": "btn-danger",
        "success": "btn-success"
    }
}

üé® Configura√ß√£o Espec√≠fica para JuridicFlow

Aqui est√° uma config otimizada para o seu caso:
python

# config/settings/base.py

JAZZMIN_SETTINGS = {
    # ===== IDENTIDADE =====
    "site_title": "JuridicFlow Platform",
    "site_header": "JuridicFlow",
    "site_brand": "JuridicFlow Admin",
    "welcome_sign": "Bem-vindo ao Painel da Plataforma",
    "copyright": "JuridicFlow ¬© 2025",
    
    # ===== MENU LATERAL =====
    "show_sidebar": True,
    "navigation_expanded": True,
    
    # Ordem dos apps
    "order_with_respect_to": [
        "organizations",  # Primeiro o mais importante
        "offices",
        "memberships",
        "accounts",
    ],
    
    # ===== √çCONES =====
    "icons": {
        # Accounts
        "accounts": "fas fa-users-cog",
        "accounts.User": "fas fa-user-shield",
        
        # Organizations
        "organizations": "fas fa-building",
        "organizations.Organization": "fas fa-building",
        
        # Offices
        "offices": "fas fa-briefcase",
        "offices.Office": "fas fa-briefcase",
        
        # Memberships
        "memberships": "fas fa-id-badge",
        "memberships.Membership": "fas fa-id-card",
        
        # Django padr√£o
        "auth": "fas fa-shield-alt",
        "auth.Group": "fas fa-users",
    },
    
    # ===== CUSTOMIZA√á√ÉO =====
    "custom_css": None,
    "custom_js": None,
    "show_ui_builder": False,
    
    # ===== LINKS NO TOPO =====
    "topmenu_links": [
        {"name": "In√≠cio", "url": "admin:index", "permissions": ["auth.view_user"]},
        {"name": "Ver Site", "url": "/", "new_window": True},
    ],
    
    # ===== SEGURAN√áA =====
    # Ocultar apps que o Platform Admin n√£o deve ver
    "hide_apps": [],
    
    # Ocultar models espec√≠ficos
    "hide_models": [
        # Quando voc√™ tiver os models jur√≠dicos, adicione aqui:
        # "customers.Customer",
        # "processes.Process",
        # "deadlines.Deadline",
        # "documents.Document",
    ],
    
    # ===== TEMA =====
    "theme": "flatly",
    "dark_mode_theme": "darkly",
    
    # ===== LAYOUT =====
    "changeform_format": "horizontal_tabs",
    "changeform_format_overrides": {
        "auth.user": "collapsible",
        "auth.group": "vertical_tabs",
    },
}

üéØ O que muda visualmente?
Antes (Django Admin padr√£o)

    Interface anos 2000
    Menu lateral b√°sico
    Sem dashboard
    N√£o responsivo

Depois (com Jazzmin)

    ‚úÖ Interface moderna e limpa
    ‚úÖ Menu lateral com √≠cones
    ‚úÖ Dashboard com widgets
    ‚úÖ Responsivo (mobile)
    ‚úÖ Tema escuro
    ‚úÖ Busca melhorada
    ‚úÖ Navega√ß√£o r√°pida

üìä Dashboard Customizado (opcional)

Voc√™ pode criar widgets no dashboard:
python

# config/settings/base.py

JAZZMIN_SETTINGS = {
    # ... (config anterior)
    
    # Dashboard personalizado
    "show_sidebar": True,
    "navigation_expanded": True,
    
    # Widgets no dashboard
    "custom_links": {
        "organizations": [
            {
                "name": "Organiza√ß√µes Ativas",
                "url": "admin:organizations_organization_changelist?is_active=True",
                "icon": "fas fa-check-circle",
            },
            {
                "name": "Plano Enterprise",
                "url": "admin:organizations_organization_changelist?plan=enterprise",
                "icon": "fas fa-crown",
            }
        ]
    }
}

üîí Seguran√ßa: Ocultar Models Jur√≠dicos

IMPORTANTE: Como Platform Admin, voc√™ n√£o deve ver dados jur√≠dicos.

Quando criar os models de customers, processes, etc., adicione:
python

# config/settings/base.py

JAZZMIN_SETTINGS = {
    # ...
    
    "hide_models": [
        "customers.Customer",
        "processes.Process",
        "processes.ProcessParty",
        "deadlines.Deadline",
        "documents.Document",
        "finance.FeeAgreement",
        "finance.Invoice",
    ],
}

Assim, esses models n√£o aparecem no Django Admin, mesmo que estejam registrados.
üé® Temas Recomendados

Jazzmin usa temas do Bootswatch.

Para Admin corporativo/s√©rio:

    flatly (azul limpo - recomendado)
    cosmo (minimalista)
    lux (dourado elegante)

Para tema escuro:

    darkly (elegante)
    cyborg (tech)
    slate (profissional)

üß™ Testar
bash

# 1. Instalar
pip install django-jazzmin

# 2. Adicionar ao INSTALLED_APPS (antes do admin)

# 3. Rodar servidor
python manage.py runserver

# 4. Acessar
# http://localhost:8000/admin/

üìã Checklist Jazzmin

    pip install django-jazzmin
    Adicionar 'jazzmin' ANTES de django.contrib.admin
    Configurar JAZZMIN_SETTINGS no settings.py
    Definir √≠cones para cada app
    Ocultar models jur√≠dicos (quando criar)
    Escolher tema (flatly recomendado)
    Testar no navegador

‚öñÔ∏è Resumo: Dois Pain√©is
Painel	Tecnologia	Usu√°rios	Fun√ß√£o
Platform Admin	Django Admin + Jazzmin ‚úÖ	Voc√™ (Levi)	Gerenciar organiza√ß√µes, planos, suporte
Organization Panel	React/Vue + API	Clientes pagantes	Usar o sistema jur√≠dico
üéØ Pr√≥ximo Passo

Agora que voc√™ tem:

    ‚úÖ User customizado
    ‚úÖ Organization
    ‚úÖ Jazzmin configurado

Quer continuar com:

    Passo 3: Office model?
    ou prefere refinar o Jazzmin antes (adicionar logo, customizar mais)?

O que prefere?
bpadvogadosassociados/juridicflow

main

GITHUB

üöÄ MVP Funcional (escopo m√≠nimo vi√°vel)
Fase 1: Funda√ß√£o Multi-tenant
* Autentica√ß√£o (JWT ou Session)
* Organization CRUD (via Django Admin)
* Office CRUD (via API/painel)
* Membership system
* Middleware de isolamento
* Managers com filtros autom√°ticos
Fase 2: Jur√≠dico B√°sico
* Customers (CRUD completo)
* Processes (CRUD + n√∫mero CNJ)
* Deadlines (CRUD + alertas simples)
* Documents (upload b√°sico)
Fase 3: Controle de Acesso
* Sistema de permiss√µes por role
* Testes de isolamento
* Auditoria b√°sica (quem fez o qu√™)
Fase 4: Financeiro B√°sico
* Contratos de honor√°rios
* Controle de recebimentos
* Vincula√ß√£o processo ‚Üí honor√°rio

to usando essa lista como checklist para marcar a progress√£o do projeto. acha que a autentica√ß√£o (jwt ou session) e  o organization crud (via django admin) ja esta pronto e com tudo necessario para um mvp funcional e bom?
12 de jan.
Vamos revisar! üîç

Analisando o c√≥digo que voc√™ enviou:
‚úÖ O que est√° PRONTO
1. User Model ‚úÖ

    Email √∫nico como USERNAME_FIELD
    Herda de AbstractUser
    Configurado corretamente no settings (AUTH_USER_MODEL)
    Admin registrado

2. Organization Model ‚úÖ

    Campos essenciais (name, document, plan, is_active)
    Settings JSON para flexibilidade
    Properties para total_offices e total_users
    Admin com fieldsets organizados

3. Estrutura Geral ‚úÖ

    Apps organizados em apps/
    Jazzmin configurado
    Estrutura escal√°vel

‚ö†Ô∏è O que FALTA para um MVP funcional
1. Autentica√ß√£o - N√ÉO est√° completa

Voc√™ tem o User model, mas n√£o tem sistema de autentica√ß√£o implementado.

O que falta:

    Sistema de login/logout
    Registro de novos usu√°rios (opcional no MVP)
    Recupera√ß√£o de senha (opcional no MVP)
    Prote√ß√£o de rotas

Para o MVP m√≠nimo, voc√™ precisa de:
Op√ß√£o A: Autentica√ß√£o Session (mais simples)

Usar o sistema padr√£o do Django - j√° est√° funcionando no Django Admin.
Op√ß√£o B: JWT (para API)

Instalar Django REST Framework + SimpleJWT.

Recomenda√ß√£o para MVP:

    Use Session no Django Admin (j√° funciona)
    Adicione JWT s√≥ quando for criar a API para o painel do cliente

2. Organization CRUD - Parcialmente completo

O que voc√™ TEM:

    ‚úÖ Model
    ‚úÖ Admin registrado
    ‚úÖ Pode criar/editar/deletar pelo Django Admin

O que FALTA (cr√≠tico):

    Migrations n√£o foram criadas/aplicadas
    Testar cria√ß√£o de Organization real
    Valida√ß√£o de CNPJ

üî¥ A√á√ïES OBRIGAT√ìRIAS antes de marcar como completo
Passo 1: Criar e aplicar migrations
bash

# 1. Criar migrations
python manage.py makemigrations

# 2. Aplicar no banco
python manage.py migrate

# 3. Criar superuser
python manage.py createsuperuser

Passo 2: Testar no Django Admin
bash

python manage.py runserver

Acesse http://localhost:8000/admin/ e:

    Login com o superuser
    Criar uma Organization de teste:
        Nome: "Silva & Advogados"
        CNPJ: "12.345.678/0001-90"
        Plano: Basic
        Ativo: Sim
    Verificar:
        Organization aparece na lista
        Consegue editar
        total_offices e total_users aparecem (mesmo que 0)

Passo 3: Ajustes Recomendados (n√£o cr√≠ticos, mas importantes)
3.1 Valida√ß√£o de CNPJ
python

# apps/organizations/models.py

from django.core.exceptions import ValidationError
import re

def validate_cnpj(value):
    """Valida formato b√°sico de CNPJ"""
    cnpj = re.sub(r'[^0-9]', '', value)
    if len(cnpj) != 14:
        raise ValidationError('CNPJ deve ter 14 d√≠gitos')
    return value

class Organization(models.Model):
    # ...
    
    document = models.CharField(
        'CNPJ',
        max_length=18,
        unique=True,
        validators=[validate_cnpj],  # ‚Üê Adicionar
        help_text="CNPJ no formato XX.XXX.XXX/XXXX-XX"
    )

3.2 Verbose name nos apps

Voc√™ j√° fez em alguns, mas faltou em outros:
python

# apps/customers/apps.py
class CustomersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.customers'
    verbose_name = 'Clientes'  # ‚Üê Adicionar

# apps/offices/apps.py
class OfficesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.offices'
    verbose_name = 'Escrit√≥rios'  # ‚Üê Adicionar

# apps/memberships/apps.py
class MembershipsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.memberships'
    verbose_name = 'Membros'  # ‚Üê Adicionar

3.3 Ordena√ß√£o correta

No seu Organization model:
python

class Meta:
    verbose_name = 'Organiza√ß√£o'
    verbose_name_plural = 'Organiza√ß√µes'
    ordering = ['created_at']  # ‚Üê T√° invertido

Problema: Vai mostrar as mais antigas primeiro.

Correto:
python

ordering = ['-created_at']  # ‚Üê Mais recentes primeiro

üìã Checklist Atualizado
Fase 1.1 - Autentica√ß√£o

Para MVP m√≠nimo:

    User model criado
    AUTH_USER_MODEL configurado
    Migrations aplicadas ‚ö†Ô∏è CR√çTICO
    Superuser criado ‚ö†Ô∏è CR√çTICO
    Login no Django Admin funcionando
    (Opcional) API JWT - deixar para depois

Status: üü° 70% completo - Falta aplicar migrations e testar
Fase 1.2 - Organization CRUD

    Organization model criado
    Admin registrado com fieldsets
    Jazzmin configurado
    Migrations aplicadas ‚ö†Ô∏è CR√çTICO
    Testado cria√ß√£o de Organization real ‚ö†Ô∏è CR√çTICO
    Valida√ß√£o de CNPJ (recomendado)
    Verbose names em todos apps (cosm√©tico)

Status: üü° 80% completo - Falta testar na pr√°tica
üéØ O que fazer AGORA
Sequ√™ncia de comandos:
bash

# 1. Aplicar migrations
python manage.py makemigrations
python manage.py migrate

# 2. Criar superuser
python manage.py createsuperuser
# Email: seu@email.com
# Username: admin
# Password: (sua senha)

# 3. Rodar servidor
python manage.py runserver

# 4. Acessar admin
# http://localhost:8000/admin/
```

### **No Django Admin:**
1. Login com superuser
2. Criar uma Organization de teste
3. Verificar se tudo funciona
4. Tirar print e mandar aqui (se quiser valida√ß√£o)

---

## ‚úÖ Quando marcar como COMPLETO?

Voc√™ pode marcar **Autentica√ß√£o** e **Organization CRUD** como completos quando:

- [ ] Migrations aplicadas sem erro
- [ ] Superuser criado
- [ ] Consegue logar no Django Admin
- [ ] Consegue criar/editar/deletar Organization
- [ ] Jazzmin aparece bonito
- [ ] N√£o tem erros no console

---

## üöÄ Pr√≥ximos Passos (depois de completar isso)

Quando voc√™ conseguir **criar uma Organization real** no admin, a√≠ sim:

1. **Passo 3**: Office model
2. **Passo 4**: Membership system
3. **Passo 5**: Middleware de isolamento

---

## üìä Status Geral do Projeto
```
MVP Fase 1 - Funda√ß√£o Multi-tenant
‚îú‚îÄ‚îÄ User Model                 ‚úÖ 100%
‚îú‚îÄ‚îÄ Organization Model         üü° 80% (falta testar)
‚îú‚îÄ‚îÄ Autentica√ß√£o Session       üü° 70% (falta migrations)
‚îú‚îÄ‚îÄ Office Model               ‚¨ú 0%
‚îú‚îÄ‚îÄ Membership Model           ‚¨ú 0%
‚îî‚îÄ‚îÄ Middleware Isolamento      ‚¨ú 0%

PROGRESSO TOTAL: ~25%

üí° Minha Recomenda√ß√£o

N√ÉO marque como completo ainda.

Execute os comandos acima, teste no Django Admin, e me manda:

    Print do admin funcionando
    Print de uma Organization criada
    Se deu algum erro, cola aqui

A√≠ eu te confirmo se est√° 100% e podemos avan√ßar para Office + Membership.

Quer que eu te guie pelos comandos agora ou prefere tentar sozinho e depois me mostrar o resultado?
12 de jan.
üî¥ Problema Identificado!

O erro √© claro: "'Organization' object has no attribute 'offices'"
üéØ O Problema

No seu Organization model, voc√™ tem essa property:
python

@property
def total_offices(self):
    return self.offices.count()  # ‚Üê Tentando acessar self.offices

Mas o model Office ainda n√£o existe!

Ent√£o self.offices (o related_name do ForeignKey) n√£o est√° dispon√≠vel.
‚úÖ Solu√ß√£o Imediata (2 op√ß√µes)
Op√ß√£o 1: Comentar as properties (recomendado para agora)

Temporariamente, comente essas properties at√© criar o Office model:
python

# apps/organizations/models.py

class Organization(models.Model):
    # ... (campos normais)
    
    # ‚ö†Ô∏è Comentar temporariamente at√© criar Office e Membership
    # @property
    # def total_offices(self):
    #     return self.offices.count()
    
    # @property
    # def total_users(self):
    #     return self.memberships.values('user').distinct().count()

E no admin tamb√©m:
python

# apps/organizations/admin.py

@admin.register(Organization)
class OrganizationAdmin(admin.ModelAdmin):
    list_display = [
        'name',
        'document',
        'plan',
        'is_active',
        # 'total_offices',  # ‚Üê Comentar
        # 'total_users',    # ‚Üê Comentar
        'created_at'
    ]
    
    readonly_fields = ['created_at', 'updated_at']  # ‚Üê Remover total_offices e total_users
    
    fieldsets = (
        ('Informa√ß√µes B√°sicas', {
            'fields': ('name', 'document')
        }),
        ('Plano e Status', {
            'fields': ('plan', 'is_active')
        }),
        ('Configura√ß√µes', {
            'fields': ('settings',),
            'classes': ('collapse',)
        }),
        # Remover a se√ß√£o Estat√≠sticas por enquanto
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )

Op√ß√£o 2: Criar Office model AGORA (mais r√°pido que parece)

Se quiser resolver de vez, crie o Office model b√°sico:
python

# apps/offices/models.py

from django.db import models
from apps.organizations.models import Organization

class Office(models.Model):
    """
    Escrit√≥rio/filial de uma organiza√ß√£o.
    """
    organization = models.ForeignKey(
        Organization,
        on_delete=models.CASCADE,
        related_name='offices'  # ‚Üê Isso cria o self.offices
    )
    
    name = models.CharField('Nome', max_length=255)
    
    # JSON para configura√ß√µes flex√≠veis
    settings = models.JSONField('Configura√ß√µes', default=dict, blank=True)
    
    # Datas
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        verbose_name = 'Escrit√≥rio'
        verbose_name_plural = 'Escrit√≥rios'
        ordering = ['-created_at']
    
    def __str__(self):
        return f"{self.name} - {self.organization.name}"

Depois:
bash

python manage.py makemigrations
python manage.py migrate

üéØ Minha Recomenda√ß√£o

Fa√ßa a Op√ß√£o 1 AGORA (comentar as properties):

    Comenta as properties no model
    Remove do admin
    Roda o servidor de novo
    Testa criar Organization
    Marca como completo
    Depois avan√ßa para Office

üìã Comandos para Resolver Agora
bash

# 1. Editar os arquivos (comentar properties)
# - apps/organizations/models.py
# - apps/organizations/admin.py

# 2. Rodar servidor de novo
python manage.py runserver

# 3. Acessar admin
# http://localhost:8000/admin/

‚úÖ Checklist Atualizado

Organization CRUD:

    Model criado
    Admin registrado
    Comentar properties temporariamente ‚ö†Ô∏è AGORA
    Testar cria√ß√£o no admin
    Marcar como completo

Faz essas mudan√ßas e me avisa quando conseguir criar uma Organization no admin!

A√≠ sim marcamos como 100% completo e avan√ßamos para Office + Membership (que vai fazer essas properties voltarem a funcionar).

funcionando perfeitamente. vamos seguir.
12 de jan.
üéâ PERFEITO! Parab√©ns!

Organiza√ß√£o criada com sucesso:

    ‚úÖ Nome: "Br√∫no Pessoa - Advogados Associados"
    ‚úÖ CNPJ: 12351684965
    ‚úÖ Plano: Basic
    ‚úÖ Status: Ativo
    ‚úÖ Jazzmin funcionando lindamente

‚úÖ Fase 1.1 e 1.2 - COMPLETAS!

Voc√™ pode marcar no checklist:

    Autentica√ß√£o (Session) - 100% ‚úÖ
    Organization CRUD (Django Admin) - 100% ‚úÖ

üöÄ Pr√≥ximo Passo: Office Model

Agora vamos criar o Office (escrit√≥rios/filiais).
O que vamos fazer:

    Criar o model Office
    Relacionar com Organization
    Registrar no admin
    Testar cria√ß√£o
    Reativar as properties total_offices e total_users

üìù PASSO 3: Office Model
1. Criar o Model
python

# apps/offices/models.py

from django.db import models
from apps.organizations.models import Organization

class Office(models.Model):
    """
    Escrit√≥rio ou filial de uma organiza√ß√£o.
    Exemplo: Matriz SP, Filial RJ, Departamento Trabalhista
    """
    
    organization = models.ForeignKey(
        Organization,
        on_delete=models.CASCADE,
        related_name='offices',
        verbose_name='Organiza√ß√£o'
    )
    
    name = models.CharField(
        'Nome',
        max_length=255,
        help_text='Nome do escrit√≥rio/filial'
    )
    
    # Opcional: endere√ßo, contato, etc (adicionar depois se quiser)
    # address = models.CharField('Endere√ßo', max_length=500, blank=True)
    # phone = models.CharField('Telefone', max_length=20, blank=True)
    
    # Configura√ß√µes flex√≠veis (igual Organization)
    settings = models.JSONField(
        'Configura√ß√µes',
        default=dict,
        blank=True,
        help_text='Configura√ß√µes espec√≠ficas do escrit√≥rio'
    )
    
    is_active = models.BooleanField(
        'Ativo',
        default=True,
        help_text='Escrit√≥rio ativo'
    )
    
    # Datas
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        verbose_name = 'Escrit√≥rio'
        verbose_name_plural = 'Escrit√≥rios'
        ordering = ['-created_at']
        # Garante que n√£o tem escrit√≥rio duplicado na mesma org
        unique_together = [['organization', 'name']]
    
    def __str__(self):
        return f"{self.name} ({self.organization.name})"

2. Configurar apps.py
python

# apps/offices/apps.py

from django.apps import AppConfig

class OfficesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.offices'
    verbose_name = 'Escrit√≥rios'  # ‚Üê Adicionar

3. Registrar no Admin
python

# apps/offices/admin.py

from django.contrib import admin
from .models import Office

@admin.register(Office)
class OfficeAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar escrit√≥rios.
    Platform admin pode criar/editar escrit√≥rios de qualquer organiza√ß√£o.
    """
    list_display = [
        'name',
        'organization',
        'is_active',
        'created_at'
    ]
    
    list_filter = ['is_active', 'organization', 'created_at']
    
    search_fields = ['name', 'organization__name']
    
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Informa√ß√µes B√°sicas', {
            'fields': ('organization', 'name')
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Configura√ß√µes', {
            'fields': ('settings',),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    # Organiza√ß√£o por padr√£o (melhora UX)
    autocomplete_fields = []  # Se quiser, adiciona autocomplete depois

4. Reativar as Properties em Organization

Agora que Office vai existir, pode descomentar:
python

# apps/organizations/models.py

class Organization(models.Model):
    # ... (campos normais)
    
    @property
    def total_offices(self):
        """Retorna quantidade de escrit√≥rios ativos"""
        return self.offices.filter(is_active=True).count()
    
    @property
    def total_users(self):
        """Retorna quantidade de usu√°rios (quando Membership existir)"""
        # Por enquanto retorna 0, depois vamos implementar
        return 0
        # return self.memberships.values('user').distinct().count()

E no admin:
python

# apps/organizations/admin.py

@admin.register(Organization)
class OrganizationAdmin(admin.ModelAdmin):
    list_display = [
        'name',
        'document',
        'plan',
        'is_active',
        'total_offices',  # ‚Üê Descomentar
        # 'total_users',  # ‚Üê Deixa comentado por enquanto (Membership ainda n√£o existe)
        'created_at'
    ]
    
    readonly_fields = ['created_at', 'updated_at', 'total_offices']
    
    fieldsets = (
        ('Informa√ß√µes B√°sicas', {
            'fields': ('name', 'document')
        }),
        ('Plano e Status', {
            'fields': ('plan', 'is_active')
        }),
        ('Configura√ß√µes', {
            'fields': ('settings',),
            'classes': ('collapse',)
        }),
        ('Estat√≠sticas', {
            'fields': ('total_offices',),  # ‚Üê Descomentar
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def total_offices(self, obj):
        return obj.total_offices
    total_offices.short_description = 'Escrit√≥rios'

5. Rodar Migrations
bash

python manage.py makemigrations
python manage.py migrate

6. Testar no Admin
bash

python manage.py runserver

Acesse: http://localhost:8000/admin/

Teste:

    Ir em Escrit√≥rios ‚Üí Adicionar Escrit√≥rio
    Criar escrit√≥rio para a organiza√ß√£o "Br√∫no Pessoa":
        Organiza√ß√£o: Br√∫no Pessoa - Advogados Associados
        Nome: "Matriz - S√£o Paulo"
        Ativo: Sim
    Criar outro:
        Nome: "Filial - Rio de Janeiro"
        Ativo: Sim
    Verificar: Voltar em Organiza√ß√µes e ver se aparece "2" em total_offices

üìã Checklist Office

    Model Office criado
    ForeignKey para Organization (related_name='offices')
    apps.py com verbose_name
    Admin registrado
    Migrations criadas e aplicadas
    Testado cria√ß√£o de 2 escrit√≥rios
    Property total_offices funcionando em Organization

üéØ Depois disso

Quando Office estiver funcionando, vamos para:

Passo 4: Membership (a parte mais importante!)

    Relaciona User + Organization + Office + Role
    A√≠ sim teremos o sistema multi-tenant completo

Bora criar o Office! Me avisa quando tiver testado e funcionando. üöÄ
bpadvogadosassociados/juridicflow

main

GITHUB

da uma olhada nos arquivos do projeto agora, veja se toda e qualquer corre√ß√£o pendente ja foi feita, o que falta corrigir ou melhorar e se . criei a parte do office e uma parte do membership. falta a parte do role ainda. s√≥ pra confirmar, por enquanto estamos focando s√≥ no painel do admin do sistema, certo? a parte do painel do administrador da organiza√ß√£o, a habilidade que ele vai ter de criar escritorios dentro da organiza√ß√£o, atribuir membros, as fun√ß√µes dos advogados, cadastro de clientes, processos, tudo isso vamos fazer depois, ou ja estamos fazendo? ou essa parte que estamos fazendo √© para a parte do admin do sistema, mas com partes, modelos e etc que irao servir para a parte dos usuarios, org admins e offices admins tambem?
12 de jan.
üîç An√°lise Completa do Projeto

Vou revisar TUDO e responder suas d√∫vidas de forma clara.
üéØ RESPOSTA R√ÅPIDA √†s suas perguntas
1. Sobre os pain√©is:

SIM, estamos focando APENAS no Platform Admin (voc√™) por enquanto.
2. O que estamos fazendo serve para os dois pain√©is?

SIM! Os models que estamos criando servem para ambos os pain√©is:

    Platform Admin (Django Admin): Voc√™ gerencia Organizations, Offices, etc
    Organization Panel (React/Vue): Clientes usam os mesmos models, mas via API

Resumindo:

    ‚úÖ Models = compartilhados entre ambos
    ‚úÖ Django Admin = s√≥ para voc√™ (agora)
    ‚ùå Painel do cliente = vem depois (React + API)

üî¥ PROBLEMAS CR√çTICOS Encontrados
1. Membership Model - ERROS GRAVES
python

# apps/memberships/models.py - LINHA COM ERRO

role = models.CharField()  # ‚ùå SEM PAR√ÇMETROS!

Problemas:

    role sem max_length ‚Üí vai dar erro na migration
    roles definido mas nunca usado
    Membership deveria vincular a User, n√£o criar campos como name, cpf, email

Esse Membership est√° ERRADO conceitualmente.
‚úÖ O QUE EST√Å CERTO

    ‚úÖ User model
    ‚úÖ Organization model
    ‚úÖ Office model
    ‚úÖ Estrutura de apps
    ‚úÖ Jazzmin configurado
    ‚úÖ Verbose names (maioria)

üî¥ O QUE PRECISA CORRIGIR URGENTE
ERRO 1: Membership Conceito Errado

O Membership n√£o √© uma pessoa, √© um v√≠nculo entre User e Organization/Office.

Como deveria ser:
python

# apps/memberships/models.py

from django.db import models
from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office

class Membership(models.Model):
    """
    V√≠nculo entre User, Organization, Office e Role.
    Um User pode ter m√∫ltiplos Memberships (v√°rias orgs, v√°rios pap√©is).
    """
    
    ROLE_CHOICES = [
        ('org_admin', 'Organization Admin'),
        ('office_admin', 'Office Admin'),
        ('lawyer', 'Advogado'),
        ('intern', 'Estagi√°rio'),
        ('accountant', 'Contador'),
        ('finance', 'Financeiro'),
        ('guest', 'Convidado'),
    ]
    
    # ===== RELACIONAMENTOS =====
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Usu√°rio'
    )
    
    organization = models.ForeignKey(
        Organization,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Organiza√ß√£o'
    )
    
    office = models.ForeignKey(
        Office,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Escrit√≥rio',
        null=True,  # Organization Admin n√£o tem office espec√≠fico
        blank=True
    )
    
    # ===== PAPEL/PERMISS√ïES =====
    role = models.CharField(
        'Papel',
        max_length=20,
        choices=ROLE_CHOICES,
        help_text='Fun√ß√£o do usu√°rio nesta organiza√ß√£o/escrit√≥rio'
    )
    
    # ===== STATUS =====
    is_active = models.BooleanField(
        'Ativo',
        default=True,
        help_text='Membership ativo'
    )
    
    # ===== CONFIGURA√á√ïES =====
    settings = models.JSONField(
        'Configura√ß√µes',
        default=dict,
        blank=True,
        help_text='Configura√ß√µes espec√≠ficas deste membership'
    )
    
    # ===== DATAS =====
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        verbose_name = 'Membership'
        verbose_name_plural = 'Memberships'
        ordering = ['-created_at']
        # Um user n√£o pode ter 2 memberships iguais na mesma org/office
        unique_together = [['user', 'organization', 'office']]
    
    def __str__(self):
        office_name = self.office.name if self.office else "Todas"
        return f"{self.user.email} - {self.role} em {office_name}"

ERRO 2: Membership Admin
python

# apps/memberships/admin.py

from django.contrib import admin
from .models import Membership

@admin.register(Membership)
class MembershipAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar memberships (v√≠nculos user-org-office).
    """
    list_display = [
        'user',
        'organization',
        'office',
        'role',
        'is_active',
        'created_at'
    ]
    
    list_filter = ['role', 'is_active', 'organization', 'created_at']
    
    search_fields = [
        'user__email',
        'user__first_name',
        'user__last_name',
        'organization__name',
        'office__name'
    ]
    
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('V√≠nculo', {
            'fields': ('user', 'organization', 'office', 'role')
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Configura√ß√µes', {
            'fields': ('settings',),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    # Facilita busca
    autocomplete_fields = ['user', 'organization', 'office']

ERRO 3: Organization.total_users

Agora que Membership existe corretamente, pode descomentar:
python

# apps/organizations/models.py

@property
def total_users(self):
    """Retorna quantidade de usu√°rios √∫nicos nesta organiza√ß√£o"""
    return self.memberships.values('user').distinct().count()

E no admin, descomentar:
python

# apps/organizations/admin.py

list_display = [
    'name',
    'document',
    'plan',
    'is_active',
    'total_offices',
    'total_users',  # ‚Üê Descomentar
    'created_at'
]

ERRO 4: Verbose names faltando
python

# apps/memberships/apps.py
class MembershipsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.memberships'
    verbose_name = 'Memberships'  # ‚Üê Adicionar

# apps/customers/apps.py
class CustomersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.customers'
    verbose_name = 'Clientes'  # ‚Üê Corrigir (t√° em ingl√™s)
```

---

## üìã CHECKLIST de Corre√ß√µes

### **Urgente:**
- [ ] **Reescrever Membership model completo** (vincular User)
- [ ] **Corrigir Membership admin**
- [ ] Descomentar `total_users` em Organization
- [ ] Rodar migrations
- [ ] Testar cria√ß√£o de Membership

### **Importante:**
- [ ] Verbose names em todos apps
- [ ] Criar property `total_members` em Office (opcional)

### **Opcional (MVP):**
- [ ] Adicionar autocomplete_fields nos admins
- [ ] Valida√ß√£o de CPF em Membership (se realmente precisar)

---

## üéØ FOCO ATUAL vs FUTURO

### **AGORA (Platform Admin - Django Admin)**

Voc√™ est√° criando a **estrutura de dados** (models) que serve para tudo.

**O que voc√™ faz:**
- Criar Organizations manualmente
- Criar Offices manualmente
- Criar Memberships manualmente (vincular users)

**Objetivo**: Ter o sistema multi-tenant funcionando no backend.

---

### **DEPOIS (Organization Panel - React/Vue)**

Os **mesmos models** v√£o ser usados, mas via API REST.

**O que o Organization Admin faz (no painel dele):**
- Ver suas organizations
- Criar/editar offices da sua org
- Convidar usu√°rios (criar Memberships)
- Gerenciar permiss√µes

**O que o Advogado faz (no painel dele):**
- Ver clientes
- Cadastrar processos
- Gerenciar prazos
- Upload de documentos

---

## üß± Estrutura Mental Correta
```
CAMADA 1: MODELS (O QUE VOC√ä EST√Å FAZENDO AGORA)
‚îú‚îÄ‚îÄ User
‚îú‚îÄ‚îÄ Organization
‚îú‚îÄ‚îÄ Office
‚îú‚îÄ‚îÄ Membership ‚Üê V√çNCULO entre os 3 acima
‚îî‚îÄ‚îÄ (Depois: Customer, Process, Deadline, etc)

CAMADA 2: DJANGO ADMIN (S√ì PARA VOC√ä)
‚îú‚îÄ‚îÄ Gerenciar tudo manualmente
‚îî‚îÄ‚îÄ Suporte t√©cnico

CAMADA 3: API REST (VEM DEPOIS)
‚îú‚îÄ‚îÄ Endpoints para Organizations
‚îú‚îÄ‚îÄ Endpoints para Offices
‚îú‚îÄ‚îÄ Endpoints para Customers
‚îî‚îÄ‚îÄ etc

CAMADA 4: FRONTEND REACT/VUE (VEM DEPOIS)
‚îú‚îÄ‚îÄ Painel Organization Admin
‚îú‚îÄ‚îÄ Painel Office Admin
‚îî‚îÄ‚îÄ Painel Advogado/Usu√°rio

Voc√™ est√° na CAMADA 1 agora.
‚úÖ RESUMO EXECUTIVO
Status Atual:

    User ‚úÖ
    Organization ‚úÖ
    Office ‚úÖ
    Membership ‚ùå PRECISA REESCREVER

Pr√≥ximos Passos:

    Corrigir Membership (conceito correto)
    Rodar migrations
    Testar cria√ß√£o de Membership
    Marcar Fase 1 como completa
    Decidir: partir para Fase 2 (Customers, Processes) ou criar API/Frontend?

üéØ A√á√ÉO IMEDIATA

Quer que eu te passe:

Op√ß√£o A: Membership model correto completo (copiar/colar) Op√ß√£o B: Explica√ß√£o conceitual mais detalhada sobre Membership Op√ß√£o C: Seguir direto para testar depois de corrigir

O que prefere?

terminei. a parte de membership esta finalizada? podemos partir para a proxima parte? qual a proxima parte? middleware de isolamento e managers com filtros automaticos?
12 de jan.
üéâ Excelente! Vamos validar e seguir!
‚úÖ Checklist R√°pido - Voc√™ fez tudo?

Antes de marcar como completo, confirma:

    Membership model reescrito (com user ForeignKey)
    Membership admin ajustado
    total_users descomentado em Organization
    Migrations criadas e aplicadas (makemigrations + migrate)
    Testou criar pelo menos 1 Membership no Django Admin

Se SIM para todos ‚Üí Membership est√° ‚úÖ COMPLETO
üìä Status da Fase 1

Fase 1: Funda√ß√£o Multi-tenant
‚îú‚îÄ‚îÄ ‚úÖ User Model
‚îú‚îÄ‚îÄ ‚úÖ Organization Model
‚îú‚îÄ‚îÄ ‚úÖ Office Model
‚îú‚îÄ‚îÄ ‚úÖ Membership System
‚îú‚îÄ‚îÄ ‚¨ú Middleware de Isolamento
‚îî‚îÄ‚îÄ ‚¨ú Managers com Filtros Autom√°ticos

Progresso Fase 1: ~80% completo
üéØ PR√ìXIMO PASSO: Middleware + Managers

Sim! Agora vamos criar a camada de seguran√ßa autom√°tica.
O que vamos fazer:

    Middleware de Organiza√ß√£o - Injeta request.organization e request.office automaticamente
    Managers Customizados - QuerySets que filtram automaticamente por organiza√ß√£o/escrit√≥rio
    Base Models Abstratos - Para n√£o repetir c√≥digo

üöÄ PASSO 5: Shared App (Infraestrutura)
Por que isso √© CR√çTICO:

Sem isso, voc√™ vai ter que manualmente filtrar por organiza√ß√£o em TODA query:
python

# ‚ùå SEM middleware/managers (ruim, perigoso)
customers = Customer.objects.filter(organization=request.organization)
processes = Process.objects.filter(organization=request.organization)
# Repetir isso em TODO lugar ‚Üí chance de esquecer ‚Üí vazamento de dados!

Com middleware/managers:
python

# ‚úÖ COM middleware/managers (seguro, autom√°tico)
customers = Customer.objects.for_request(request)
processes = Process.objects.for_request(request)
# Filtra automaticamente ‚Üí imposs√≠vel esquecer ‚Üí seguro!

üìù IMPLEMENTA√á√ÉO
1. Base Models Abstratos
python

# apps/shared/models.py

from django.db import models

class TimestampedModel(models.Model):
    """
    Modelo abstrato que adiciona timestamps.
    Qualquer model que herdar disso ganha created_at e updated_at.
    """
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        abstract = True


class OrganizationScopedModel(TimestampedModel):
    """
    Modelo abstrato para TUDO que pertence a organiza√ß√£o + escrit√≥rio.
    
    TODOS os models de dom√≠nio devem herdar deste.
    Garante isolamento autom√°tico de dados.
    """
    organization = models.ForeignKey(
        'organizations.Organization',
        on_delete=models.CASCADE,
        verbose_name='Organiza√ß√£o'
    )
    
    office = models.ForeignKey(
        'offices.Office',
        on_delete=models.CASCADE,
        verbose_name='Escrit√≥rio'
    )
    
    class Meta:
        abstract = True
        # √çndices para performance
        indexes = [
            models.Index(fields=['organization', 'office']),
        ]


class SoftDeleteModel(models.Model):
    """
    Modelo abstrato para soft delete.
    Ao inv√©s de deletar, marca como deletado.
    """
    is_deleted = models.BooleanField('Deletado', default=False)
    deleted_at = models.DateTimeField('Deletado em', null=True, blank=True)
    
    class Meta:
        abstract = True

2. Managers Customizados
python

# apps/shared/managers.py

from django.db import models

class OrganizationScopedManager(models.Manager):
    """
    Manager que filtra automaticamente por organiza√ß√£o e escrit√≥rio.
    
    Uso:
        Customer.objects.for_request(request)
        # Retorna s√≥ customers da org/office do request
    """
    
    def for_request(self, request):
        """
        Filtra por organiza√ß√£o e escrit√≥rio do request.
        """
        if not hasattr(request, 'organization') or not request.organization:
            # Se n√£o tem organiza√ß√£o no request, retorna vazio (seguran√ßa)
            return self.none()
        
        queryset = self.filter(organization=request.organization)
        
        # Se tem office no request, filtra tamb√©m por office
        if hasattr(request, 'office') and request.office:
            queryset = queryset.filter(office=request.office)
        
        return queryset
    
    def for_organization(self, organization):
        """
        Filtra por organiza√ß√£o espec√≠fica.
        √ötil para tarefas administrativas.
        """
        return self.filter(organization=organization)
    
    def for_office(self, office):
        """
        Filtra por escrit√≥rio espec√≠fico.
        """
        return self.filter(office=office)


class SoftDeleteManager(models.Manager):
    """
    Manager que exclui automaticamente itens deletados (soft delete).
    """
    
    def get_queryset(self):
        """Por padr√£o, n√£o retorna itens deletados"""
        return super().get_queryset().filter(is_deleted=False)
    
    def with_deleted(self):
        """Retorna tudo, incluindo deletados"""
        return super().get_queryset()
    
    def deleted_only(self):
        """Retorna s√≥ os deletados"""
        return super().get_queryset().filter(is_deleted=True)

3. Middleware de Organiza√ß√£o
python

# apps/shared/middleware.py

from apps.memberships.models import Membership

class OrganizationMiddleware:
    """
    Middleware que injeta organiza√ß√£o e escrit√≥rio no request.
    
    Baseado no usu√°rio logado, identifica qual organiza√ß√£o/escrit√≥rio
    ele est√° acessando e adiciona ao request para uso autom√°tico.
    """
    
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # Inicializa como None
        request.organization = None
        request.office = None
        request.membership = None
        
        # Se usu√°rio est√° autenticado
        if request.user.is_authenticated:
            # Busca o membership ativo do usu√°rio
            # Por padr√£o, pega o primeiro (mais recente)
            membership = Membership.objects.filter(
                user=request.user,
                is_active=True
            ).select_related('organization', 'office').first()
            
            if membership:
                request.organization = membership.organization
                request.office = membership.office
                request.membership = membership
        
        response = self.get_response(request)
        return response

‚ö†Ô∏è Nota: No futuro, quando tiver frontend, voc√™ vai adicionar l√≥gica para o usu√°rio escolher qual organiza√ß√£o/escrit√≥rio ele quer acessar (se tiver m√∫ltiplos). Por enquanto, pega o primeiro.
4. Configurar o Middleware
python

# config/settings.py

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    
    # ‚≠ê Adicionar DEPOIS do AuthenticationMiddleware
    'apps.shared.middleware.OrganizationMiddleware',
]

5. Usando nos Models (exemplo futuro)

Quando voc√™ for criar Customer, Process, etc:
python

# apps/customers/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager

class Customer(OrganizationScopedModel):
    """
    Cliente do escrit√≥rio.
    Automaticamente tem organization, office, created_at, updated_at.
    """
    
    name = models.CharField('Nome', max_length=255)
    document = models.CharField('CPF/CNPJ', max_length=20)
    email = models.EmailField('Email', blank=True)
    phone = models.CharField('Telefone', max_length=20, blank=True)
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Cliente'
        verbose_name_plural = 'Clientes'
    
    def __str__(self):
        return self.name

Uso na view/API:
python

# Automaticamente filtra por org/office do request
customers = Customer.objects.for_request(request)

üß™ Como Testar
1. Criar um script de teste
python

# apps/shared/tests.py

from django.test import TestCase, RequestFactory
from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office
from apps.memberships.models import Membership
from apps.shared.middleware import OrganizationMiddleware

class MiddlewareTest(TestCase):
    def setUp(self):
        # Criar dados de teste
        self.user = User.objects.create_user(
            username='test',
            email='test@test.com',
            password='test123'
        )
        
        self.org = Organization.objects.create(
            name='Test Org',
            document='12345678000190'
        )
        
        self.office = Office.objects.create(
            organization=self.org,
            name='Test Office'
        )
        
        self.membership = Membership.objects.create(
            user=self.user,
            organization=self.org,
            office=self.office,
            role='lawyer'
        )
        
        self.factory = RequestFactory()
        self.middleware = OrganizationMiddleware(lambda x: x)
    
    def test_middleware_injects_organization(self):
        """Testa se middleware injeta organiza√ß√£o no request"""
        request = self.factory.get('/')
        request.user = self.user
        
        self.middleware(request)
        
        self.assertIsNotNone(request.organization)
        self.assertEqual(request.organization, self.org)
        self.assertEqual(request.office, self.office)

Rodar teste:
bash

python manage.py test apps.shared

2. Testar manualmente no shell
bash

python manage.py shell

python

from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office
from apps.memberships.models import Membership

# Pegar um user com membership
user = User.objects.first()
membership = user.memberships.first()

print(f"User: {user.email}")
print(f"Organization: {membership.organization.name}")
print(f"Office: {membership.office.name}")
print(f"Role: {membership.get_role_display()}")
```

---

## ‚úÖ Checklist Passo 5

- [ ] Base models criados em `shared/models.py`
- [ ] Managers criados em `shared/managers.py`
- [ ] Middleware criado em `shared/middleware.py`
- [ ] Middleware adicionado em `settings.py`
- [ ] Testado no shell ou com testes unit√°rios

---

## üéØ Depois disso

Quando Middleware + Managers estiverem prontos:

**Fase 1 COMPLETA** ‚úÖ (100%)

A√≠ voc√™ decide:

**Op√ß√£o A**: Partir para **Fase 2** (Customers, Processes, Deadlines)
**Op√ß√£o B**: Criar **API REST** (Django REST Framework)
**Op√ß√£o C**: Criar **Frontend** (React/Vue)

---

## üìä Progresso Atual
```
MVP Fase 1 - Funda√ß√£o Multi-tenant
‚îú‚îÄ‚îÄ ‚úÖ User Model
‚îú‚îÄ‚îÄ ‚úÖ Organization Model
‚îú‚îÄ‚îÄ ‚úÖ Office Model
‚îú‚îÄ‚îÄ ‚úÖ Membership Model
‚îú‚îÄ‚îÄ ‚¨ú Middleware Isolamento (PR√ìXIMO)
‚îî‚îÄ‚îÄ ‚¨ú Managers Autom√°ticos (PR√ìXIMO)

Progresso Total Fase 1: 80%

Bora implementar Middleware + Managers? Me avisa quando tiver feito e quiser validar! üöÄ
bpadvogadosassociados/juridicflow

main

GITHUB

acho que no geral esta praticamente tudo certo, s√≥ tem alguns problemas. quando rodo "python manage.py makemigrations" da isso "(venv) PS C:\Users\Pessoa 03\juridicflow\juridicflow> python .\manage.py makemigrations
It is impossible to add a non-nullable field 'role' to membership without specifying a default. This is because the database needs something to populate existing rows.
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
 2) Quit and manually define a default value in models.py.
Select an option:
Cancelled."

como resultado, quando tento rodar o test em shared, da isso que coloquei em anexo.

poderia me ajudar a corrigir os problemas, verificar se esta tudo certo, ve o que falta melhorar ou corrijir e dizer se ja podemos passar para a proxima fase? se ja pudermos passar, pode come√ßar logo o inicio da proxima fase?
13 de jan.
üî¥ Problema Identificado e Solu√ß√£o

O erro √© claro: voc√™ mudou o Membership model mas n√£o criou novas migrations.

O banco ainda tem a estrutura antiga (sem user_id), mas o c√≥digo espera a nova estrutura.
‚úÖ SOLU√á√ÉO COMPLETA
Op√ß√£o 1: Resetar banco de dados (RECOMENDADO para desenvolvimento)

Como voc√™ est√° em desenvolvimento e provavelmente n√£o tem dados importantes:
bash

# 1. Deletar banco de dados
# No Windows:
del db.sqlite3

# 2. Deletar TODAS as migrations antigas
# V√° em cada app e delete a pasta migrations (exceto __init__.py)
# OU delete s√≥ os arquivos numerados (0001_initial.py, 0002_etc.py)

# 3. Recriar migrations do zero
python manage.py makemigrations

# 4. Aplicar no banco
python manage.py migrate

# 5. Criar superuser novamente
python manage.py createsuperuser

# 6. Rodar teste
python manage.py test apps.shared

Op√ß√£o 2: Fornecer default (se quiser manter dados)

Se voc√™ tem dados importantes no banco:
python

# apps/memberships/models.py

role = models.CharField(
    'Papel',
    max_length=20,
    choices=ROLE_CHOICES,
    default='guest',  # ‚Üê Adicionar default tempor√°rio
    help_text='Fun√ß√£o do usu√°rio nesta organiza√ß√£o/escrit√≥rio'
)

Depois:
bash

python manage.py makemigrations
python manage.py migrate

üîß CORRE√á√ïES ADICIONAIS
1. Membership model - ajuste fino
python

# apps/memberships/models.py

from django.db import models
from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office

class Membership(models.Model):
    """
    V√≠nculo entre User, Organization, Office e Role.
    """
    
    ROLE_CHOICES = [
        ('org_admin', 'Organization Admin'),
        ('office_admin', 'Office Admin'),
        ('lawyer', 'Advogado'),
        ('intern', 'Estagi√°rio'),
        ('accountant', 'Contador'),
        ('finance', 'Financeiro'),
        ('guest', 'Convidado'),
    ]
    
    user = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Usu√°rio'
    )
    
    organization = models.ForeignKey(
        Organization,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Organiza√ß√£o'
    )
    
    office = models.ForeignKey(
        Office,
        on_delete=models.CASCADE,
        related_name='memberships',
        verbose_name='Escrit√≥rio',
        null=True,
        blank=True
    )
    
    role = models.CharField(
        'Papel',
        max_length=20,
        choices=ROLE_CHOICES,
        default='guest',  # ‚Üê Adicionar default
        help_text='Fun√ß√£o do usu√°rio nesta organiza√ß√£o/escrit√≥rio'
    )
    
    is_active = models.BooleanField(
        'Ativo',
        default=True,
        help_text='Membership ativo'
    )
    
    settings = models.JSONField(
        'Configura√ß√µes',
        default=dict,
        blank=True,
        help_text='Configura√ß√µes espec√≠ficas deste membership'
    )
    
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        verbose_name = 'Membership'
        verbose_name_plural = 'Memberships'
        ordering = ['-created_at']
        unique_together = [['user', 'organization', 'office']]
    
    def __str__(self):
        office_name = self.office.name if self.office else "Todas"
        return f"{self.user.email} - {self.role} em {office_name}"

2. Organization model - ajuste no total_users
python

# apps/organizations/models.py

@property
def total_users(self):
    """Retorna quantidade de usu√°rios √∫nicos nesta organiza√ß√£o"""
    return self.memberships.values('user').distinct().count()

Certifique-se que est√° descomentado.
3. Shared models - pequeno ajuste
python

# apps/shared/models.py

from django.db import models

class TimestampedModel(models.Model):
    """Adiciona timestamps autom√°ticos"""
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    updated_at = models.DateTimeField('Atualizado em', auto_now=True)
    
    class Meta:
        abstract = True


class OrganizationScopedModel(TimestampedModel):
    """
    Base para models que pertencem a organiza√ß√£o + escrit√≥rio.
    
    IMPORTANTE: N√£o adicionar indexes aqui (causa problemas em abstract models).
    Adicione indexes nos models concretos se necess√°rio.
    """
    organization = models.ForeignKey(
        'organizations.Organization',
        on_delete=models.CASCADE,
        verbose_name='Organiza√ß√£o',
        related_name='%(app_label)s_%(class)s_set'  # ‚Üê Evita conflitos
    )
    
    office = models.ForeignKey(
        'offices.Office',
        on_delete=models.CASCADE,
        verbose_name='Escrit√≥rio',
        related_name='%(app_label)s_%(class)s_set'  # ‚Üê Evita conflitos
    )
    
    class Meta:
        abstract = True


class SoftDeleteModel(models.Model):
    """Soft delete"""
    is_deleted = models.BooleanField('Deletado', default=False)
    deleted_at = models.DateTimeField('Deletado em', null=True, blank=True)
    
    class Meta:
        abstract = True

üöÄ SEQU√äNCIA DE COMANDOS
bash

# 1. Deletar banco
del db.sqlite3

# 2. Deletar migrations antigas (opcional mas recomendado)
# Manualmente: apague os arquivos 000X_*.py em cada app/migrations/

# 3. Criar migrations do zero
python manage.py makemigrations

# 4. Aplicar
python manage.py migrate

# 5. Criar superuser
python manage.py createsuperuser
# Email: seu@email.com
# Username: admin
# Password: ******

# 6. Popular dados de teste
python manage.py shell

No shell:
python

from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office
from apps.memberships.models import Membership

# Criar organiza√ß√£o
org = Organization.objects.create(
    name='Test Org',
    document='12345678000190',
    plan='basic'
)

# Criar escrit√≥rio
office = Office.objects.create(
    organization=org,
    name='Test Office'
)

# Pegar o superuser
user = User.objects.first()

# Criar membership
membership = Membership.objects.create(
    user=user,
    organization=org,
    office=office,
    role='org_admin'
)

print(f"‚úÖ Membership criado: {membership}")
exit()

bash

# 7. Rodar teste
python manage.py test apps.shared

# 8. Rodar servidor
python manage.py runserver
```

---

## üß™ Teste deve passar

Se tudo estiver certo, voc√™ deve ver:
```
Found 1 test(s).
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 1 test in 0.XXXs

OK
```

---

## ‚úÖ CHECKLIST FINAL Fase 1

Depois que tudo funcionar:

- [ ] Banco resetado
- [ ] Migrations criadas e aplicadas
- [ ] Superuser criado
- [ ] Membership de teste criado
- [ ] Teste passa sem erros
- [ ] Middleware funciona
- [ ] Managers funcionam

---

## üéØ FASE 1 COMPLETA

Quando tudo funcionar:
```
‚úÖ Fase 1: Funda√ß√£o Multi-tenant - 100% COMPLETA

‚îú‚îÄ‚îÄ ‚úÖ User Model
‚îú‚îÄ‚îÄ ‚úÖ Organization Model
‚îú‚îÄ‚îÄ ‚úÖ Office Model
‚îú‚îÄ‚îÄ ‚úÖ Membership Model
‚îú‚îÄ‚îÄ ‚úÖ Middleware de Isolamento
‚îî‚îÄ‚îÄ ‚úÖ Managers Autom√°ticos
```

---

## üöÄ PR√ìXIMA FASE: Jur√≠dico B√°sico

Quando Fase 1 estiver 100%, vamos para:

### **Fase 2: Jur√≠dico B√°sico**

#### **Passo 1: Customers (Clientes)**
- Model Customer
- Admin completo
- Usando OrganizationScopedModel
- Testando isolamento

#### **Passo 2: Processes (Processos)**
- Model Process
- Model ProcessParty (relacionamento N:N com Customer)
- N√∫mero CNJ, tribunal, fase

#### **Passo 3: Deadlines (Prazos)**
- Model Deadline
- Vincula√ß√£o gen√©rica (processo, contrato, etc)
- Sistema de alertas b√°sico

#### **Passo 4: Documents (Documentos)**
- Model Document
- Upload b√°sico
- Vincula√ß√£o com Process/Customer

---

## üìä Progresso Total MVP
```
MVP Completo
‚îú‚îÄ‚îÄ ‚úÖ Fase 1: Funda√ß√£o Multi-tenant (100%)
‚îú‚îÄ‚îÄ ‚¨ú Fase 2: Jur√≠dico B√°sico (0%)
‚îú‚îÄ‚îÄ ‚¨ú Fase 3: Controle de Acesso (0%)
‚îî‚îÄ‚îÄ ‚¨ú Fase 4: Financeiro B√°sico (0%)

Progresso Total: 25%

üí° A√á√ÉO IMEDIATA

Execute os comandos acima (deletar banco, recriar migrations, etc) e me avisa:

    Se o teste passou
    Se conseguiu criar Membership no admin
    Se est√° tudo funcionando

A√≠ eu confirmo que Fase 1 est√° 100% e come√ßo a Fase 2 imediatamente! üöÄ
bpadvogadosassociados/juridicflow

main

GITHUB

resolvido. tive outros problemas, mas consegui resolver. vamos seguir?
13 de jan.
üéâ PERFEITO! Fase 1 - 100% COMPLETA!

Parab√©ns! Voc√™ tem agora uma funda√ß√£o multi-tenant s√≥lida e escal√°vel.
‚úÖ O que voc√™ conquistou (Fase 1)

‚úÖ Fase 1: Funda√ß√£o Multi-tenant - 100% COMPLETA

‚îú‚îÄ‚îÄ ‚úÖ User customizado (login com email)
‚îú‚îÄ‚îÄ ‚úÖ Organization (contas pagantes)
‚îú‚îÄ‚îÄ ‚úÖ Office (escrit√≥rios/filiais)
‚îú‚îÄ‚îÄ ‚úÖ Membership (v√≠nculo user-org-office-role)
‚îú‚îÄ‚îÄ ‚úÖ Middleware de isolamento autom√°tico
‚îú‚îÄ‚îÄ ‚úÖ Managers com filtros autom√°ticos
‚îî‚îÄ‚îÄ ‚úÖ Base models abstratos (shared)

Isso √© o cora√ß√£o do sistema. Tudo que vem agora vai usar essa base.
üöÄ FASE 2: JUR√çDICO B√ÅSICO

Agora vamos criar os models de dom√≠nio jur√≠dico que usam toda essa infraestrutura.
üìù PASSO 1: Customers (Clientes)
1. Criar o Model
python

# apps/customers/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager

class Customer(OrganizationScopedModel):
    """
    Cliente do escrit√≥rio (pessoa f√≠sica ou jur√≠dica).
    Pode ser autor, r√©u ou terceiro em processos.
    """
    
    TYPE_CHOICES = [
        ('PF', 'Pessoa F√≠sica'),
        ('PJ', 'Pessoa Jur√≠dica'),
    ]
    
    # ===== INFORMA√á√ïES B√ÅSICAS =====
    name = models.CharField(
        'Nome/Raz√£o Social',
        max_length=255,
        help_text='Nome completo (PF) ou Raz√£o Social (PJ)'
    )
    
    type = models.CharField(
        'Tipo',
        max_length=2,
        choices=TYPE_CHOICES,
        default='PF'
    )
    
    document = models.CharField(
        'CPF/CNPJ',
        max_length=20,
        help_text='CPF (XXX.XXX.XXX-XX) ou CNPJ (XX.XXX.XXX/XXXX-XX)'
    )
    
    # ===== CONTATO =====
    email = models.EmailField(
        'Email',
        blank=True,
        help_text='Email principal'
    )
    
    phone = models.CharField(
        'Telefone',
        max_length=20,
        blank=True,
        help_text='Telefone principal'
    )
    
    phone_secondary = models.CharField(
        'Telefone Secund√°rio',
        max_length=20,
        blank=True
    )
    
    # ===== ENDERE√áO =====
    address = models.CharField(
        'Endere√ßo',
        max_length=500,
        blank=True
    )
    
    city = models.CharField(
        'Cidade',
        max_length=100,
        blank=True
    )
    
    state = models.CharField(
        'Estado',
        max_length=2,
        blank=True,
        help_text='UF (ex: SP, RJ)'
    )
    
    zip_code = models.CharField(
        'CEP',
        max_length=10,
        blank=True
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Anota√ß√µes internas sobre o cliente'
    )
    
    # ===== STATUS =====
    is_active = models.BooleanField(
        'Ativo',
        default=True,
        help_text='Cliente ativo no sistema'
    )
    
    # Manager customizado (herda filtros autom√°ticos)
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Cliente'
        verbose_name_plural = 'Clientes'
        ordering = ['-created_at']
        # Garante que n√£o tem cliente duplicado na mesma org
        unique_together = [['organization', 'document']]
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['document']),
            models.Index(fields=['name']),
        ]
    
    def __str__(self):
        return f"{self.name} ({self.document})"
    
    @property
    def document_formatted(self):
        """Retorna documento formatado"""
        if self.type == 'PF' and len(self.document) == 11:
            # CPF: XXX.XXX.XXX-XX
            return f"{self.document[:3]}.{self.document[3:6]}.{self.document[6:9]}-{self.document[9:]}"
        elif self.type == 'PJ' and len(self.document) == 14:
            # CNPJ: XX.XXX.XXX/XXXX-XX
            return f"{self.document[:2]}.{self.document[2:5]}.{self.document[5:8]}/{self.document[8:12]}-{self.document[12:]}"
        return self.document

2. Configurar apps.py
python

# apps/customers/apps.py

from django.apps import AppConfig

class CustomersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.customers'
    verbose_name = 'Clientes'  # ‚Üê J√° estava, confirmar

3. Criar Admin Completo
python

# apps/customers/admin.py

from django.contrib import admin
from .models import Customer

@admin.register(Customer)
class CustomerAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar clientes.
    """
    list_display = [
        'name',
        'type',
        'document',
        'email',
        'phone',
        'city',
        'is_active',
        'created_at'
    ]
    
    list_filter = [
        'type',
        'is_active',
        'organization',
        'office',
        'created_at'
    ]
    
    search_fields = [
        'name',
        'document',
        'email',
        'phone'
    ]
    
    readonly_fields = ['created_at', 'updated_at']
    
    fieldsets = (
        ('Informa√ß√µes B√°sicas', {
            'fields': ('organization', 'office', 'type', 'name', 'document')
        }),
        ('Contato', {
            'fields': ('email', 'phone', 'phone_secondary')
        }),
        ('Endere√ßo', {
            'fields': ('address', 'city', 'state', 'zip_code'),
            'classes': ('collapse',)
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
        ('Status', {
            'fields': ('is_active',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    # Filtros laterais
    list_per_page = 25
    
    # A√ß√µes em massa
    actions = ['activate_customers', 'deactivate_customers']
    
    def activate_customers(self, request, queryset):
        """Ativa clientes selecionados"""
        count = queryset.update(is_active=True)
        self.message_user(request, f'{count} cliente(s) ativado(s).')
    activate_customers.short_description = 'Ativar clientes selecionados'
    
    def deactivate_customers(self, request, queryset):
        """Desativa clientes selecionados"""
        count = queryset.update(is_active=False)
        self.message_user(request, f'{count} cliente(s) desativado(s).')
    deactivate_customers.short_description = 'Desativar clientes selecionados'

4. Atualizar Jazzmin (√≠cones)
python

# config/settings.py - JAZZMIN_SETTINGS

"icons": {
    # ... (anteriores)
    
    # Customers
    "customers": "fas fa-users",
    "customers.Customer": "fas fa-user",
    
    # (Adicionar depois quando criar)
    # "processes": "fas fa-gavel",
    # "processes.Process": "fas fa-file-contract",
    # "deadlines": "fas fa-clock",
    # "deadlines.Deadline": "fas fa-bell",
    # "documents": "fas fa-folder",
    # "documents.Document": "fas fa-file-pdf",
},

5. Migrations
bash

python manage.py makemigrations
python manage.py migrate

6. Testar no Admin
bash

python manage.py runserver

Acesse: http://localhost:8000/admin/

Criar 2-3 clientes de teste:

    Cliente PF:
        Nome: Jo√£o Silva
        Tipo: Pessoa F√≠sica
        CPF: 12345678900
        Email: joao@email.com
        Telefone: (11) 98765-4321
    Cliente PJ:
        Nome: Silva Com√©rcio Ltda
        Tipo: Pessoa Jur√≠dica
        CNPJ: 12345678000190
        Email: contato@silva.com
    Cliente Inativo:
        Nome: Maria Santos
        Tipo: PF
        Ativo: N√£o

7. Testar Isolamento (IMPORTANTE)
bash

python manage.py shell

python

from apps.customers.models import Customer
from apps.organizations.models import Organization

# Ver todos os clientes
customers = Customer.objects.all()
print(f"Total clientes: {customers.count()}")

# Ver clientes por organiza√ß√£o
org1 = Organization.objects.first()
customers_org1 = Customer.objects.filter(organization=org1)
print(f"Clientes da org '{org1.name}': {customers_org1.count()}")

# Testar unique_together (n√£o pode cadastrar 2x mesmo CPF na mesma org)
# Isso DEVE dar erro:
# Customer.objects.create(
#     organization=org1,
#     office=org1.offices.first(),
#     name='Teste Duplicado',
#     document='12345678900'  # CPF j√° existe
# )
```

---

## ‚úÖ Checklist Customer

- [ ] Model Customer criado (com OrganizationScopedModel)
- [ ] Manager customizado (OrganizationScopedManager)
- [ ] Admin registrado e completo
- [ ] Jazzmin com √≠cones
- [ ] Migrations aplicadas
- [ ] Testado cria√ß√£o de 2-3 clientes
- [ ] Testado isolamento por organiza√ß√£o
- [ ] Testado unique_together (CPF duplicado)

---

## üìä Progresso Fase 2
```
Fase 2: Jur√≠dico B√°sico
‚îú‚îÄ‚îÄ ‚è≥ Customers (AGORA)
‚îú‚îÄ‚îÄ ‚¨ú Processes
‚îú‚îÄ‚îÄ ‚¨ú Deadlines
‚îî‚îÄ‚îÄ ‚¨ú Documents

Progresso Fase 2: 0% ‚Üí 25%

üéØ Pr√≥ximo (depois de Customer funcionar)

Passo 2: Processes

    Model Process (n√∫mero CNJ, tribunal, fase)
    Model ProcessParty (N:N entre Process e Customer)
    Relacionamento com m√∫ltiplas partes

Implementa o Customer e me avisa quando tiver testado! A√≠ partimos para Processes. üöÄ

Alguma d√∫vida sobre Customer antes de come√ßar?
bpadvogadosassociados/juridicflow

main

GITHUB

fiz as modifica√ß√µes que voce pediu. pode verificar se esta tudo certo, o que pode melhorar, se da pra seguir e, se der, come√ßar o proximo passo dentro da fase?
13 de jan.
üîç Verifica√ß√£o Completa - Customer

Vou validar tudo antes de seguir.
‚úÖ Checklist de Valida√ß√£o
1. Testes B√°sicos
bash

# No terminal
python manage.py shell

python

from apps.customers.models import Customer
from apps.organizations.models import Organization
from apps.offices.models import Office

# 1. Verificar se Customer existe
print("‚úÖ Customer model importado")

# 2. Contar clientes
total = Customer.objects.count()
print(f"Total de clientes: {total}")

# 3. Testar isolamento por organiza√ß√£o
org = Organization.objects.first()
if org:
    customers_org = Customer.objects.filter(organization=org)
    print(f"Clientes da org '{org.name}': {customers_org.count()}")

# 4. Testar property document_formatted
customer = Customer.objects.first()
if customer:
    print(f"Cliente: {customer.name}")
    print(f"Documento: {customer.document}")
    print(f"Formatado: {customer.document_formatted}")

# 5. Verificar manager customizado
print(f"Manager: {Customer.objects.__class__.__name__}")

exit()

2. Teste no Django Admin

Acesse: http://localhost:8000/admin/customers/customer/

Verificar:

    Lista de clientes aparece
    Filtros laterais funcionam (tipo, ativo, organiza√ß√£o)
    Busca funciona (nome, documento, email)
    Consegue criar novo cliente
    Consegue editar cliente
    A√ß√µes em massa funcionam (ativar/desativar)
    Fieldsets est√£o organizados
    Campos obrigat√≥rios est√£o corretos

3. Teste de Seguran√ßa (Isolamento)
bash

python manage.py shell

python

from apps.customers.models import Customer
from apps.organizations.models import Organization
from apps.offices.models import Office

# Criar 2 organiza√ß√µes diferentes
org1 = Organization.objects.first()
org2 = Organization.objects.last()

office1 = org1.offices.first()
office2 = org2.offices.first() if org2.offices.exists() else org1.offices.first()

# Criar cliente na org1
c1 = Customer.objects.create(
    organization=org1,
    office=office1,
    name='Cliente Org 1',
    type='PF',
    document='11111111111'
)

# Criar cliente na org2 (ou na mesma org, mas office diferente)
c2 = Customer.objects.create(
    organization=org2 if org2 != org1 else org1,
    office=office2,
    name='Cliente Org 2',
    type='PF',
    document='22222222222'
)

# Testar unique_together
# Isso DEVE dar erro (IntegrityError):
try:
    c3 = Customer.objects.create(
        organization=org1,
        office=office1,
        name='Duplicado',
        document='11111111111'  # CPF j√° existe na org1
    )
    print("‚ùå ERRO: Permitiu duplicar CPF!")
except Exception as e:
    print(f"‚úÖ Correto: Bloqueou duplica√ß√£o - {e}")

exit()

üîß Melhorias Recomendadas (Opcional)
1. Valida√ß√£o de CPF/CNPJ
python

# apps/customers/models.py

from django.core.exceptions import ValidationError
import re

def validate_document(value):
    """Valida formato b√°sico de CPF/CNPJ"""
    # Remove caracteres n√£o num√©ricos
    clean = re.sub(r'[^0-9]', '', value)
    
    if len(clean) not in [11, 14]:
        raise ValidationError('CPF deve ter 11 d√≠gitos ou CNPJ 14 d√≠gitos')
    
    return clean

class Customer(OrganizationScopedModel):
    # ...
    
    document = models.CharField(
        'CPF/CNPJ',
        max_length=20,
        validators=[validate_document],  # ‚Üê Adicionar
        help_text='CPF (XXX.XXX.XXX-XX) ou CNPJ (XX.XXX.XXX/XXXX-XX)'
    )
    
    def save(self, *args, **kwargs):
        """Limpa documento antes de salvar"""
        if self.document:
            self.document = re.sub(r'[^0-9]', '', self.document)
        super().save(*args, **kwargs)

2. M√©todo para contagem de processos
python

# apps/customers/models.py

class Customer(OrganizationScopedModel):
    # ... (campos existentes)
    
    @property
    def total_processes(self):
        """Retorna quantidade de processos deste cliente"""
        # Quando criar Process model
        return self.processparty_set.count()

3. Admin - Autocomplete para organiza√ß√£o/office
python

# apps/customers/admin.py

@admin.register(Customer)
class CustomerAdmin(admin.ModelAdmin):
    # ... (configura√ß√£o existente)
    
    # Adicionar autocomplete (melhora UX quando tem muitas orgs/offices)
    autocomplete_fields = ['organization', 'office']

Mas para isso funcionar, voc√™ precisa adicionar nos outros admins:
python

# apps/organizations/admin.py
@admin.register(Organization)
class OrganizationAdmin(admin.ModelAdmin):
    # ... (existente)
    search_fields = ['name', 'document']  # ‚Üê J√° tem

# apps/offices/admin.py
@admin.register(Office)
class OfficeAdmin(admin.ModelAdmin):
    # ... (existente)
    search_fields = ['name', 'organization__name']  # ‚Üê J√° tem
```

---

## ‚úÖ Se tudo passou nos testes

**Customer est√° 100% pronto!** ‚úÖ

Pode marcar:
```
Fase 2: Jur√≠dico B√°sico
‚îú‚îÄ‚îÄ ‚úÖ Customers (COMPLETO)
‚îú‚îÄ‚îÄ ‚¨ú Processes
‚îú‚îÄ‚îÄ ‚¨ú Deadlines
‚îî‚îÄ‚îÄ ‚¨ú Documents

Progresso Fase 2: 25%

üöÄ PASSO 2: Processes (Processos Judiciais)

Agora vem a parte mais importante do sistema jur√≠dico.
Estrutura:

    Process: O processo em si (n√∫mero CNJ, tribunal, etc)
    ProcessParty: Relacionamento N:N entre Process e Customer (quem √© autor, r√©u, etc)

1. Model Process
python

# apps/processes/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager

class Process(OrganizationScopedModel):
    """
    Processo judicial.
    N√∫mero CNJ, tribunal, fase, etc.
    """
    
    PHASE_CHOICES = [
        ('initial', 'Inicial'),
        ('instruction', 'Instru√ß√£o'),
        ('sentence', 'Senten√ßa'),
        ('appeal', 'Recurso'),
        ('execution', 'Execu√ß√£o'),
        ('archived', 'Arquivado'),
    ]
    
    AREA_CHOICES = [
        ('civil', 'C√≠vel'),
        ('criminal', 'Criminal'),
        ('labor', 'Trabalhista'),
        ('family', 'Fam√≠lia'),
        ('tax', 'Tribut√°rio'),
        ('administrative', 'Administrativo'),
        ('other', 'Outro'),
    ]
    
    # ===== IDENTIFICA√á√ÉO =====
    number = models.CharField(
        'N√∫mero CNJ',
        max_length=25,
        unique=True,
        help_text='N√∫mero √∫nico do processo (formato CNJ: NNNNNNN-DD.AAAA.J.TR.OOOO)'
    )
    
    internal_number = models.CharField(
        'N√∫mero Interno',
        max_length=50,
        blank=True,
        help_text='N√∫mero de controle interno do escrit√≥rio'
    )
    
    # ===== CLASSIFICA√á√ÉO =====
    area = models.CharField(
        '√Årea',
        max_length=20,
        choices=AREA_CHOICES,
        default='civil'
    )
    
    subject = models.CharField(
        'Assunto',
        max_length=255,
        help_text='Assunto principal do processo'
    )
    
    # ===== TRIBUNAL =====
    court = models.CharField(
        'Tribunal',
        max_length=255,
        help_text='Nome do tribunal (ex: TJSP, STJ, etc)'
    )
    
    court_division = models.CharField(
        'Vara/C√¢mara',
        max_length=255,
        blank=True,
        help_text='Vara ou C√¢mara'
    )
    
    # ===== FASE PROCESSUAL =====
    phase = models.CharField(
        'Fase',
        max_length=20,
        choices=PHASE_CHOICES,
        default='initial'
    )
    
    # ===== VALOR DA CAUSA =====
    value = models.DecimalField(
        'Valor da Causa',
        max_digits=15,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='Valor da causa em R$'
    )
    
    # ===== DATAS =====
    distribution_date = models.DateField(
        'Data de Distribui√ß√£o',
        null=True,
        blank=True,
        help_text='Data em que o processo foi distribu√≠do'
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Anota√ß√µes internas sobre o processo'
    )
    
    # ===== STATUS =====
    is_active = models.BooleanField(
        'Ativo',
        default=True,
        help_text='Processo ativo'
    )
    
    is_confidential = models.BooleanField(
        'Confidencial',
        default=False,
        help_text='Processo com segredo de justi√ßa'
    )
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Processo'
        verbose_name_plural = 'Processos'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['number']),
            models.Index(fields=['phase']),
            models.Index(fields=['area']),
        ]
    
    def __str__(self):
        return f"{self.number} - {self.subject}"
    
    @property
    def parties_count(self):
        """Retorna quantidade de partes no processo"""
        return self.parties.count()

2. Model ProcessParty (Relacionamento N:N)
python

# apps/processes/models.py (continua)

from apps.customers.models import Customer

class ProcessParty(models.Model):
    """
    Relacionamento entre Process e Customer.
    Define o papel de cada parte no processo (autor, r√©u, etc).
    """
    
    ROLE_CHOICES = [
        ('plaintiff', 'Autor'),
        ('defendant', 'R√©u'),
        ('third_party', 'Terceiro'),
        ('witness', 'Testemunha'),
        ('expert', 'Perito'),
        ('lawyer', 'Advogado da Parte Contr√°ria'),
    ]
    
    process = models.ForeignKey(
        Process,
        on_delete=models.CASCADE,
        related_name='parties',
        verbose_name='Processo'
    )
    
    customer = models.ForeignKey(
        Customer,
        on_delete=models.CASCADE,
        related_name='process_parties',
        verbose_name='Cliente'
    )
    
    role = models.CharField(
        'Papel',
        max_length=20,
        choices=ROLE_CHOICES,
        help_text='Papel da parte no processo'
    )
    
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Observa√ß√µes sobre esta parte'
    )
    
    created_at = models.DateTimeField('Criado em', auto_now_add=True)
    
    class Meta:
        verbose_name = 'Parte do Processo'
        verbose_name_plural = 'Partes do Processo'
        # N√£o pode adicionar a mesma pessoa 2x com o mesmo papel
        unique_together = [['process', 'customer', 'role']]
    
    def __str__(self):
        return f"{self.customer.name} - {self.get_role_display()}"

3. Admin Process
python

# apps/processes/admin.py

from django.contrib import admin
from .models import Process, ProcessParty

class ProcessPartyInline(admin.TabularInline):
    """
    Inline para adicionar partes diretamente no processo.
    """
    model = ProcessParty
    extra = 1
    autocomplete_fields = ['customer']
    fields = ['customer', 'role', 'notes']

@admin.register(Process)
class ProcessAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar processos.
    """
    list_display = [
        'number',
        'subject',
        'area',
        'phase',
        'court',
        'parties_count',
        'is_active',
        'created_at'
    ]
    
    list_filter = [
        'area',
        'phase',
        'is_active',
        'is_confidential',
        'organization',
        'office',
        'created_at'
    ]
    
    search_fields = [
        'number',
        'internal_number',
        'subject',
        'court'
    ]
    
    readonly_fields = ['created_at', 'updated_at', 'parties_count']
    
    fieldsets = (
        ('Organiza√ß√£o', {
            'fields': ('organization', 'office')
        }),
        ('Identifica√ß√£o', {
            'fields': ('number', 'internal_number')
        }),
        ('Classifica√ß√£o', {
            'fields': ('area', 'subject')
        }),
        ('Tribunal', {
            'fields': ('court', 'court_division')
        }),
        ('Andamento', {
            'fields': ('phase', 'distribution_date', 'value')
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
        ('Status', {
            'fields': ('is_active', 'is_confidential')
        }),
        ('Estat√≠sticas', {
            'fields': ('parties_count',),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    # Inline de partes
    inlines = [ProcessPartyInline]
    
    # A√ß√µes em massa
    actions = ['archive_processes', 'activate_processes']
    
    def archive_processes(self, request, queryset):
        count = queryset.update(phase='archived', is_active=False)
        self.message_user(request, f'{count} processo(s) arquivado(s).')
    archive_processes.short_description = 'Arquivar processos selecionados'
    
    def activate_processes(self, request, queryset):
        count = queryset.update(is_active=True)
        self.message_user(request, f'{count} processo(s) ativado(s).')
    activate_processes.short_description = 'Ativar processos selecionados'


@admin.register(ProcessParty)
class ProcessPartyAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar partes (opcional, pois tem o inline).
    """
    list_display = ['process', 'customer', 'role', 'created_at']
    list_filter = ['role', 'created_at']
    search_fields = ['process__number', 'customer__name']
    autocomplete_fields = ['process', 'customer']

4. Atualizar apps.py
python

# apps/processes/apps.py

from django.apps import AppConfig

class ProcessesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.processes'
    verbose_name = 'Processos'  # ‚Üê Confirmar

5. Atualizar Jazzmin
python

# config/settings.py - JAZZMIN_SETTINGS["icons"]

"processes": "fas fa-gavel",
"processes.Process": "fas fa-file-contract",
"processes.ProcessParty": "fas fa-user-tie",

6. Atualizar Customer admin - autocomplete
python

# apps/customers/admin.py

@admin.register(Customer)
class CustomerAdmin(admin.ModelAdmin):
    # ... (existente)
    
    search_fields = ['name', 'document', 'email']  # ‚Üê J√° tem

7. Migrations
bash

python manage.py makemigrations
python manage.py migrate

8. Testar
bash

python manage.py runserver

No admin:

    Criar processo
    Adicionar 2-3 partes (autor, r√©u)
    Verificar inline funcionando
    Testar filtros e busca

‚úÖ Checklist Process

    Process model criado
    ProcessParty model criado
    Admin com inline funcionando
    Migrations aplicadas
    Testado cria√ß√£o de processo com partes
    Testado isolamento

Implementa Process e me avisa quando testar! üöÄ

pronto vamos seguir, mas antes, me responde rapidinho uma pergunta: a gente vai usar esse painel admin mesmo com essas fun√ß√µes e modelos process, customers e etc, ou s√≥ estamos registrando eles no painel admin para testar enquanto desenvolvemos, removendo eles do painel do admin do sistema mais para a frente, quando criarmos o painel do usuario e do admin da org?
13 de jan.
üéØ RESPOSTA DIRETA

Vamos REMOVER do Django Admin depois.
üìä Divis√£o Clara dos Pain√©is
Django Admin (Platform Admin) - VOC√ä

O que FICA permanentemente:

    ‚úÖ Organizations
    ‚úÖ Offices
    ‚úÖ Memberships
    ‚úÖ Users (gerenciar contas)
    ‚úÖ Planos/Billing (quando criar)
    ‚úÖ Logs do sistema
    ‚úÖ Configura√ß√µes da plataforma

O que VAI SAIR depois:

    ‚ùå Customers
    ‚ùå Processes
    ‚ùå Deadlines
    ‚ùå Documents
    ‚ùå Finance (dados dos clientes)

Organization Panel (React/Vue) - CLIENTES

O que os clientes v√£o usar:

    ‚úÖ Customers
    ‚úÖ Processes
    ‚úÖ Deadlines
    ‚úÖ Documents
    ‚úÖ Finance
    ‚úÖ Relat√≥rios
    ‚úÖ Dashboard

üîí Por que isso?
Seguran√ßa e LGPD:

    Voc√™ (platform admin) n√£o deve ter acesso aos dados jur√≠dicos dos clientes
    Customers, Processes, etc s√£o dados sens√≠veis
    Se voc√™ v√™ isso no Django Admin, viola privacidade

Separa√ß√£o de Responsabilidades:

    Voc√™: Mant√©m a plataforma rodando (infra, bugs, suporte t√©cnico)
    Clientes: Usam o sistema jur√≠dico (cadastrar processos, clientes, etc)

üõ†Ô∏è Por que registramos no Django Admin AGORA?

Para desenvolvimento/teste:

    ‚úÖ Testar models rapidamente
    ‚úÖ Popular dados de teste
    ‚úÖ Validar relacionamentos
    ‚úÖ Debug de bugs
    ‚úÖ Ver estrutura funcionando

√â TEMPOR√ÅRIO.
üöÄ Quando remover?

Quando voc√™ criar a API REST + Frontend React/Vue, a√≠ voc√™:

    Mant√©m no Django Admin:
        Organizations, Offices, Memberships, Users
    Remove do Django Admin:
        Customers, Processes, Deadlines, Documents, Finance
    Adiciona no Jazzmin:

python

# config/settings.py - JAZZMIN_SETTINGS

"hide_models": [
    "customers.Customer",
    "processes.Process",
    "processes.ProcessParty",
    "deadlines.Deadline",
    "documents.Document",
    "finance.FeeAgreement",
    # etc
],

Ou simplesmente n√£o registra mais no admin:
python

# apps/customers/admin.py

# Comentar ou deletar
# @admin.register(Customer)
# class CustomerAdmin(admin.ModelAdmin):
#     ...
```

---

## üìã Roadmap Completo
```
FASE ATUAL (Desenvolvimento):
‚îú‚îÄ‚îÄ Django Admin: TUDO (para testar)
‚îî‚îÄ‚îÄ Frontend: N√£o existe ainda

FASE MVP (Lan√ßamento):
‚îú‚îÄ‚îÄ Django Admin: S√≥ infra (Organizations, Users, etc)
‚îî‚îÄ‚îÄ Frontend React: Dados jur√≠dicos (Customers, Processes, etc)

FASE PRODU√á√ÉO:
‚îú‚îÄ‚îÄ Django Admin: S√≥ voc√™ + suporte t√©cnico
‚îî‚îÄ‚îÄ Frontend: Clientes usam 100%

‚úÖ Conclus√£o

SIM, √© s√≥ para testar agora.

Depois voc√™ vai:

    Criar API REST (Django REST Framework)
    Criar Frontend (React/Vue)
    Remover Customers/Processes/etc do Django Admin
    Clientes acessam via painel pr√≥prio

Mas por enquanto, continua registrando tudo no Django Admin para desenvolvimento.
üéØ Foco Atual

Agora:

    ‚úÖ Customer (testado)
    ‚úÖ Process (testado)
    ‚è≥ Deadlines (pr√≥ximo)
    ‚è≥ Documents (depois)

Tudo no Django Admin temporariamente.

Bora continuar? Pr√≥ximo passo: Deadlines! üöÄ

bora continuar.
13 de jan.
üöÄ PASSO 3: Deadlines (Prazos e Compromissos)

Essa √© uma das partes mais cr√≠ticas de um sistema jur√≠dico. Prazos perdidos = problemas s√©rios.
üìù Model Deadline
python

# apps/deadlines/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager
from apps.accounts.models import User
from django.contrib.contenttypes.fields import GenericForeignKey
from django.contrib.contenttypes.models import ContentType

class Deadline(OrganizationScopedModel):
    """
    Prazo ou compromisso.
    Pode estar vinculado a processo, contrato, tarefa, etc.
    """
    
    TYPE_CHOICES = [
        ('legal', 'Prazo Legal'),
        ('hearing', 'Audi√™ncia'),
        ('meeting', 'Reuni√£o'),
        ('task', 'Tarefa'),
        ('other', 'Outro'),
    ]
    
    PRIORITY_CHOICES = [
        ('low', 'Baixa'),
        ('medium', 'M√©dia'),
        ('high', 'Alta'),
        ('urgent', 'Urgente'),
    ]
    
    STATUS_CHOICES = [
        ('pending', 'Pendente'),
        ('in_progress', 'Em Andamento'),
        ('completed', 'Conclu√≠do'),
        ('cancelled', 'Cancelado'),
        ('overdue', 'Atrasado'),
    ]
    
    # ===== INFORMA√á√ïES B√ÅSICAS =====
    title = models.CharField(
        'T√≠tulo',
        max_length=255,
        help_text='Descri√ß√£o curta do prazo'
    )
    
    description = models.TextField(
        'Descri√ß√£o',
        blank=True,
        help_text='Detalhes do prazo ou compromisso'
    )
    
    type = models.CharField(
        'Tipo',
        max_length=20,
        choices=TYPE_CHOICES,
        default='task'
    )
    
    # ===== DATAS =====
    due_date = models.DateField(
        'Data de Vencimento',
        help_text='Data limite do prazo'
    )
    
    due_time = models.TimeField(
        'Hor√°rio',
        null=True,
        blank=True,
        help_text='Hor√°rio espec√≠fico (opcional)'
    )
    
    completed_at = models.DateTimeField(
        'Conclu√≠do em',
        null=True,
        blank=True
    )
    
    # ===== PRIORIDADE E STATUS =====
    priority = models.CharField(
        'Prioridade',
        max_length=10,
        choices=PRIORITY_CHOICES,
        default='medium'
    )
    
    status = models.CharField(
        'Status',
        max_length=20,
        choices=STATUS_CHOICES,
        default='pending'
    )
    
    # ===== RESPONS√ÅVEL =====
    responsible = models.ForeignKey(
        User,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='deadlines',
        verbose_name='Respons√°vel',
        help_text='Usu√°rio respons√°vel por este prazo'
    )
    
    # ===== VINCULA√á√ÉO GEN√âRICA =====
    # Permite vincular a Process, Contract, ou qualquer outro model
    content_type = models.ForeignKey(
        ContentType,
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        verbose_name='Tipo de Objeto'
    )
    
    object_id = models.PositiveIntegerField(
        null=True,
        blank=True,
        verbose_name='ID do Objeto'
    )
    
    content_object = GenericForeignKey('content_type', 'object_id')
    
    # ===== ALERTAS =====
    alert_days_before = models.IntegerField(
        'Alertar quantos dias antes',
        default=3,
        help_text='Quantidade de dias antes para enviar alerta'
    )
    
    alert_sent = models.BooleanField(
        'Alerta Enviado',
        default=False,
        help_text='Se o alerta j√° foi enviado'
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Anota√ß√µes internas'
    )
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Prazo'
        verbose_name_plural = 'Prazos'
        ordering = ['due_date', 'due_time']
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['due_date']),
            models.Index(fields=['status']),
            models.Index(fields=['priority']),
            models.Index(fields=['responsible']),
        ]
    
    def __str__(self):
        return f"{self.title} - {self.due_date}"
    
    @property
    def is_overdue(self):
        """Verifica se o prazo est√° atrasado"""
        from django.utils import timezone
        if self.status in ['completed', 'cancelled']:
            return False
        return timezone.now().date() > self.due_date
    
    @property
    def days_remaining(self):
        """Retorna quantos dias faltam"""
        from django.utils import timezone
        if self.status in ['completed', 'cancelled']:
            return None
        delta = self.due_date - timezone.now().date()
        return delta.days
    
    def mark_as_completed(self):
        """Marca como conclu√≠do"""
        from django.utils import timezone
        self.status = 'completed'
        self.completed_at = timezone.now()
        self.save()
    
    def save(self, *args, **kwargs):
        """Auto-atualiza status para atrasado se necess√°rio"""
        if self.is_overdue and self.status == 'pending':
            self.status = 'overdue'
        super().save(*args, **kwargs)

üé® Admin Deadline
python

# apps/deadlines/admin.py

from django.contrib import admin
from django.utils.html import format_html
from django.utils import timezone
from .models import Deadline

@admin.register(Deadline)
class DeadlineAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar prazos.
    """
    list_display = [
        'title',
        'due_date',
        'due_time',
        'priority_badge',
        'status_badge',
        'responsible',
        'days_remaining_display',
        'created_at'
    ]
    
    list_filter = [
        'type',
        'priority',
        'status',
        'due_date',
        'organization',
        'office',
        'responsible',
        'created_at'
    ]
    
    search_fields = [
        'title',
        'description',
        'responsible__email',
        'responsible__first_name',
        'responsible__last_name'
    ]
    
    readonly_fields = [
        'created_at',
        'updated_at',
        'completed_at',
        'is_overdue',
        'days_remaining',
        'alert_sent'
    ]
    
    fieldsets = (
        ('Organiza√ß√£o', {
            'fields': ('organization', 'office')
        }),
        ('Informa√ß√µes B√°sicas', {
            'fields': ('title', 'description', 'type')
        }),
        ('Data e Hora', {
            'fields': ('due_date', 'due_time')
        }),
        ('Respons√°vel', {
            'fields': ('responsible',)
        }),
        ('Prioridade e Status', {
            'fields': ('priority', 'status', 'completed_at')
        }),
        ('Vincula√ß√£o', {
            'fields': ('content_type', 'object_id'),
            'classes': ('collapse',),
            'description': 'Vincular a um processo, contrato, etc.'
        }),
        ('Alertas', {
            'fields': ('alert_days_before', 'alert_sent'),
            'classes': ('collapse',)
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
        ('Informa√ß√µes Adicionais', {
            'fields': ('is_overdue', 'days_remaining', 'created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    # Filtros laterais
    date_hierarchy = 'due_date'
    
    # A√ß√µes em massa
    actions = [
        'mark_as_completed',
        'mark_as_pending',
        'mark_as_cancelled'
    ]
    
    def priority_badge(self, obj):
        """Badge colorido para prioridade"""
        colors = {
            'low': '#28a745',      # Verde
            'medium': '#ffc107',   # Amarelo
            'high': '#fd7e14',     # Laranja
            'urgent': '#dc3545',   # Vermelho
        }
        color = colors.get(obj.priority, '#6c757d')
        return format_html(
            '<span style="background-color: {}; color: white; padding: 3px 10px; border-radius: 3px; font-weight: bold;">{}</span>',
            color,
            obj.get_priority_display()
        )
    priority_badge.short_description = 'Prioridade'
    
    def status_badge(self, obj):
        """Badge colorido para status"""
        colors = {
            'pending': '#6c757d',      # Cinza
            'in_progress': '#007bff',  # Azul
            'completed': '#28a745',    # Verde
            'cancelled': '#6c757d',    # Cinza
            'overdue': '#dc3545',      # Vermelho
        }
        color = colors.get(obj.status, '#6c757d')
        return format_html(
            '<span style="background-color: {}; color: white; padding: 3px 10px; border-radius: 3px;">{}</span>',
            color,
            obj.get_status_display()
        )
    status_badge.short_description = 'Status'
    
    def days_remaining_display(self, obj):
        """Mostra dias restantes com cor"""
        days = obj.days_remaining
        if days is None:
            return '-'
        
        if days < 0:
            color = '#dc3545'  # Vermelho
            text = f'{abs(days)} dias atrasado'
        elif days == 0:
            color = '#ffc107'  # Amarelo
            text = 'Vence hoje!'
        elif days <= 3:
            color = '#fd7e14'  # Laranja
            text = f'{days} dias'
        else:
            color = '#28a745'  # Verde
            text = f'{days} dias'
        
        return format_html(
            '<span style="color: {}; font-weight: bold;">{}</span>',
            color,
            text
        )
    days_remaining_display.short_description = 'Dias Restantes'
    
    def mark_as_completed(self, request, queryset):
        """Marca como conclu√≠do"""
        for deadline in queryset:
            deadline.mark_as_completed()
        count = queryset.count()
        self.message_user(request, f'{count} prazo(s) marcado(s) como conclu√≠do(s).')
    mark_as_completed.short_description = 'Marcar como conclu√≠do'
    
    def mark_as_pending(self, request, queryset):
        """Marca como pendente"""
        count = queryset.update(status='pending', completed_at=None)
        self.message_user(request, f'{count} prazo(s) marcado(s) como pendente(s).')
    mark_as_pending.short_description = 'Marcar como pendente'
    
    def mark_as_cancelled(self, request, queryset):
        """Marca como cancelado"""
        count = queryset.update(status='cancelled')
        self.message_user(request, f'{count} prazo(s) cancelado(s).')
    mark_as_cancelled.short_description = 'Cancelar prazos'

üîó Vincular Deadline a Process (Opcional mas recomendado)
python

# apps/processes/models.py

class Process(OrganizationScopedModel):
    # ... (c√≥digo existente)
    
    @property
    def deadlines_count(self):
        """Retorna quantidade de prazos vinculados"""
        from django.contrib.contenttypes.models import ContentType
        from apps.deadlines.models import Deadline
        
        ct = ContentType.objects.get_for_model(self)
        return Deadline.objects.filter(
            content_type=ct,
            object_id=self.id
        ).count()

E no admin do Process:
python

# apps/processes/admin.py

@admin.register(Process)
class ProcessAdmin(admin.ModelAdmin):
    # ... (existente)
    
    readonly_fields = ['created_at', 'updated_at', 'parties_count', 'deadlines_count']
    
    # Adicionar no fieldset Estat√≠sticas

‚öôÔ∏è Apps Config
python

# apps/deadlines/apps.py

from django.apps import AppConfig

class DeadlinesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.deadlines'
    verbose_name = 'Prazos'  # ‚Üê Confirmar

üé® Jazzmin Icons
python

# config/settings.py - JAZZMIN_SETTINGS["icons"]

"deadlines": "fas fa-clock",
"deadlines.Deadline": "fas fa-bell",

üóÑÔ∏è Migrations
bash

python manage.py makemigrations
python manage.py migrate

üß™ Testar
bash

python manage.py runserver
```

### **No Admin:**

1. **Criar prazo gen√©rico:**
   - T√≠tulo: "Protocolar peti√ß√£o inicial"
   - Data: Amanh√£
   - Prioridade: Alta
   - Respons√°vel: Voc√™

2. **Criar prazo vinculado a processo:**
   - T√≠tulo: "Prazo para contesta√ß√£o"
   - Tipo: Prazo Legal
   - Data: Daqui a 5 dias
   - Content Type: Process
   - Object ID: (ID do processo que voc√™ criou)

3. **Criar prazo atrasado (para testar):**
   - T√≠tulo: "Prazo vencido"
   - Data: Ontem
   - Ver que automaticamente fica "Atrasado"

4. **Testar a√ß√µes:**
   - Marcar como conclu√≠do
   - Ver badges coloridos

---

## ‚úÖ Checklist Deadlines

- [ ] Deadline model criado
- [ ] Admin com badges coloridos
- [ ] Vincula√ß√£o gen√©rica (ContentType)
- [ ] Properties (is_overdue, days_remaining)
- [ ] Migrations aplicadas
- [ ] Testado prazos normais
- [ ] Testado prazos atrasados
- [ ] Testado vincula√ß√£o a Process
- [ ] A√ß√µes em massa funcionando

---

## üìä Progresso Fase 2
```
Fase 2: Jur√≠dico B√°sico
‚îú‚îÄ‚îÄ ‚úÖ Customers (25%)
‚îú‚îÄ‚îÄ ‚úÖ Processes (50%)
‚îú‚îÄ‚îÄ ‚è≥ Deadlines (75% - AGORA)
‚îî‚îÄ‚îÄ ‚¨ú Documents (100%)

Progresso Fase 2: 75%

üéØ Pr√≥ximo Passo

Quando Deadlines estiver funcionando:

PASSO 4: Documents (√∫ltimo da Fase 2!)

    Upload de arquivos
    Vincula√ß√£o com Process/Customer
    Categorias de documentos

Implementa Deadlines e me avisa quando testar! üöÄ

D√∫vidas sobre prazos?
bpadvogadosassociados/juridicflow

main

GITHUB

terminei essa parte, vamos seguir? s√≥ da uma olhada no repositorio do projeto antes para confirmar que n√£o tem nenhum problema ou algo pra melhorar antes.
14 de jan.
üîç An√°lise Completa do Reposit√≥rio

Excelente trabalho! Vou validar tudo antes de partir para Documents (√∫ltimo passo da Fase 2).
‚úÖ O QUE EST√Å PERFEITO
1. Estrutura Geral ‚úÖ

    Apps organizados em apps/
    Configura√ß√£o em config/
    Separa√ß√£o correta de responsabilidades

2. Fase 1 - Funda√ß√£o ‚úÖ

    User customizado
    Organization
    Office
    Membership
    Middleware funcionando
    Managers funcionando
    Shared models abstratos

3. Fase 2 - Jur√≠dico ‚úÖ

    Customers com valida√ß√£o de CPF/CNPJ
    Processes com ProcessParty inline
    Deadlines com badges coloridos e properties

üü° PEQUENOS AJUSTES (n√£o cr√≠ticos, mas recomendados)
1. Process Admin - Falta adicionar deadlines_count no fieldset
python

# apps/processes/admin.py

readonly_fields = ['created_at', 'updated_at', 'parties_count', 'deadlines_count']

fieldsets = (
    # ... (outros fieldsets)
    
    ('Estat√≠sticas', {
        'fields': ('parties_count', 'deadlines_count'),  # ‚Üê Adicionar deadlines_count
        'classes': ('collapse',)
    }),
    
    # ... (resto)
)

2. Customer Admin - Autocomplete precisa de search_fields nos outros models

Voc√™ adicionou autocomplete_fields = ['organization', 'office'] mas falta garantir que Organization e Office tenham search_fields:
python

# apps/organizations/admin.py
@admin.register(Organization)
class OrganizationAdmin(admin.ModelAdmin):
    # ...
    search_fields = ['name', 'document']  # ‚úÖ J√Å TEM

# apps/offices/admin.py
@admin.register(Office)
class OfficeAdmin(admin.ModelAdmin):
    # ...
    search_fields = ['name', 'organization__name']  # ‚úÖ J√Å TEM

Est√° OK! ‚úÖ
3. Process Model - Autocomplete precisa de search_fields

ProcessParty admin usa autocomplete_fields = ['process', 'customer'], ent√£o:
python

# apps/processes/admin.py

@admin.register(Process)
class ProcessAdmin(admin.ModelAdmin):
    # ...
    search_fields = [
        'number',
        'internal_number',
        'subject',
        'court'
    ]  # ‚úÖ J√Å TEM

Est√° OK! ‚úÖ
4. Jazzmin - Ordem dos apps no menu

Recomendo ajustar para priorizar os jur√≠dicos quando o cliente usar:
python

# config/settings.py - JAZZMIN_SETTINGS

"order_with_respect_to": [
    "organizations",
    "offices",
    "memberships",
    "accounts",
    "customers",      # ‚Üê Adicionar
    "processes",      # ‚Üê Adicionar
    "deadlines",      # ‚Üê Adicionar
    # "documents",    # ‚Üê Adicionar quando criar
],

5. ProcessParty - Falta related_name no Customer

No Customer model, voc√™ tem:
python

@property
def total_processes(self):
    """Retorna total de processos associados ao cliente"""
    return self.processparty_set.count()  # ‚Üê Funciona, mas poderia ser melhor

No ProcessParty:
python

customer = models.ForeignKey(
    Customer,
    on_delete=models.CASCADE,
    related_name='process_parties',  # ‚úÖ J√Å TEM
    verbose_name='Cliente'
)

Ent√£o pode melhorar:
python

# apps/customers/models.py

@property
def total_processes(self):
    """Retorna total de processos associados ao cliente"""
    return self.process_parties.values('process').distinct().count()

üìä Checklist Final Antes de Documents

    User model
    Organization model
    Office model
    Membership model
    Middleware
    Managers
    Shared models
    Customers
    Processes
    ProcessParty
    Deadlines
    Jazzmin configurado
    Migrations aplicadas

‚úÖ EST√Å PRONTO PARA DOCUMENTS

O projeto est√° s√≥lido e bem estruturado.

Pode seguir para o √∫ltimo passo da Fase 2: Documents! üöÄ
üéØ PASSO 4: Documents (√öltimo da Fase 2!)

Vamos criar o sistema de upload e gest√£o de documentos.
Features:

    Upload de arquivos (PDF, DOCX, imagens, etc)
    Vincula√ß√£o com Process/Customer
    Categorias de documentos
    Controle de vers√µes (opcional MVP)

üìù Model Document
python

# apps/documents/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager
from apps.accounts.models import User
from django.contrib.contenttypes.fields import GenericForeignKey
from django.contrib.contenttypes.models import ContentType
import os

def document_upload_path(instance, filename):
    """
    Define o caminho de upload dos documentos.
    Organiza por: organization/office/ano/mes/filename
    """
    from datetime import datetime
    now = datetime.now()
    org_id = instance.organization.id
    office_id = instance.office.id
    year = now.year
    month = now.month
    
    return f'documents/org_{org_id}/office_{office_id}/{year}/{month:02d}/{filename}'

class Document(OrganizationScopedModel):
    """
    Documento do escrit√≥rio.
    Pode ser vinculado a processo, cliente, etc.
    """
    
    CATEGORY_CHOICES = [
        ('petition', 'Peti√ß√£o'),
        ('contract', 'Contrato'),
        ('decision', 'Decis√£o Judicial'),
        ('proof', 'Prova'),
        ('correspondence', 'Correspond√™ncia'),
        ('invoice', 'Nota Fiscal'),
        ('receipt', 'Recibo'),
        ('procuration', 'Procura√ß√£o'),
        ('report', 'Relat√≥rio'),
        ('other', 'Outro'),
    ]
    
    # ===== INFORMA√á√ïES B√ÅSICAS =====
    title = models.CharField(
        'T√≠tulo',
        max_length=255,
        help_text='Nome/descri√ß√£o do documento'
    )
    
    category = models.CharField(
        'Categoria',
        max_length=20,
        choices=CATEGORY_CHOICES,
        default='other'
    )
    
    description = models.TextField(
        'Descri√ß√£o',
        blank=True,
        help_text='Descri√ß√£o detalhada do documento'
    )
    
    # ===== ARQUIVO =====
    file = models.FileField(
        'Arquivo',
        upload_to=document_upload_path,
        help_text='Arquivo do documento (PDF, DOCX, imagem, etc)'
    )
    
    file_size = models.PositiveIntegerField(
        'Tamanho',
        null=True,
        blank=True,
        help_text='Tamanho do arquivo em bytes'
    )
    
    # ===== VINCULA√á√ÉO GEN√âRICA =====
    content_type = models.ForeignKey(
        ContentType,
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        verbose_name='Tipo de Objeto'
    )
    
    object_id = models.PositiveIntegerField(
        null=True,
        blank=True,
        verbose_name='ID do Objeto'
    )
    
    content_object = GenericForeignKey('content_type', 'object_id')
    
    # ===== CONTROLE =====
    uploaded_by = models.ForeignKey(
        User,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='uploaded_documents',
        verbose_name='Enviado por'
    )
    
    is_confidential = models.BooleanField(
        'Confidencial',
        default=False,
        help_text='Documento confidencial (acesso restrito)'
    )
    
    version = models.PositiveIntegerField(
        'Vers√£o',
        default=1,
        help_text='Vers√£o do documento'
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Anota√ß√µes sobre o documento'
    )
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Documento'
        verbose_name_plural = 'Documentos'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['category']),
            models.Index(fields=['content_type', 'object_id']),
        ]
    
    def __str__(self):
        return self.title
    
    def save(self, *args, **kwargs):
        """Calcula o tamanho do arquivo automaticamente"""
        if self.file and not self.file_size:
            self.file_size = self.file.size
        super().save(*args, **kwargs)
    
    @property
    def file_extension(self):
        """Retorna a extens√£o do arquivo"""
        if self.file:
            return os.path.splitext(self.file.name)[1].lower()
        return ''
    
    @property
    def file_size_mb(self):
        """Retorna o tamanho em MB"""
        if self.file_size:
            return round(self.file_size / (1024 * 1024), 2)
        return 0
    
    @property
    def file_icon(self):
        """Retorna √≠cone baseado na extens√£o"""
        icons = {
            '.pdf': 'fa-file-pdf',
            '.doc': 'fa-file-word',
            '.docx': 'fa-file-word',
            '.xls': 'fa-file-excel',
            '.xlsx': 'fa-file-excel',
            '.jpg': 'fa-file-image',
            '.jpeg': 'fa-file-image',
            '.png': 'fa-file-image',
            '.zip': 'fa-file-archive',
            '.rar': 'fa-file-archive',
        }
        return icons.get(self.file_extension, 'fa-file')

üé® Admin Document
python

# apps/documents/admin.py

from django.contrib import admin
from django.utils.html import format_html
from .models import Document

@admin.register(Document)
class DocumentAdmin(admin.ModelAdmin):
    """
    Admin para gerenciar documentos.
    """
    list_display = [
        'title',
        'category',
        'file_badge',
        'file_size_display',
        'uploaded_by',
        'is_confidential',
        'created_at'
    ]
    
    list_filter = [
        'category',
        'is_confidential',
        'organization',
        'office',
        'uploaded_by',
        'created_at'
    ]
    
    search_fields = [
        'title',
        'description',
        'file'
    ]
    
    readonly_fields = [
        'created_at',
        'updated_at',
        'file_size',
        'file_extension',
        'file_size_mb',
        'uploaded_by'
    ]
    
    fieldsets = (
        ('Organiza√ß√£o', {
            'fields': ('organization', 'office')
        }),
        ('Informa√ß√µes B√°sicas', {
            'fields': ('title', 'category', 'description')
        }),
        ('Arquivo', {
            'fields': ('file', 'file_size', 'file_extension', 'file_size_mb', 'version')
        }),
        ('Vincula√ß√£o', {
            'fields': ('content_type', 'object_id'),
            'classes': ('collapse',),
            'description': 'Vincular a um processo, cliente, etc.'
        }),
        ('Controle', {
            'fields': ('uploaded_by', 'is_confidential')
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    def save_model(self, request, obj, form, change):
        """Auto-preenche uploaded_by"""
        if not obj.pk:  # Se √© novo
            obj.uploaded_by = request.user
        super().save_model(request, obj, form, change)
    
    def file_badge(self, obj):
        """Badge com √≠cone do tipo de arquivo"""
        icon = obj.file_icon
        ext = obj.file_extension.upper().replace('.', '')
        
        colors = {
            'PDF': '#dc3545',
            'DOC': '#0d6efd',
            'DOCX': '#0d6efd',
            'XLS': '#198754',
            'XLSX': '#198754',
            'JPG': '#fd7e14',
            'JPEG': '#fd7e14',
            'PNG': '#fd7e14',
        }
        color = colors.get(ext, '#6c757d')
        
        return format_html(
            '<i class="fas {} " style="color: {}"></i> {}',
            icon,
            color,
            ext if ext else 'FILE'
        )
    file_badge.short_description = 'Tipo'
    
    def file_size_display(self, obj):
        """Exibe tamanho do arquivo formatado"""
        if obj.file_size:
            if obj.file_size < 1024:
                return f'{obj.file_size} B'
            elif obj.file_size < 1024 * 1024:
                return f'{obj.file_size / 1024:.1f} KB'
            else:
                return f'{obj.file_size_mb} MB'
        return '-'
    file_size_display.short_description = 'Tamanho'

‚öôÔ∏è Configura√ß√µes
1. Apps Config
python

# apps/documents/apps.py

from django.apps import AppConfig

class DocumentsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.documents'
    verbose_name = 'Documentos'  # ‚úÖ J√Å TEM

2. Settings - MEDIA
python

# config/settings.py

# ‚úÖ J√Å TEM
MEDIA_URL = 'media/'
MEDIA_ROOT = BASE_DIR / 'media'

3. URLs - Servir arquivos em desenvolvimento
python

# config/urls.py

from django.contrib import admin
from django.urls import path
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
]

# Servir arquivos de media em desenvolvimento
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

4. Jazzmin Icons
python

# config/settings.py - JAZZMIN_SETTINGS["icons"]

"documents": "fas fa-folder",
"documents.Document": "fas fa-file-pdf",

üóÑÔ∏è Migrations
bash

python manage.py makemigrations
python manage.py migrate

üß™ Testar
bash

python manage.py runserver
```

### **No Admin:**

1. **Upload documento gen√©rico:**
   - T√≠tulo: "Contrato Social"
   - Categoria: Contrato
   - Fazer upload de um PDF

2. **Upload vinculado a processo:**
   - T√≠tulo: "Peti√ß√£o Inicial"
   - Categoria: Peti√ß√£o
   - Content Type: Process
   - Object ID: (ID do processo)
   - Upload de arquivo

3. **Verificar:**
   - Badge do tipo de arquivo
   - Tamanho calculado automaticamente
   - uploaded_by preenchido automaticamente

---

## ‚úÖ Checklist Documents

- [ ] Document model criado
- [ ] Upload path din√¢mico
- [ ] Properties (file_extension, file_size_mb, file_icon)
- [ ] Admin com badges
- [ ] uploaded_by auto-preenchido
- [ ] MEDIA configurado
- [ ] URLs servindo arquivos
- [ ] Migrations aplicadas
- [ ] Testado upload
- [ ] Testado vincula√ß√£o a Process

---

## üéâ FASE 2 COMPLETA!

Quando Documents funcionar:
```
‚úÖ Fase 2: Jur√≠dico B√°sico - 100% COMPLETA

‚îú‚îÄ‚îÄ ‚úÖ Customers
‚îú‚îÄ‚îÄ ‚úÖ Processes
‚îú‚îÄ‚îÄ ‚úÖ Deadlines
‚îî‚îÄ‚îÄ ‚úÖ Documents

Progresso Total MVP: 50%

Implementa Documents e me avisa quando testar! A√≠ marcamos Fase 2 como completa e decidimos o pr√≥ximo passo! üöÄ
bpadvogadosassociados/juridicflow

main

GITHUB

documents pronto, terminamos a fase 2!!üòätambem montei uma landing simples com um formulario para contato pra pagina "/" da aplica√ß√£o, mas a gente vai refinar ela depois. vamos para a proxima fase? a fase 3 - controle de acesso, inclui sistema de permiss√µes por role, testes de isolamento e auditoria basica, mas antes, s√≥ da uma olhada pra ver se esta tudo certinho com o projeto, por favor.
08:27
üéâ PARAB√âNS! FASE 2 - 100% COMPLETA!

Excelente trabalho! Vou revisar tudo rapidamente e depois partimos para Fase 3.
‚úÖ REVIS√ÉO GERAL DO PROJETO
Fase 1: Funda√ß√£o Multi-tenant ‚úÖ 100%

    User customizado
    Organization
    Office
    Membership
    Middleware de isolamento
    Managers autom√°ticos
    Base models (shared)

Fase 2: Jur√≠dico B√°sico ‚úÖ 100%

    Customers (com valida√ß√£o CPF/CNPJ)
    Processes (com ProcessParty inline)
    Deadlines (com badges e properties)
    Documents (com upload e vincula√ß√£o)

BONUS: Landing Page ‚úÖ

    Design moderno e responsivo
    Formul√°rio de contato
    WhatsApp float button
    Integrado ao projeto

üîç PROBLEMAS ENCONTRADOS
1. URLs - Falta descomentar MEDIA em debug ‚ö†Ô∏è
python

# config/urls.py

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('apps.landing.urls'))
]

# DESCOMENTAR ISSO:
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

Por qu√™? Sem isso, os arquivos de Documents n√£o v√£o ser acess√≠veis em desenvolvimento.
2. Landing - Apps n√£o est√° em INSTALLED_APPS na ordem correta

Est√° correto, mas recomendo colocar landing no final:
python

INSTALLED_APPS = [
    'jazzmin',
    'django.contrib.admin',
    # ...
    
    # Apps principais
    'apps.accounts',
    'apps.customers',
    'apps.deadlines',
    'apps.documents',
    'apps.finance',
    'apps.memberships',
    'apps.offices',
    'apps.organizations',
    'apps.processes',
    'apps.shared',
    
    # Landing page (p√∫blico)
    'apps.landing',  # ‚Üê No final
]

3. Settings - Email config ‚ö†Ô∏è
python

EMAIL_HOST_USER = 'leviesara@gmail.com'
EMAIL_HOST_PASSWORD = ''  # ‚Üê VAZIO!
```

**Para desenvolvimento**: Est√° OK usando `console.EmailBackend` (emails aparecem no terminal)

**Para produ√ß√£o**: Voc√™ vai precisar:
- Adicionar senha de app do Gmail (n√£o a senha normal)
- Ou usar servi√ßo como SendGrid, Mailgun

---

## ‚úÖ O QUE EST√Å PERFEITO

1. ‚úÖ Estrutura de apps organizada
2. ‚úÖ Models com OrganizationScopedModel
3. ‚úÖ Managers customizados
4. ‚úÖ Middleware funcionando
5. ‚úÖ Admins completos com badges
6. ‚úÖ Jazzmin configurado
7. ‚úÖ Landing page funcional
8. ‚úÖ Documents com upload path din√¢mico
9. ‚úÖ Process com deadlines_count
10. ‚úÖ Customer com total_processes

---

## üìä PROGRESSO TOTAL
```
‚úÖ Fase 1: Funda√ß√£o Multi-tenant (100%)
‚úÖ Fase 2: Jur√≠dico B√°sico (100%)
‚¨ú Fase 3: Controle de Acesso (0%)
‚¨ú Fase 4: Financeiro B√°sico (0%)

PROGRESSO GERAL MVP: 50%

üöÄ FASE 3: CONTROLE DE ACESSO

Agora vamos implementar permiss√µes granulares e auditoria.
O que vamos fazer:

    Sistema de Permiss√µes por Role
        Permissions customizadas por model
        Decorators para views
        Mixins para DRF (quando criar API)
    Testes de Isolamento
        Testes automatizados
        Garantir que dados n√£o vazam entre orgs
    Auditoria B√°sica
        Log de todas as a√ß√µes
        Quem fez o qu√™ e quando
        Hist√≥rico de altera√ß√µes

üìù PASSO 1: Permissions Customizadas
1. Criar Permission System
python

# apps/shared/permissions.py

from django.core.exceptions import PermissionDenied

class BasePermission:
    """
    Base para permiss√µes customizadas.
    """
    
    def has_permission(self, user, organization=None, office=None):
        """Verifica se usu√°rio tem permiss√£o gen√©rica"""
        return False
    
    def has_object_permission(self, user, obj):
        """Verifica se usu√°rio tem permiss√£o sobre objeto espec√≠fico"""
        return False


class IsOrganizationAdmin(BasePermission):
    """Apenas Organization Admin"""
    
    def has_permission(self, user, organization=None, office=None):
        from apps.memberships.models import Membership
        
        return Membership.objects.filter(
            user=user,
            organization=organization,
            role='org_admin',
            is_active=True
        ).exists()


class IsOfficeAdmin(BasePermission):
    """Organization Admin ou Office Admin"""
    
    def has_permission(self, user, organization=None, office=None):
        from apps.memberships.models import Membership
        
        return Membership.objects.filter(
            user=user,
            organization=organization,
            role__in=['org_admin', 'office_admin'],
            is_active=True
        ).exists()


class CanManageCustomers(BasePermission):
    """Pode gerenciar clientes"""
    
    def has_permission(self, user, organization=None, office=None):
        from apps.memberships.models import Membership
        
        return Membership.objects.filter(
            user=user,
            organization=organization,
            role__in=['org_admin', 'office_admin', 'lawyer'],
            is_active=True
        ).exists()


class CanManageProcesses(BasePermission):
    """Pode gerenciar processos"""
    
    def has_permission(self, user, organization=None, office=None):
        from apps.memberships.models import Membership
        
        return Membership.objects.filter(
            user=user,
            organization=organization,
            role__in=['org_admin', 'office_admin', 'lawyer'],
            is_active=True
        ).exists()


class CanViewConfidential(BasePermission):
    """Pode ver documentos/processos confidenciais"""
    
    def has_permission(self, user, organization=None, office=None):
        from apps.memberships.models import Membership
        
        return Membership.objects.filter(
            user=user,
            organization=organization,
            role__in=['org_admin', 'office_admin', 'lawyer'],
            is_active=True
        ).exists()
    
    def has_object_permission(self, user, obj):
        """Verifica se pode ver este objeto espec√≠fico"""
        # Se n√£o √© confidencial, qualquer um pode ver
        if hasattr(obj, 'is_confidential') and not obj.is_confidential:
            return True
        
        # Se √© confidencial, precisa ser admin ou lawyer
        from apps.memberships.models import Membership
        return Membership.objects.filter(
            user=user,
            organization=obj.organization,
            role__in=['org_admin', 'office_admin', 'lawyer'],
            is_active=True
        ).exists()


# Helper function
def check_permission(user, permission_class, organization=None, office=None, obj=None):
    """
    Verifica permiss√£o de forma simples.
    
    Uso:
        if check_permission(request.user, CanManageCustomers, request.organization):
            # faz algo
    """
    permission = permission_class()
    
    if obj:
        return permission.has_object_permission(user, obj)
    else:
        return permission.has_permission(user, organization, office)

2. Decorators para Views
python

# apps/shared/decorators.py

from functools import wraps
from django.core.exceptions import PermissionDenied
from django.shortcuts import redirect

def organization_admin_required(view_func):
    """
    Decorator que exige Organization Admin.
    """
    @wraps(view_func)
    def wrapper(request, *args, **kwargs):
        if not request.user.is_authenticated:
            return redirect('admin:login')
        
        from apps.shared.permissions import IsOrganizationAdmin
        
        if not IsOrganizationAdmin().has_permission(
            request.user,
            request.organization
        ):
            raise PermissionDenied("Voc√™ n√£o tem permiss√£o para acessar esta p√°gina.")
        
        return view_func(request, *args, **kwargs)
    
    return wrapper


def office_admin_required(view_func):
    """
    Decorator que exige Office Admin ou Organization Admin.
    """
    @wraps(view_func)
    def wrapper(request, *args, **kwargs):
        if not request.user.is_authenticated:
            return redirect('admin:login')
        
        from apps.shared.permissions import IsOfficeAdmin
        
        if not IsOfficeAdmin().has_permission(
            request.user,
            request.organization,
            request.office
        ):
            raise PermissionDenied("Voc√™ n√£o tem permiss√£o para acessar esta p√°gina.")
        
        return view_func(request, *args, **kwargs)
    
    return wrapper


def permission_required(permission_class):
    """
    Decorator gen√©rico para permiss√µes customizadas.
    
    Uso:
        @permission_required(CanManageCustomers)
        def my_view(request):
            ...
    """
    def decorator(view_func):
        @wraps(view_func)
        def wrapper(request, *args, **kwargs):
            if not request.user.is_authenticated:
                return redirect('admin:login')
            
            permission = permission_class()
            if not permission.has_permission(
                request.user,
                request.organization,
                request.office
            ):
                raise PermissionDenied("Voc√™ n√£o tem permiss√£o.")
            
            return view_func(request, *args, **kwargs)
        return wrapper
    return decorator

3. Model de Auditoria
python

# apps/shared/models.py (adicionar)

class AuditLog(models.Model):
    """
    Log de auditoria de todas as a√ß√µes no sistema.
    Registra quem fez o qu√™ e quando.
    """
    
    ACTION_CHOICES = [
        ('create', 'Criar'),
        ('update', 'Atualizar'),
        ('delete', 'Deletar'),
        ('view', 'Visualizar'),
        ('download', 'Download'),
        ('login', 'Login'),
        ('logout', 'Logout'),
    ]
    
    # Quem
    user = models.ForeignKey(
        'accounts.User',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='audit_logs',
        verbose_name='Usu√°rio'
    )
    
    # Onde
    organization = models.ForeignKey(
        'organizations.Organization',
        on_delete=models.CASCADE,
        related_name='audit_logs',
        verbose_name='Organiza√ß√£o'
    )
    
    office = models.ForeignKey(
        'offices.Office',
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='audit_logs',
        verbose_name='Escrit√≥rio'
    )
    
    # O qu√™
    action = models.CharField(
        'A√ß√£o',
        max_length=20,
        choices=ACTION_CHOICES
    )
    
    model_name = models.CharField(
        'Model',
        max_length=100,
        help_text='Nome do model afetado'
    )
    
    object_id = models.PositiveIntegerField(
        'ID do Objeto',
        null=True,
        blank=True
    )
    
    object_repr = models.CharField(
        'Representa√ß√£o do Objeto',
        max_length=255,
        blank=True,
        help_text='String representation do objeto'
    )
    
    # Detalhes
    changes = models.JSONField(
        'Altera√ß√µes',
        default=dict,
        blank=True,
        help_text='Detalhes das altera√ß√µes (antes/depois)'
    )
    
    ip_address = models.GenericIPAddressField(
        'IP',
        null=True,
        blank=True
    )
    
    user_agent = models.TextField(
        'User Agent',
        blank=True
    )
    
    # Quando
    timestamp = models.DateTimeField(
        'Data/Hora',
        auto_now_add=True,
        db_index=True
    )
    
    class Meta:
        verbose_name = 'Log de Auditoria'
        verbose_name_plural = 'Logs de Auditoria'
        ordering = ['-timestamp']
        indexes = [
            models.Index(fields=['organization', 'timestamp']),
            models.Index(fields=['user', 'timestamp']),
            models.Index(fields=['model_name', 'object_id']),
        ]
    
    def __str__(self):
        return f"{self.user} - {self.get_action_display()} - {self.model_name} - {self.timestamp}"

Quer que eu continue com:

    Testes de isolamento
    Sistema de auditoria autom√°tica
    Admin para AuditLog

Ou prefere revisar isso primeiro? üöÄ

fiz tudo o que acabou de mandar. vamos continuar?
13:28
üöÄ Continuando Fase 3 - Controle de Acesso

Perfeito! Agora vamos implementar o restante:
üìù PASSO 2: Sistema de Auditoria Autom√°tica
1. Signals para Auditoria Autom√°tica
python

# apps/shared/signals.py

from django.db.models.signals import post_save, post_delete, pre_save
from django.dispatch import receiver
from django.contrib.contenttypes.models import ContentType
from apps.shared.models import AuditLog
import json

# Lista de models que devem ser auditados
AUDITED_MODELS = [
    'Customer',
    'Process',
    'ProcessParty',
    'Deadline',
    'Document',
    'Organization',
    'Office',
    'Membership',
]


def get_request():
    """
    Pega o request atual do thread local.
    Ser√° configurado no middleware.
    """
    import threading
    return getattr(threading.current_thread(), 'request', None)


def get_changes(instance, old_instance=None):
    """
    Calcula as mudan√ßas entre vers√µes do objeto.
    """
    if not old_instance:
        return {'action': 'created'}
    
    changes = {}
    for field in instance._meta.fields:
        field_name = field.name
        
        # Pula campos de auditoria
        if field_name in ['created_at', 'updated_at', 'id']:
            continue
        
        old_value = getattr(old_instance, field_name, None)
        new_value = getattr(instance, field_name, None)
        
        # Serializa valores complexos
        if hasattr(old_value, 'pk'):
            old_value = str(old_value)
        if hasattr(new_value, 'pk'):
            new_value = str(new_value)
        
        if old_value != new_value:
            changes[field_name] = {
                'old': str(old_value) if old_value is not None else None,
                'new': str(new_value) if new_value is not None else None,
            }
    
    return changes


@receiver(post_save)
def audit_post_save(sender, instance, created, **kwargs):
    """
    Audita cria√ß√£o e atualiza√ß√£o de objetos.
    """
    # Verifica se √© um model auditado
    if sender.__name__ not in AUDITED_MODELS:
        return
    
    # Verifica se tem AuditLog (evita loop infinito)
    if sender.__name__ == 'AuditLog':
        return
    
    # Pega o request
    request = get_request()
    if not request or not request.user.is_authenticated:
        return
    
    # Pega organiza√ß√£o e office
    organization = getattr(request, 'organization', None)
    office = getattr(request, 'office', None)
    
    # Se o objeto tem organization, usa ela
    if hasattr(instance, 'organization'):
        organization = instance.organization
    if hasattr(instance, 'office'):
        office = instance.office
    
    if not organization:
        return
    
    # Determina a a√ß√£o
    action = 'create' if created else 'update'
    
    # Calcula mudan√ßas (para updates)
    changes = {}
    if not created and hasattr(instance, '_old_instance'):
        changes = get_changes(instance, instance._old_instance)
    
    # IP do usu√°rio
    ip_address = request.META.get('REMOTE_ADDR')
    user_agent = request.META.get('HTTP_USER_AGENT', '')
    
    # Cria log
    try:
        AuditLog.objects.create(
            user=request.user,
            organization=organization,
            office=office,
            action=action,
            model_name=sender.__name__,
            object_id=instance.pk,
            object_repr=str(instance)[:255],
            changes=changes,
            ip_address=ip_address,
            user_agent=user_agent[:500] if user_agent else ''
        )
    except Exception as e:
        # N√£o falha a opera√ß√£o principal se auditoria falhar
        print(f"Erro ao criar audit log: {e}")


@receiver(post_delete)
def audit_post_delete(sender, instance, **kwargs):
    """
    Audita dele√ß√£o de objetos.
    """
    # Verifica se √© um model auditado
    if sender.__name__ not in AUDITED_MODELS:
        return
    
    if sender.__name__ == 'AuditLog':
        return
    
    request = get_request()
    if not request or not request.user.is_authenticated:
        return
    
    organization = getattr(request, 'organization', None)
    office = getattr(request, 'office', None)
    
    if hasattr(instance, 'organization'):
        organization = instance.organization
    if hasattr(instance, 'office'):
        office = instance.office
    
    if not organization:
        return
    
    ip_address = request.META.get('REMOTE_ADDR')
    user_agent = request.META.get('HTTP_USER_AGENT', '')
    
    try:
        AuditLog.objects.create(
            user=request.user,
            organization=organization,
            office=office,
            action='delete',
            model_name=sender.__name__,
            object_id=instance.pk,
            object_repr=str(instance)[:255],
            ip_address=ip_address,
            user_agent=user_agent[:500] if user_agent else ''
        )
    except Exception as e:
        print(f"Erro ao criar audit log: {e}")


@receiver(pre_save)
def store_old_instance(sender, instance, **kwargs):
    """
    Armazena vers√£o antiga do objeto antes de salvar (para detectar mudan√ßas).
    """
    if sender.__name__ not in AUDITED_MODELS:
        return
    
    if sender.__name__ == 'AuditLog':
        return
    
    if instance.pk:
        try:
            instance._old_instance = sender.objects.get(pk=instance.pk)
        except sender.DoesNotExist:
            instance._old_instance = None
    else:
        instance._old_instance = None

2. Middleware para Request no Thread
python

# apps/shared/middleware.py (atualizar)

from apps.memberships.models import Membership
import threading

class OrganizationMiddleware:
    """
    Middleware que injeta organiza√ß√£o e escrit√≥rio no request.
    """
    
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # Inicializa como None
        request.organization = None
        request.office = None
        request.membership = None
        
        # Se usu√°rio est√° autenticado
        if request.user.is_authenticated:
            membership = Membership.objects.filter(
                user=request.user,
                is_active=True
            ).select_related('organization', 'office').first()
            
            if membership:
                request.organization = membership.organization
                request.office = membership.office
                request.membership = membership
        
        # ‚≠ê Adicionar request no thread local (para signals)
        threading.current_thread().request = request
        
        response = self.get_response(request)
        
        # Limpar request do thread
        if hasattr(threading.current_thread(), 'request'):
            delattr(threading.current_thread(), 'request')
        
        return response

3. Ativar Signals
python

# apps/shared/apps.py

from django.apps import AppConfig

class SharedConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.shared'
    verbose_name = 'Compartilhado'
    
    def ready(self):
        """Importa signals quando o app est√° pronto"""
        import apps.shared.signals  # ‚Üê Adicionar

4. Admin para AuditLog
python

# apps/shared/admin.py

from django.contrib import admin
from django.utils.html import format_html
from django.utils.safestring import mark_safe
import json
from .models import AuditLog

@admin.register(AuditLog)
class AuditLogAdmin(admin.ModelAdmin):
    """
    Admin para visualizar logs de auditoria.
    Somente leitura.
    """
    list_display = [
        'timestamp',
        'user',
        'action_badge',
        'model_name',
        'object_repr',
        'organization',
        'office',
        'ip_address'
    ]
    
    list_filter = [
        'action',
        'model_name',
        'organization',
        'office',
        'timestamp',
        'user'
    ]
    
    search_fields = [
        'user__email',
        'user__first_name',
        'user__last_name',
        'object_repr',
        'ip_address'
    ]
    
    readonly_fields = [
        'user',
        'organization',
        'office',
        'action',
        'model_name',
        'object_id',
        'object_repr',
        'changes_formatted',
        'ip_address',
        'user_agent',
        'timestamp'
    ]
    
    fieldsets = (
        ('Quem', {
            'fields': ('user', 'ip_address', 'user_agent')
        }),
        ('Onde', {
            'fields': ('organization', 'office')
        }),
        ('O qu√™', {
            'fields': ('action', 'model_name', 'object_id', 'object_repr')
        }),
        ('Detalhes', {
            'fields': ('changes_formatted',)
        }),
        ('Quando', {
            'fields': ('timestamp',)
        }),
    )
    
    date_hierarchy = 'timestamp'
    
    # Somente leitura - n√£o permite edi√ß√£o
    def has_add_permission(self, request):
        return False
    
    def has_change_permission(self, request, obj=None):
        return False
    
    def has_delete_permission(self, request, obj=None):
        # Apenas superuser pode deletar logs
        return request.user.is_superuser
    
    def action_badge(self, obj):
        """Badge colorido para a√ß√£o"""
        colors = {
            'create': '#28a745',
            'update': '#ffc107',
            'delete': '#dc3545',
            'view': '#0d6efd',
            'download': '#6c757d',
            'login': '#0dcaf0',
            'logout': '#6c757d',
        }
        color = colors.get(obj.action, '#6c757d')
        
        return format_html(
            '<span style="background-color: {}; color: white; padding: 3px 10px; border-radius: 3px; font-weight: bold;">{}</span>',
            color,
            obj.get_action_display()
        )
    action_badge.short_description = 'A√ß√£o'
    
    def changes_formatted(self, obj):
        """Formata JSON de mudan√ßas de forma leg√≠vel"""
        if not obj.changes:
            return '-'
        
        try:
            html = '<table style="width: 100%; border-collapse: collapse;">'
            html += '<tr style="background: #f8f9fa;"><th style="padding: 8px; text-align: left;">Campo</th><th style="padding: 8px; text-align: left;">Antes</th><th style="padding: 8px; text-align: left;">Depois</th></tr>'
            
            for field, change in obj.changes.items():
                if field == 'action':
                    continue
                
                old = change.get('old', '-')
                new = change.get('new', '-')
                
                html += f'<tr style="border-bottom: 1px solid #dee2e6;">'
                html += f'<td style="padding: 8px;"><strong>{field}</strong></td>'
                html += f'<td style="padding: 8px; color: #dc3545;">{old}</td>'
                html += f'<td style="padding: 8px; color: #28a745;">{new}</td>'
                html += '</tr>'
            
            html += '</table>'
            return mark_safe(html)
        except:
            return format_html('<pre>{}</pre>', json.dumps(obj.changes, indent=2))
    
    changes_formatted.short_description = 'Altera√ß√µes'

5. Registrar Shared App Config
python

# apps/shared/__init__.py

default_app_config = 'apps.shared.apps.SharedConfig'

üìù PASSO 3: Testes de Isolamento
python

# apps/shared/tests.py (atualizar)

from django.test import TestCase, RequestFactory
from apps.accounts.models import User
from apps.organizations.models import Organization
from apps.offices.models import Office
from apps.memberships.models import Membership
from apps.customers.models import Customer
from apps.processes.models import Process
from apps.shared.middleware import OrganizationMiddleware

class IsolationTest(TestCase):
    """
    Testa isolamento de dados entre organiza√ß√µes.
    """
    
    def setUp(self):
        # Criar 2 organiza√ß√µes diferentes
        self.org1 = Organization.objects.create(
            name='Org 1',
            document='11111111111111'
        )
        
        self.org2 = Organization.objects.create(
            name='Org 2',
            document='22222222222222'
        )
        
        # Criar offices
        self.office1 = Office.objects.create(
            organization=self.org1,
            name='Office 1'
        )
        
        self.office2 = Office.objects.create(
            organization=self.org2,
            name='Office 2'
        )
        
        # Criar usu√°rios
        self.user1 = User.objects.create_user(
            username='user1',
            email='user1@test.com',
            password='test123'
        )
        
        self.user2 = User.objects.create_user(
            username='user2',
            email='user2@test.com',
            password='test123'
        )
        
        # Criar memberships
        self.membership1 = Membership.objects.create(
            user=self.user1,
            organization=self.org1,
            office=self.office1,
            role='lawyer'
        )
        
        self.membership2 = Membership.objects.create(
            user=self.user2,
            organization=self.org2,
            office=self.office2,
            role='lawyer'
        )
        
        # Criar dados
        self.customer1 = Customer.objects.create(
            organization=self.org1,
            office=self.office1,
            name='Customer 1',
            document='11111111111',
            type='PF'
        )
        
        self.customer2 = Customer.objects.create(
            organization=self.org2,
            office=self.office2,
            name='Customer 2',
            document='22222222222',
            type='PF'
        )
        
        self.factory = RequestFactory()
    
    def test_customer_isolation(self):
        """Testa se customers est√£o isolados por organiza√ß√£o"""
        # Org 1 n√£o v√™ customers da Org 2
        customers_org1 = Customer.objects.filter(organization=self.org1)
        self.assertEqual(customers_org1.count(), 1)
        self.assertEqual(customers_org1.first(), self.customer1)
        
        # Org 2 n√£o v√™ customers da Org 1
        customers_org2 = Customer.objects.filter(organization=self.org2)
        self.assertEqual(customers_org2.count(), 1)
        self.assertEqual(customers_org2.first(), self.customer2)
    
    def test_manager_for_request(self):
        """Testa se manager for_request filtra corretamente"""
        # Simular request do user1
        request = self.factory.get('/')
        request.user = self.user1
        request.organization = self.org1
        request.office = self.office1
        
        # S√≥ deve ver customers da sua org
        customers = Customer.objects.for_request(request)
        self.assertEqual(customers.count(), 1)
        self.assertEqual(customers.first(), self.customer1)
    
    def test_cannot_access_other_org_data(self):
        """Testa que n√£o consegue acessar dados de outra org"""
        # User 1 tenta acessar customer da org 2
        with self.assertRaises(Customer.DoesNotExist):
            Customer.objects.get(
                organization=self.org1,
                pk=self.customer2.pk
            )
    
    def test_unique_document_per_organization(self):
        """Testa que o mesmo documento pode existir em orgs diferentes"""
        # Mesmo CPF em organiza√ß√µes diferentes (deve funcionar)
        customer3 = Customer.objects.create(
            organization=self.org2,
            office=self.office2,
            name='Customer 3',
            document='11111111111',  # Mesmo CPF do customer1
            type='PF'
        )
        
        self.assertEqual(
            Customer.objects.filter(document='11111111111').count(),
            2
        )
        
        # Mas n√£o pode ter o mesmo CPF na mesma org
        from django.db import IntegrityError
        with self.assertRaises(IntegrityError):
            Customer.objects.create(
                organization=self.org1,
                office=self.office1,
                name='Customer Duplicado',
                document='11111111111',  # Duplicado na org1
                type='PF'
            )


class PermissionTest(TestCase):
    """
    Testa sistema de permiss√µes.
    """
    
    def setUp(self):
        self.org = Organization.objects.create(
            name='Test Org',
            document='12345678000190'
        )
        
        self.office = Office.objects.create(
            organization=self.org,
            name='Test Office'
        )
        
        # Criar usu√°rios com diferentes roles
        self.org_admin = User.objects.create_user(
            username='org_admin',
            email='org_admin@test.com',
            password='test123'
        )
        
        self.lawyer = User.objects.create_user(
            username='lawyer',
            email='lawyer@test.com',
            password='test123'
        )
        
        self.intern = User.objects.create_user(
            username='intern',
            email='intern@test.com',
            password='test123'
        )
        
        # Criar memberships
        Membership.objects.create(
            user=self.org_admin,
            organization=self.org,
            office=self.office,
            role='org_admin'
        )
        
        Membership.objects.create(
            user=self.lawyer,
            organization=self.org,
            office=self.office,
            role='lawyer'
        )
        
        Membership.objects.create(
            user=self.intern,
            organization=self.org,
            office=self.office,
            role='intern'
        )
    
    def test_organization_admin_permission(self):
        """Testa permiss√£o de Organization Admin"""
        from apps.shared.permissions import IsOrganizationAdmin
        
        permission = IsOrganizationAdmin()
        
        # Org admin tem permiss√£o
        self.assertTrue(
            permission.has_permission(self.org_admin, self.org)
        )
        
        # Lawyer n√£o tem
        self.assertFalse(
            permission.has_permission(self.lawyer, self.org)
        )
        
        # Intern n√£o tem
        self.assertFalse(
            permission.has_permission(self.intern, self.org)
        )
    
    def test_can_manage_customers(self):
        """Testa permiss√£o para gerenciar clientes"""
        from apps.shared.permissions import CanManageCustomers
        
        permission = CanManageCustomers()
        
        # Org admin pode
        self.assertTrue(
            permission.has_permission(self.org_admin, self.org)
        )
        
        # Lawyer pode
        self.assertTrue(
            permission.has_permission(self.lawyer, self.org)
        )
        
        # Intern n√£o pode
        self.assertFalse(
            permission.has_permission(self.intern, self.org)
        )

‚öôÔ∏è Configura√ß√µes Finais
1. Migrations
bash

python manage.py makemigrations
python manage.py migrate

2. Rodar Testes
bash

# Rodar todos os testes
python manage.py test

# Rodar s√≥ testes de isolamento
python manage.py test apps.shared.tests.IsolationTest

# Rodar s√≥ testes de permiss√µes
python manage.py test apps.shared.tests.PermissionTest

‚úÖ Checklist Fase 3

    Permissions criadas
    Decorators criados
    AuditLog model criado
    Signals de auditoria criados
    Middleware atualizado
    Admin de AuditLog registrado
    Testes de isolamento criados
    Testes de permiss√µes criados
    Migrations aplicadas
    Testes passando

Implementa tudo isso e me avisa quando rodar os testes! A√≠ marcamos Fase 3 como completa e partimos para Fase 4 (Financeiro). üöÄ

e ent√£o? vamos seguir? ja fiz tudo o que voce pediu.
18:15
üéâ FASE 3 COMPLETA! Parab√©ns!

Excelente! Antes de partir para a Fase 4, vou fazer uma verifica√ß√£o r√°pida.
üß™ Valida√ß√£o R√°pida
1. Os testes passaram?
bash

python manage.py test apps.shared
```

**Resultado esperado:**
```
Found X test(s).
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..........
----------------------------------------------------------------------
Ran X tests in X.XXXs

OK
```

Se os testes passaram ‚úÖ, est√° perfeito!

---

## ‚úÖ Checklist Final Fase 3
```
‚úÖ Fase 3: Controle de Acesso - 100% COMPLETA

‚îú‚îÄ‚îÄ ‚úÖ Sistema de Permiss√µes por Role
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ BasePermission
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ IsOrganizationAdmin
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ IsOfficeAdmin
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ CanManageCustomers
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ CanManageProcesses
‚îÇ   ‚îî‚îÄ‚îÄ ‚úÖ CanViewConfidential
‚îÇ
‚îú‚îÄ‚îÄ ‚úÖ Decorators
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ organization_admin_required
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ office_admin_required
‚îÇ   ‚îî‚îÄ‚îÄ ‚úÖ permission_required
‚îÇ
‚îú‚îÄ‚îÄ ‚úÖ Auditoria B√°sica
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ AuditLog model
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ Signals autom√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ Admin somente leitura
‚îÇ   ‚îî‚îÄ‚îÄ ‚úÖ Tracking de mudan√ßas
‚îÇ
‚îî‚îÄ‚îÄ ‚úÖ Testes de Isolamento
    ‚îú‚îÄ‚îÄ ‚úÖ IsolationTest
    ‚îî‚îÄ‚îÄ ‚úÖ PermissionTest
```

---

## üìä PROGRESSO TOTAL MVP
```
‚úÖ Fase 1: Funda√ß√£o Multi-tenant (100%)
‚úÖ Fase 2: Jur√≠dico B√°sico (100%)
‚úÖ Fase 3: Controle de Acesso (100%)
‚¨ú Fase 4: Financeiro B√°sico (0%)

PROGRESSO GERAL MVP: 75% üöÄ

üéØ FASE 4: FINANCEIRO B√ÅSICO (√öltima Fase!)

Agora vamos criar o m√≥dulo financeiro para gerenciar:

    Contratos de honor√°rios
    Controle de recebimentos
    Vincula√ß√£o processo ‚Üí honor√°rio
    Notas fiscais/recibos

üìù PASSO 1: Fee Agreement (Contratos de Honor√°rios)
1. Model FeeAgreement
python

# apps/finance/models.py

from django.db import models
from apps.shared.models import OrganizationScopedModel
from apps.shared.managers import OrganizationScopedManager
from apps.customers.models import Customer
from apps.processes.models import Process
from decimal import Decimal

class FeeAgreement(OrganizationScopedModel):
    """
    Contrato de honor√°rios com cliente.
    Define como e quanto o cliente vai pagar.
    """
    
    TYPE_CHOICES = [
        ('fixed', 'Valor Fixo'),
        ('hourly', 'Por Hora'),
        ('success', 'Por √äxito'),
        ('monthly', 'Mensalidade'),
        ('percentage', 'Percentual'),
        ('hybrid', 'H√≠brido'),
    ]
    
    STATUS_CHOICES = [
        ('draft', 'Rascunho'),
        ('active', 'Ativo'),
        ('suspended', 'Suspenso'),
        ('completed', 'Conclu√≠do'),
        ('cancelled', 'Cancelado'),
    ]
    
    # ===== RELACIONAMENTOS =====
    customer = models.ForeignKey(
        Customer,
        on_delete=models.CASCADE,
        related_name='fee_agreements',
        verbose_name='Cliente'
    )
    
    process = models.ForeignKey(
        Process,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='fee_agreements',
        verbose_name='Processo',
        help_text='Processo vinculado (opcional)'
    )
    
    # ===== INFORMA√á√ïES B√ÅSICAS =====
    title = models.CharField(
        'T√≠tulo',
        max_length=255,
        help_text='Ex: Contrato de Honor√°rios - A√ß√£o Trabalhista'
    )
    
    type = models.CharField(
        'Tipo',
        max_length=20,
        choices=TYPE_CHOICES,
        default='fixed'
    )
    
    description = models.TextField(
        'Descri√ß√£o',
        blank=True,
        help_text='Detalhes do contrato'
    )
    
    # ===== VALORES =====
    amount = models.DecimalField(
        'Valor',
        max_digits=15,
        decimal_places=2,
        help_text='Valor do honor√°rio em R$'
    )
    
    success_percentage = models.DecimalField(
        'Percentual √äxito',
        max_digits=5,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='Percentual sobre o valor obtido (para √™xito)'
    )
    
    hourly_rate = models.DecimalField(
        'Valor Hora',
        max_digits=10,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='Valor por hora trabalhada'
    )
    
    # ===== PARCELAMENTO =====
    installments = models.PositiveIntegerField(
        'Parcelas',
        default=1,
        help_text='Quantidade de parcelas'
    )
    
    installment_amount = models.DecimalField(
        'Valor da Parcela',
        max_digits=15,
        decimal_places=2,
        null=True,
        blank=True,
        help_text='Valor de cada parcela (calculado automaticamente)'
    )
    
    # ===== DATAS =====
    start_date = models.DateField(
        'Data de In√≠cio',
        help_text='Data de in√≠cio do contrato'
    )
    
    end_date = models.DateField(
        'Data de T√©rmino',
        null=True,
        blank=True,
        help_text='Data de t√©rmino (opcional)'
    )
    
    # ===== STATUS =====
    status = models.CharField(
        'Status',
        max_length=20,
        choices=STATUS_CHOICES,
        default='draft'
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True,
        help_text='Anota√ß√µes internas'
    )
    
    # ===== ARQUIVOS =====
    contract_file = models.FileField(
        'Arquivo do Contrato',
        upload_to='contracts/%Y/%m/',
        null=True,
        blank=True,
        help_text='PDF do contrato assinado'
    )
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Contrato de Honor√°rios'
        verbose_name_plural = 'Contratos de Honor√°rios'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['customer']),
            models.Index(fields=['status']),
            models.Index(fields=['start_date']),
        ]
    
    def __str__(self):
        return f"{self.title} - {self.customer.name}"
    
    def save(self, *args, **kwargs):
        """Calcula valor da parcela automaticamente"""
        if self.amount and self.installments:
            self.installment_amount = self.amount / Decimal(self.installments)
        super().save(*args, **kwargs)
    
    @property
    def total_received(self):
        """Total j√° recebido"""
        from apps.finance.models import Payment
        return Payment.objects.filter(
            fee_agreement=self,
            status='received'
        ).aggregate(
            total=models.Sum('amount')
        )['total'] or Decimal('0.00')
    
    @property
    def total_pending(self):
        """Total ainda pendente"""
        return self.amount - self.total_received
    
    @property
    def percentage_received(self):
        """Percentual recebido"""
        if self.amount > 0:
            return (self.total_received / self.amount) * 100
        return 0
    
    @property
    def is_fully_paid(self):
        """Verifica se est√° totalmente pago"""
        return self.total_received >= self.amount

2. Model Payment (Pagamentos)
python

# apps/finance/models.py (continua)

class Payment(OrganizationScopedModel):
    """
    Registro de pagamento de honor√°rios.
    """
    
    METHOD_CHOICES = [
        ('cash', 'Dinheiro'),
        ('debit', 'D√©bito'),
        ('credit', 'Cr√©dito'),
        ('pix', 'PIX'),
        ('bank_transfer', 'Transfer√™ncia Banc√°ria'),
        ('check', 'Cheque'),
        ('other', 'Outro'),
    ]
    
    STATUS_CHOICES = [
        ('pending', 'Pendente'),
        ('received', 'Recebido'),
        ('cancelled', 'Cancelado'),
        ('refunded', 'Estornado'),
    ]
    
    # ===== RELACIONAMENTOS =====
    fee_agreement = models.ForeignKey(
        FeeAgreement,
        on_delete=models.CASCADE,
        related_name='payments',
        verbose_name='Contrato'
    )
    
    # ===== INFORMA√á√ïES =====
    description = models.CharField(
        'Descri√ß√£o',
        max_length=255,
        help_text='Ex: Parcela 1/12, Honor√°rio Inicial, etc'
    )
    
    amount = models.DecimalField(
        'Valor',
        max_digits=15,
        decimal_places=2,
        help_text='Valor do pagamento em R$'
    )
    
    # ===== DATAS =====
    due_date = models.DateField(
        'Data de Vencimento',
        help_text='Data de vencimento do pagamento'
    )
    
    payment_date = models.DateField(
        'Data de Pagamento',
        null=True,
        blank=True,
        help_text='Data em que foi efetivamente pago'
    )
    
    # ===== M√âTODO E STATUS =====
    payment_method = models.CharField(
        'Forma de Pagamento',
        max_length=20,
        choices=METHOD_CHOICES,
        default='pix'
    )
    
    status = models.CharField(
        'Status',
        max_length=20,
        choices=STATUS_CHOICES,
        default='pending'
    )
    
    # ===== COMPROVANTE =====
    receipt_file = models.FileField(
        'Comprovante',
        upload_to='receipts/%Y/%m/',
        null=True,
        blank=True,
        help_text='Comprovante de pagamento'
    )
    
    # ===== OBSERVA√á√ïES =====
    notes = models.TextField(
        'Observa√ß√µes',
        blank=True
    )
    
    # Manager customizado
    objects = OrganizationScopedManager()
    
    class Meta:
        verbose_name = 'Pagamento'
        verbose_name_plural = 'Pagamentos'
        ordering = ['due_date']
        indexes = [
            models.Index(fields=['organization', 'office']),
            models.Index(fields=['fee_agreement']),
            models.Index(fields=['status']),
            models.Index(fields=['due_date']),
        ]
    
    def __str__(self):
        return f"{self.description} - R$ {self.amount}"
    
    @property
    def is_overdue(self):
        """Verifica se est√° atrasado"""
        from django.utils import timezone
        if self.status in ['received', 'cancelled', 'refunded']:
            return False
        return timezone.now().date() > self.due_date
    
    @property
    def days_overdue(self):
        """Dias de atraso"""
        from django.utils import timezone
        if not self.is_overdue:
            return 0
        delta = timezone.now().date() - self.due_date
        return delta.days
    
    def mark_as_received(self, payment_date=None):
        """Marca como recebido"""
        from django.utils import timezone
        self.status = 'received'
        self.payment_date = payment_date or timezone.now().date()
        self.save()

üé® Admin Finance
python

# apps/finance/admin.py

from django.contrib import admin
from django.utils.html import format_html
from django.utils import timezone
from .models import FeeAgreement, Payment

class PaymentInline(admin.TabularInline):
    """
    Inline para gerenciar pagamentos dentro do contrato.
    """
    model = Payment
    extra = 0
    fields = ['description', 'amount', 'due_date', 'payment_date', 'payment_method', 'status']
    readonly_fields = []

@admin.register(FeeAgreement)
class FeeAgreementAdmin(admin.ModelAdmin):
    """
    Admin para contratos de honor√°rios.
    """
    list_display = [
        'title',
        'customer',
        'type',
        'amount',
        'progress_bar',
        'status_badge',
        'start_date',
        'created_at'
    ]
    
    list_filter = [
        'type',
        'status',
        'organization',
        'office',
        'start_date',
        'created_at'
    ]
    
    search_fields = [
        'title',
        'customer__name',
        'process__number',
        'description'
    ]
    
    readonly_fields = [
        'created_at',
        'updated_at',
        'installment_amount',
        'total_received',
        'total_pending',
        'percentage_received',
        'is_fully_paid'
    ]
    
    fieldsets = (
        ('Organiza√ß√£o', {
            'fields': ('organization', 'office')
        }),
        ('Relacionamentos', {
            'fields': ('customer', 'process')
        }),
        ('Informa√ß√µes B√°sicas', {
            'fields': ('title', 'type', 'description')
        }),
        ('Valores', {
            'fields': (
                'amount',
                'success_percentage',
                'hourly_rate',
                'installments',
                'installment_amount'
            )
        }),
        ('Per√≠odo', {
            'fields': ('start_date', 'end_date')
        }),
        ('Status', {
            'fields': ('status',)
        }),
        ('Estat√≠sticas', {
            'fields': (
                'total_received',
                'total_pending',
                'percentage_received',
                'is_fully_paid'
            ),
            'classes': ('collapse',)
        }),
        ('Arquivo', {
            'fields': ('contract_file',),
            'classes': ('collapse',)
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
        ('Datas', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    autocomplete_fields = ['customer', 'process']
    
    inlines = [PaymentInline]
    
    actions = ['activate_agreements', 'suspend_agreements']
    
    def status_badge(self, obj):
        """Badge colorido para status"""
        colors = {
            'draft': '#6c757d',
            'active': '#28a745',
            'suspended': '#ffc107',
            'completed': '#0d6efd',
            'cancelled': '#dc3545',
        }
        color = colors.get(obj.status, '#6c757d')
        
        return format_html(
            '<span style="background-color: {}; color: white; padding: 3px 10px; border-radius: 3px;">{}</span>',
            color,
            obj.get_status_display()
        )
    status_badge.short_description = 'Status'
    
    def progress_bar(self, obj):
        """Barra de progresso de pagamento"""
        percentage = obj.percentage_received
        color = '#28a745' if percentage >= 100 else '#ffc107' if percentage >= 50 else '#dc3545'
        
        return format_html(
            '<div style="width: 100px; background: #e9ecef; border-radius: 3px; overflow: hidden;">'
            '<div style="width: {}%; background: {}; color: white; text-align: center; padding: 2px; font-size: 10px; font-weight: bold;">'
            '{}%'
            '</div>'
            '</div>',
            min(percentage, 100),
            color,
            int(percentage)
        )
    progress_bar.short_description = 'Progresso'
    
    def activate_agreements(self, request, queryset):
        count = queryset.update(status='active')
        self.message_user(request, f'{count} contrato(s) ativado(s).')
    activate_agreements.short_description = 'Ativar contratos'
    
    def suspend_agreements(self, request, queryset):
        count = queryset.update(status='suspended')
        self.message_user(request, f'{count} contrato(s) suspenso(s).')
    suspend_agreements.short_description = 'Suspender contratos'


@admin.register(Payment)
class PaymentAdmin(admin.ModelAdmin):
    """
    Admin para pagamentos.
    """
    list_display = [
        'description',
        'fee_agreement',
        'amount',
        'due_date',
        'payment_date',
        'status_badge',
        'overdue_badge',
        'payment_method'
    ]
    
    list_filter = [
        'status',
        'payment_method',
        'organization',
        'office',
        'due_date',
        'payment_date'
    ]
    
    search_fields = [
        'description',
        'fee_agreement__title',
        'fee_agreement__customer__name'
    ]
    
    readonly_fields = [
        'created_at',
        'updated_at',
        'is_overdue',
        'days_overdue'
    ]
    
    fieldsets = (
        ('Organiza√ß√£o', {
            'fields': ('organization', 'office')
        }),
        ('Contrato', {
            'fields': ('fee_agreement',)
        }),
        ('Informa√ß√µes', {
            'fields': ('description', 'amount')
        }),
        ('Datas', {
            'fields': ('due_date', 'payment_date')
        }),
        ('Pagamento', {
            'fields': ('payment_method', 'status')
        }),
        ('Comprovante', {
            'fields': ('receipt_file',),
            'classes': ('collapse',)
        }),
        ('Informa√ß√µes Adicionais', {
            'fields': ('is_overdue', 'days_overdue', 'created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
        ('Observa√ß√µes', {
            'fields': ('notes',),
            'classes': ('collapse',)
        }),
    )
    
    autocomplete_fields = ['fee_agreement']
    
    date_hierarchy = 'due_date'
    
    actions = ['mark_as_received', 'mark_as_pending']
    
    def status_badge(self, obj):
        """Badge para status"""
        colors = {
            'pending': '#ffc107',
            'received': '#28a745',
            'cancelled': '#6c757d',
            'refunded': '#dc3545',
        }
        color = colors.get(obj.status, '#6c757d')
        
        return format_html(
            '<span style="background-color: {}; color: white; padding: 3px 10px; border-radius: 3px;">{}</span>',
            color,
            obj.get_status_display()
        )
    status_badge.short_description = 'Status'
    
    def overdue_badge(self, obj):
        """Badge de atraso"""
        if not obj.is_overdue:
            return format_html('<span style="color: #28a745;">‚úì Em dia</span>')
        
        return format_html(
            '<span style="color: #dc3545; font-weight: bold;">‚ö† {} dias</span>',
            obj.days_overdue
        )
    overdue_badge.short_description = 'Atraso'
    
    def mark_as_received(self, request, queryset):
        for payment in queryset:
            payment.mark_as_received()
        count = queryset.count()
        self.message_user(request, f'{count} pagamento(s) marcado(s) como recebido(s).')
    mark_as_received.short_description = 'Marcar como recebido'
    
    def mark_as_pending(self, request, queryset):
        count = queryset.update(status='pending', payment_date=None)
        self.message_user(request, f'{count} pagamento(s) marcado(s) como pendente(s).')
    mark_as_pending.short_description = 'Marcar como pendente'

Quer que eu continue com as configura√ß√µes finais (apps.py, jazzmin, migrations) ou prefere revisar isso primeiro? üöÄ

n√£o precisa, s√≥ me dia de forma breve, ainda falta fazer x, y e z dessa, dessa e dessa forma para terminar a parte financeira, e eu mesmo implemento. vamos seguir em frente. essa era a ultima fase do mvp basico, certo? agora vem o que? a implementa√ß√£o da interface do usuario e dos administradores de organiza√ß√£o/escritorios??
18:34
üéØ RESUMO R√ÅPIDO - Para Terminar Financeiro
‚úÖ Falta Fazer:
1. Apps Config
python

# apps/finance/apps.py
verbose_name = 'Financeiro'

2. Jazzmin Icons
python

"finance": "fas fa-dollar-sign",
"finance.FeeAgreement": "fas fa-file-contract",
"finance.Payment": "fas fa-money-bill-wave",

3. Migrations
bash

python manage.py makemigrations
python manage.py migrate
```

### **4. Testar no Admin**
- Criar 1 contrato de honor√°rios
- Criar 2-3 pagamentos (parcelas)
- Ver barra de progresso funcionando

---

# üéâ SIM! MVP BACKEND COMPLETO!
```
‚úÖ Fase 1: Funda√ß√£o Multi-tenant (100%)
‚úÖ Fase 2: Jur√≠dico B√°sico (100%)
‚úÖ Fase 3: Controle de Acesso (100%)
‚úÖ Fase 4: Financeiro B√°sico (100%)

üéä MVP BACKEND: 100% COMPLETO! üéä

üöÄ PR√ìXIMOS PASSOS - API + FRONTEND

Agora voc√™ tem 2 caminhos:
OP√á√ÉO A: API REST (Django REST Framework) ‚≠ê RECOMENDADO

Criar API para o painel do cliente (Organization Admin + Advogados)
O que fazer:

    Instalar DRF

bash

   pip install djangorestframework djangorestframework-simplejwt
```

2. **Criar Serializers** (Customer, Process, Deadline, Document, Finance)

3. **Criar ViewSets** (CRUD completo)

4. **Implementar Permiss√µes DRF** (usar suas classes de permission)

5. **JWT Authentication** (login via API)

6. **Endpoints principais:**
   - `/api/auth/login/`
   - `/api/customers/`
   - `/api/processes/`
   - `/api/deadlines/`
   - `/api/documents/`
   - `/api/finance/agreements/`
   - `/api/finance/payments/`

---

## **OP√á√ÉO B: Frontend React/Vue** (depois da API)

Criar interface do usu√°rio consumindo a API

### **Features principais:**
1. **Login/Logout**
2. **Dashboard** (m√©tricas, gr√°ficos)
3. **CRUD Customers**
4. **CRUD Processes** (com partes)
5. **Calendar Deadlines** (visualiza√ß√£o de prazos)
6. **Upload Documents**
7. **Finance Dashboard** (contratos, pagamentos)
8. **Portal do Cliente** (acesso limitado)

---

## üéØ MINHA RECOMENDA√á√ÉO

**Sequ√™ncia ideal:**
```
1. ‚úÖ MVP Backend (VOC√ä EST√Å AQUI)
   ‚Üì
2. üîÑ API REST (DRF) - 2-3 semanas
   ‚Üì
3. üé® Frontend React - 4-6 semanas
   ‚Üì
4. üöÄ Deploy & Testes

üìä O Que Temos vs O Que Falta
‚úÖ Voc√™ TEM (Backend completo):

    Multi-tenant funcionando
    Isolamento de dados
    Permiss√µes por role
    Auditoria
    Models jur√≠dicos completos
    Django Admin para voc√™ (platform admin)

‚ùå Voc√™ N√ÉO TEM (precisa criar):

    API REST
    Autentica√ß√£o JWT
    Frontend para clientes
    Dashboard com gr√°ficos
    Portal do cliente

üéØ PR√ìXIMA FASE: API REST

Quer que eu te guie na cria√ß√£o da API REST com Django REST Framework?
O que vamos fazer:

Fase 5: API REST

    Configurar DRF
    JWT Authentication
    Serializers (Customer, Process, Deadline, Document, Finance)
    ViewSets com permiss√µes
    Filtros e pagina√ß√£o
    Documenta√ß√£o autom√°tica (Swagger)

Progresso: Backend 100% ‚Üí API 0% ‚Üí Frontend 0%
üí° DECIS√ÉO

O que voc√™ prefere fazer agora?

A) Partir para API REST (recomendado - necess√°rio para frontend) B) Fazer algum ajuste/melhoria no backend antes C) Quero planejar o frontend primeiro D) Outra coisa

Me diz e eu come√ßo imediatamente! üöÄ

ent√£o vamos come√ßar com a parte da api rest, que √© o mais recomendado, depois a gente vai fazer os ajustes e melhorias no backend e por ultimo a interface. vamos focar na api rest ent√£o? temos que fazer tudo o que falou: configurar drf, jwt authentication, serializers, viewsets com permiss√µes, filtros e pagina√ß√£o e a documenta√ß√£o automatica.
18:59
üöÄ FASE 5: API REST - COME√áANDO!

Vamos fazer isso de forma organizada e profissional. Prepare-se para transformar seu backend em uma API completa!
üìã ROADMAP API REST

Fase 5: API REST
‚îú‚îÄ‚îÄ 1. Instala√ß√£o e Configura√ß√£o Base
‚îú‚îÄ‚îÄ 2. JWT Authentication
‚îú‚îÄ‚îÄ 3. Serializers (todos os models)
‚îú‚îÄ‚îÄ 4. ViewSets com Permiss√µes
‚îú‚îÄ‚îÄ 5. Filtros e Pagina√ß√£o
‚îî‚îÄ‚îÄ 6. Documenta√ß√£o (Swagger)

üîß PASSO 1: Instala√ß√£o e Configura√ß√£o
1.1 Instalar Pacotes
bash

pip install djangorestframework
pip install djangorestframework-simplejwt
pip install django-filter
pip install drf-spectacular  # Para documenta√ß√£o Swagger
pip install django-cors-headers  # Para frontend separado

1.2 Atualizar requirements.txt
bash

pip freeze > requirements.txt

1.3 Configurar INSTALLED_APPS
python

# config/settings/base.py

INSTALLED_APPS = [
    'jazzmin',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party
    'rest_framework',
    'rest_framework_simplejwt',
    'django_filters',
    'drf_spectacular',
    'corsheaders',  # ‚Üê Para permitir frontend em dom√≠nio diferente
    
    # Seus apps
    'apps.accounts',
    'apps.organizations',
    'apps.offices',
    'apps.memberships',
    'apps.customers',
    'apps.processes',
    'apps.deadlines',
    'apps.documents',
    'apps.finance',
    'apps.shared',
    'apps.landing',
]

1.4 Configurar Middleware CORS
python

# config/settings/base.py

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',  # ‚Üê ANTES do CommonMiddleware
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'apps.shared.middleware.OrganizationMiddleware',
]

1.5 Configura√ß√µes DRF
python

# config/settings/base.py

# ===== REST FRAMEWORK =====
REST_FRAMEWORK = {
    # Autentica√ß√£o
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
        'rest_framework.authentication.SessionAuthentication',  # Para browsable API
    ],
    
    # Permiss√µes padr√£o
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    
    # Pagina√ß√£o
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 25,
    
    # Filtros
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
        'rest_framework.filters.SearchFilter',
        'rest_framework.filters.OrderingFilter',
    ],
    
    # Renderizadores
    'DEFAULT_RENDERER_CLASSES': [
        'rest_framework.renderers.JSONRenderer',
        'rest_framework.renderers.BrowsableAPIRenderer',  # Interface web (dev)
    ],
    
    # Schema (para documenta√ß√£o)
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',
    
    # Tratamento de erros
    'EXCEPTION_HANDLER': 'rest_framework.views.exception_handler',
    
    # Formato de data/hora
    'DATETIME_FORMAT': '%Y-%m-%d %H:%M:%S',
    'DATE_FORMAT': '%Y-%m-%d',
}

# ===== JWT SETTINGS =====
from datetime import timedelta

SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(hours=5),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
    'UPDATE_LAST_LOGIN': True,
    
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    
    'AUTH_HEADER_TYPES': ('Bearer',),
    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',
    
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
    
    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),
    'TOKEN_TYPE_CLAIM': 'token_type',
}

# ===== CORS SETTINGS =====
# Para desenvolvimento
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",  # React
    "http://localhost:8080",  # Vue
    "http://127.0.0.1:3000",
    "http://127.0.0.1:8080",
]

# Para produ√ß√£o (voc√™ vai configurar depois)
# CORS_ALLOWED_ORIGINS = [
#     "https://seudominio.com",
# ]

CORS_ALLOW_CREDENTIALS = True

# ===== SPECTACULAR SETTINGS (Documenta√ß√£o) =====
SPECTACULAR_SETTINGS = {
    'TITLE': 'JuridicFlow API',
    'DESCRIPTION': 'API REST para sistema jur√≠dico multi-tenant',
    'VERSION': '1.0.0',
    'SERVE_INCLUDE_SCHEMA': False,
    
    'COMPONENT_SPLIT_REQUEST': True,
    'SCHEMA_PATH_PREFIX': '/api/',
    
    'SWAGGER_UI_SETTINGS': {
        'deepLinking': True,
        'persistAuthorization': True,
        'displayOperationId': True,
    },
}

üîê PASSO 2: JWT Authentication
2.1 Criar App API
bash

python manage.py startapp api
mv api apps/

2.2 Configurar apps/api
python

# apps/api/apps.py

from django.apps import AppConfig

class ApiConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.api'
    verbose_name = 'API REST'

Adicionar em INSTALLED_APPS:
python

# config/settings/base.py

INSTALLED_APPS = [
    # ...
    'apps.api',  # ‚Üê Adicionar
]

2.3 Criar Serializers de Auth
python

# apps/api/serializers/auth.py

from rest_framework import serializers
from apps.accounts.models import User
from apps.memberships.models import Membership

class UserSerializer(serializers.ModelSerializer):
    """
    Serializer b√°sico de usu√°rio.
    """
    full_name = serializers.SerializerMethodField()
    
    class Meta:
        model = User
        fields = [
            'id',
            'username',
            'email',
            'first_name',
            'last_name',
            'full_name',
            'is_active',
            'date_joined'
        ]
        read_only_fields = ['id', 'date_joined']
    
    def get_full_name(self, obj):
        return obj.get_full_name() or obj.email


class MembershipSerializer(serializers.ModelSerializer):
    """
    Serializer de membership (com organiza√ß√£o e office).
    """
    organization_name = serializers.CharField(source='organization.name', read_only=True)
    office_name = serializers.CharField(source='office.name', read_only=True)
    role_display = serializers.CharField(source='get_role_display', read_only=True)
    
    class Meta:
        model = Membership
        fields = [
            'id',
            'organization',
            'organization_name',
            'office',
            'office_name',
            'role',
            'role_display',
            'is_active'
        ]


class LoginSerializer(serializers.Serializer):
    """
    Serializer para login.
    """
    email = serializers.EmailField()
    password = serializers.CharField(write_only=True, style={'input_type': 'password'})


class LoginResponseSerializer(serializers.Serializer):
    """
    Serializer para resposta de login.
    """
    access = serializers.CharField()
    refresh = serializers.CharField()
    user = UserSerializer()
    memberships = MembershipSerializer(many=True)

2.4 Criar Views de Auth
python

# apps/api/views/auth.py

from rest_framework import status
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import AllowAny, IsAuthenticated
from rest_framework.response import Response
from rest_framework_simplejwt.tokens import RefreshToken
from django.contrib.auth import authenticate
from apps.accounts.models import User
from apps.api.serializers.auth import (
    LoginSerializer,
    LoginResponseSerializer,
    UserSerializer,
    MembershipSerializer
)

@api_view(['POST'])
@permission_classes([AllowAny])
def login_view(request):
    """
    Endpoint de login com JWT.
    
    Request:
        {
            "email": "user@example.com",
            "password": "senha123"
        }
    
    Response:
        {
            "access": "eyJ0eXAiOiJKV1QiLCJhbG...",
            "refresh": "eyJ0eXAiOiJKV1QiLCJhbG...",
            "user": {...},
            "memberships": [...]
        }
    """
    serializer = LoginSerializer(data=request.data)
    serializer.is_valid(raise_exception=True)
    
    email = serializer.validated_data['email']
    password = serializer.validated_data['password']
    
    # Busca usu√°rio por email
    try:
        user = User.objects.get(email=email)
    except User.DoesNotExist:
        return Response(
            {'detail': 'Credenciais inv√°lidas.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    # Autentica
    user = authenticate(username=user.username, password=password)
    
    if user is None:
        return Response(
            {'detail': 'Credenciais inv√°lidas.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    if not user.is_active:
        return Response(
            {'detail': 'Usu√°rio inativo.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    # Gera tokens JWT
    refresh = RefreshToken.for_user(user)
    
    # Busca memberships do usu√°rio
    memberships = user.memberships.filter(is_active=True).select_related(
        'organization', 'office'
    )
    
    # Monta resposta
    response_data = {
        'access': str(refresh.access_token),
        'refresh': str(refresh),
        'user': UserSerializer(user).data,
        'memberships': MembershipSerializer(memberships, many=True).data
    }
    
    return Response(response_data, status=status.HTTP_200_OK)


@api_view(['POST'])
@permission_classes([IsAuthenticated])
def logout_view(request):
    """
    Endpoint de logout (blacklist do refresh token).
    
    Request:
        {
            "refresh": "eyJ0eXAiOiJKV1QiLCJhbG..."
        }
    """
    try:
        refresh_token = request.data.get('refresh')
        if refresh_token:
            token = RefreshToken(refresh_token)
            token.blacklist()
        
        return Response(
            {'detail': 'Logout realizado com sucesso.'},
            status=status.HTTP_200_OK
        )
    except Exception as e:
        return Response(
            {'detail': 'Token inv√°lido.'},
            status=status.HTTP_400_BAD_REQUEST
        )


@api_view(['GET'])
@permission_classes([IsAuthenticated])
def me_view(request):
    """
    Retorna dados do usu√°rio autenticado.
    """
    memberships = request.user.memberships.filter(is_active=True).select_related(
        'organization', 'office'
    )
    
    return Response({
        'user': UserSerializer(request.user).data,
        'memberships': MembershipSerializer(memberships, many=True).data
    })


@api_view(['POST'])
@permission_classes([AllowAny])
def refresh_token_view(request):
    """
    Refresh do access token usando refresh token.
    
    Request:
        {
            "refresh": "eyJ0eXAiOiJKV1QiLCJhbG..."
        }
    
    Response:
        {
            "access": "eyJ0eXAiOiJKV1QiLCJhbG..."
        }
    """
    from rest_framework_simplejwt.views import TokenRefreshView
    return TokenRefreshView.as_view()(request._request)

2.5 URLs da API
python

# apps/api/urls.py

from django.urls import path, include
from rest_framework.routers import DefaultRouter
from apps.api.views.auth import (
    login_view,
    logout_view,
    me_view,
    refresh_token_view
)

app_name = 'api'

# Router para ViewSets (vamos adicionar depois)
router = DefaultRouter()

urlpatterns = [
    # Auth endpoints
    path('auth/login/', login_view, name='login'),
    path('auth/logout/', logout_view, name='logout'),
    path('auth/me/', me_view, name='me'),
    path('auth/refresh/', refresh_token_view, name='refresh'),
    
    # Router (ViewSets v√™m aqui depois)
    path('', include(router.urls)),
]

2.6 Incluir URLs da API no projeto
python

# config/urls.py

from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('apps.api.urls')),  # ‚Üê Adicionar
    path('', include('apps.landing.urls')),
]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

üß™ TESTAR AUTH
1. Rodar servidor
bash

python manage.py runserver

2. Testar com cURL ou Postman

Login:
bash

curl -X POST http://localhost:8000/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "email": "seu@email.com",
    "password": "sua_senha"
  }'

Resposta esperada:
json

{
  "access": "eyJ0eXAiOiJKV1Qi...",
  "refresh": "eyJ0eXAiOiJKV1Qi...",
  "user": {
    "id": 1,
    "email": "seu@email.com",
    ...
  },
  "memberships": [...]
}

Me (dados do usu√°rio):
bash

curl -X GET http://localhost:8000/api/auth/me/ \
  -H "Authorization: Bearer SEU_ACCESS_TOKEN"

‚úÖ Checklist Passo 1 e 2

    DRF instalado
    JWT configurado
    CORS configurado
    App api criado
    Serializers de auth criados
    Views de login/logout criadas
    URLs configuradas
    Testado login via API
    Token JWT funcionando

üéØ PR√ìXIMO PASSO

Quando Auth estiver funcionando, partimos para:

PASSO 3: Serializers dos Models (Customer, Process, Deadline, Document, Finance)

Me avisa quando tiver testado o login e estiver funcionando! üöÄ

Alguma d√∫vida sobre Auth/JWT?
Voc√™ est√° sem mensagens gratuitas at√© 23:00
Fazer Upgrade


Claude √© uma IA e pode cometer erros. Por favor, verifique as respostas.

Estrutura e arquitetura de projeto Django escal√°vel - Claude


Ol√°! Vou analisar o problema de autentica√ß√£o que voc√™ est√° enfrentando.

## üîç Diagn√≥stico do Problema

O problema est√° na view de login. O Django's `authenticate()` precisa do **username**, n√£o do email, para funcionar corretamente. Veja a linha problem√°tica:

```python
# apps/api/views/auth.py (linha com problema)
user = authenticate(username=user.username, password=password)
```

Aqui voc√™ est√° tentando autenticar com o `username`, mas o campo `USERNAME_FIELD` do seu model User est√° configurado para `email`.

## ‚úÖ Solu√ß√£o

Substitua o conte√∫do do arquivo `apps/api/views/auth.py`:

```python
# apps/api/views/auth.py

from rest_framework import status
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import AllowAny, IsAuthenticated
from rest_framework.response import Response
from rest_framework_simplejwt.tokens import RefreshToken
from django.contrib.auth import authenticate
from apps.accounts.models import User
from apps.api.serializers.auth import (
    LoginSerializer,
    LoginResponseSerializer,
    UserSerializer,
    MembershipSerializer
)

@api_view(['POST'])
@permission_classes([AllowAny])
def login_view(request):
    """
    Endpoint de login com JWT.
    """
    serializer = LoginSerializer(data=request.data)
    serializer.is_valid(raise_exception=True)
    
    email = serializer.validated_data['email']
    password = serializer.validated_data['password']
    
    # Busca usu√°rio por email
    try:
        user = User.objects.get(email=email)
    except User.DoesNotExist:
        return Response(
            {'detail': 'Credenciais inv√°lidas.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    # ‚≠ê CORRE√á√ÉO: Autentica com USERNAME ao inv√©s de email
    # Como seu User usa email como USERNAME_FIELD, passa o email diretamente
    user_authenticated = authenticate(request, username=email, password=password)
    
    if user_authenticated is None:
        return Response(
            {'detail': 'Credenciais inv√°lidas.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    if not user_authenticated.is_active:
        return Response(
            {'detail': 'Usu√°rio inativo.'},
            status=status.HTTP_401_UNAUTHORIZED
        )
    
    # Gera tokens JWT
    refresh = RefreshToken.for_user(user_authenticated)
    
    # Busca memberships do usu√°rio
    memberships = user_authenticated.memberships.filter(is_active=True).select_related(
        'organization', 'office'
    )
    
    # Monta resposta
    response_data = {
        'access': str(refresh.access_token),
        'refresh': str(refresh),
        'user': UserSerializer(user_authenticated).data,
        'memberships': MembershipSerializer(memberships, many=True).data
    }
    
    return Response(response_data, status=status.HTTP_200_OK)


@api_view(['POST'])
@permission_classes([IsAuthenticated])
def logout_view(request):
    """
    Endpoint de logout (blacklist do refresh token).
    """
    try:
        refresh_token = request.data.get('refresh')
        if refresh_token:
            token = RefreshToken(refresh_token)
            token.blacklist()
        
        return Response(
            {'detail': 'Logout realizado com sucesso.'},
            status=status.HTTP_200_OK
        )
    except Exception as e:
        return Response(
            {'detail': 'Token inv√°lido.'},
            status=status.HTTP_400_BAD_REQUEST
        )


@api_view(['GET'])
@permission_classes([IsAuthenticated])
def me_view(request):
    """
    Retorna dados do usu√°rio autenticado.
    """
    memberships = request.user.memberships.filter(is_active=True).select_related(
        'organization', 'office'
    )
    
    return Response({
        'user': UserSerializer(request.user).data,
        'memberships': MembershipSerializer(memberships, many=True).data
    })


@api_view(['POST'])
@permission_classes([AllowAny])
def refresh_token_view(request):
    """
    Refresh do access token usando refresh token.
    """
    from rest_framework_simplejwt.views import TokenRefreshView
    return TokenRefreshView.as_view()(request._request)
```

## üß™ Testando

Agora teste novamente:

```bash
# Via cURL
curl -X POST http://localhost:8000/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "email": "seu@email.com",
    "password": "sua_senha"
  }'
```

Ou use Postman/Insomnia:
- **URL**: `http://localhost:8000/api/auth/login/`
- **M√©todo**: POST
- **Body (JSON)**:
```json
{
  "email": "seu@email.com",
  "password": "sua_senha"
}
```

## ‚úÖ Resposta Esperada

```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbG...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbG...",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "seu@email.com",
    "first_name": "",
    "last_name": "",
    "full_name": "seu@email.com",
    "is_active": true,
    "date_joined": "2025-01-14T10:30:00"
  },
  "memberships": []
}
```

## üìù Por Que Aconteceu?

O problema ocorreu porque:

1. Seu User model usa `email` como `USERNAME_FIELD`
2. A fun√ß√£o `authenticate()` do Django espera o campo definido em `USERNAME_FIELD`
3. O c√≥digo original tentava pegar `user.username` e passar para `authenticate()`, mas deveria passar diretamente o `email`

A corre√ß√£o passa o `email` diretamente para `authenticate(username=email, ...)`, que funciona porque o Django internamente usa o `USERNAME_FIELD` configurado no model.

---

**Teste agora e me avise se funcionou!** üöÄ

Se o login funcionar, podemos continuar com os pr√≥ximos passos da API (Serializers dos models). 

Alguma d√∫vida sobre a corre√ß√£o?

Conte√∫do n√£o acess√≠vel

GITHUB

vamos continuar? a proxima fase vai ser a interface da aplica√ß√£o que sera usada pelos usuarios e pelos org/offices admins, alem de tirar o que n√£o sera usado na pagina de administra√ß√£o do sistema que usa o django admin.
16 de jan.

üéØ Entendi perfeitamente! Vamos come√ßar a Fase 6: Frontend da Aplica√ß√£o

Mas antes, preciso confirmar uma coisa importante sobre a arquitetura do projeto:
üìã Escolha da Arquitetura Frontend

Voc√™ tem 2 op√ß√µes principais:
Op√ß√£o A: SPA (Single Page Application) - React/Vue ‚≠ê RECOMENDADO

    Frontend separado (React ou Vue) que consome a API REST
    Vantagens:
        ‚úÖ Interface moderna e responsiva
        ‚úÖ Melhor UX (sem reload de p√°gina)
        ‚úÖ Pode ser hospedado separadamente
        ‚úÖ Mais escal√°vel
        ‚úÖ Reutiliza toda a API que acabamos de criar

Op√ß√£o B: Templates Django + HTMX

    Frontend integrado no Django usando templates
    Vantagens:
        ‚úÖ Mais simples de come√ßar
        ‚úÖ Tudo em um s√≥ projeto
        ‚úÖ Menos complexidade de deploy
        ‚ùå UX menos moderna
        ‚ùå Menos escal√°vel

üéØ Minha Recomenda√ß√£o: React

Dado que:

    ‚úÖ Voc√™ j√° tem a API REST completa
    ‚úÖ Quer uma interface moderna e profissional
    ‚úÖ O sistema tem complexidade m√©dia-alta (multi-tenant, v√°rios CRUDs, dashboards)

Sugiro criar um frontend em React com:

    Vite (setup r√°pido, build otimizado)
    React Router (navega√ß√£o)
    TanStack Query (gerenciamento de API)
    Tailwind CSS (estiliza√ß√£o)
    Shadcn/ui (componentes prontos e bonitos)

üìù Roadmap Frontend (Se escolher React)
Fase 6: Frontend React

‚îú‚îÄ‚îÄ 1Ô∏è‚É£ Setup Inicial
‚îÇ   ‚îú‚îÄ‚îÄ Criar projeto Vite + React
‚îÇ   ‚îú‚îÄ‚îÄ Configurar Tailwind + Shadcn/ui
‚îÇ   ‚îú‚îÄ‚îÄ Estrutura de pastas
‚îÇ   ‚îî‚îÄ‚îÄ Axios/Fetch para API
‚îÇ
‚îú‚îÄ‚îÄ 2Ô∏è‚É£ Autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ P√°gina de Login
‚îÇ   ‚îú‚îÄ‚îÄ Gerenciamento de JWT
‚îÇ   ‚îú‚îÄ‚îÄ Prote√ß√£o de rotas
‚îÇ   ‚îî‚îÄ‚îÄ Context de autentica√ß√£o
‚îÇ
‚îú‚îÄ‚îÄ 3Ô∏è‚É£ Layout Principal
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar com navega√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Header com user menu
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard home
‚îÇ   ‚îî‚îÄ‚îÄ Breadcrumbs
‚îÇ
‚îú‚îÄ‚îÄ 4Ô∏è‚É£ M√≥dulos CRUD
‚îÇ   ‚îú‚îÄ‚îÄ Customers (lista + form)
‚îÇ   ‚îú‚îÄ‚îÄ Processes (lista + form + partes)
‚îÇ   ‚îú‚îÄ‚îÄ Deadlines (lista + form + calendar view)
‚îÇ   ‚îú‚îÄ‚îÄ Documents (lista + upload)
‚îÇ   ‚îî‚îÄ‚îÄ Finance (contratos + pagamentos)
‚îÇ
‚îú‚îÄ‚îÄ 5Ô∏è‚É£ Features Avan√ßadas
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard com gr√°ficos
‚îÇ   ‚îú‚îÄ‚îÄ Filtros e busca
‚îÇ   ‚îú‚îÄ‚îÄ Pagina√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Notifica√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ Upload de arquivos
‚îÇ
‚îî‚îÄ‚îÄ 6Ô∏è‚É£ Admin da Organiza√ß√£o
    ‚îú‚îÄ‚îÄ Gerenciar offices
    ‚îú‚îÄ‚îÄ Convidar usu√°rios
    ‚îú‚îÄ‚îÄ Atribuir roles
    ‚îî‚îÄ‚îÄ Configura√ß√µes

‚ùì Decis√£o: O que voc√™ prefere?

Escolha 1 op√ß√£o:
A) React (RECOMENDADO) üöÄ

    Vou te guiar no setup completo
    Interface moderna e profissional
    Reutiliza 100% da API

B) Templates Django + HTMX

    Mais simples, tudo integrado
    Interface funcional mas menos moderna

C) Vue.js (alternativa ao React)

    Similar ao React, mas sintaxe diferente

üéØ Responda:

    Qual tecnologia voc√™ quer usar? (A, B ou C)
    Tem experi√™ncia com React/Vue? (para eu ajustar a explica√ß√£o)
    Quer come√ßar direto com o setup? (ou prefere mais detalhes primeiro)

Me responda e vamos partir para o pr√≥ximo passo! üöÄ

PS: Enquanto isso, vou j√° preparar:

    ‚úÖ Lista de models do Django Admin que v√£o ser removidos (Customers, Processes, etc)
    ‚úÖ Lista de models que v√£o ficar (Organizations, Users, Memberships)

Aguardo sua resposta! üí™
bpadvogadosassociados/juridicflow_project

main

GITHUB

quero usar a A, react.
16 de jan.
üéâ PERFEITO! Vamos come√ßar com React!

Voc√™ fez a escolha certa. React + API REST que voc√™ j√° tem = sistema profissional e escal√°vel.
üìã ANTES DE COME√áAR: Preparar o Backend
1Ô∏è‚É£ Remover Models Jur√≠dicos do Django Admin

Como discutimos, esses models n√£o devem aparecer no Django Admin (s√≥ para voc√™ - platform admin):
python

# config/settings.py (atualizar JAZZMIN_SETTINGS)

JAZZMIN_SETTINGS = {
    # ... (configura√ß√£o existente)
    
    # ===== SEGURAN√áA - OCULTAR MODELS JUR√çDICOS =====
    "hide_models": [
        "customers.Customer",
        "processes.Process",
        "processes.ProcessParty",
        "deadlines.Deadline",
        "documents.Document",
        "finance.FeeAgreement",
        "finance.Payment",
    ],
    
    # ... (resto da configura√ß√£o)
}
```

**Por qu√™?**
- ‚úÖ Voc√™ (platform admin) gerencia **infraestrutura**: Organizations, Users, Memberships
- ‚ùå Voc√™ **N√ÉO deve ver** dados jur√≠dicos dos clientes (LGPD, privacidade)
- ‚úÖ Clientes ver√£o esses dados no **painel React** que vamos criar

---

## üöÄ **FASE 6: FRONTEND REACT - ROADMAP COMPLETO**
```
üì¶ Fase 6: Frontend React
‚îÇ
‚îú‚îÄ‚îÄ 1Ô∏è‚É£ Setup Inicial (AGORA)
‚îÇ   ‚îú‚îÄ‚îÄ Criar projeto Vite + React
‚îÇ   ‚îú‚îÄ‚îÄ Instalar depend√™ncias
‚îÇ   ‚îú‚îÄ‚îÄ Estrutura de pastas
‚îÇ   ‚îî‚îÄ‚îÄ Configurar Axios
‚îÇ
‚îú‚îÄ‚îÄ 2Ô∏è‚É£ Autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Tela de Login
‚îÇ   ‚îú‚îÄ‚îÄ Context de Auth
‚îÇ   ‚îú‚îÄ‚îÄ Gerenciamento de JWT
‚îÇ   ‚îî‚îÄ‚îÄ Prote√ß√£o de rotas
‚îÇ
‚îú‚îÄ‚îÄ 3Ô∏è‚É£ Layout Principal
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar
‚îÇ   ‚îú‚îÄ‚îÄ Header com user menu
‚îÇ   ‚îú‚îÄ‚îÄ Breadcrumbs
‚îÇ   ‚îî‚îÄ‚îÄ Dashboard home
‚îÇ
‚îú‚îÄ‚îÄ 4Ô∏è‚É£ M√≥dulos CRUD
‚îÇ   ‚îú‚îÄ‚îÄ Customers
‚îÇ   ‚îú‚îÄ‚îÄ Processes
‚îÇ   ‚îú‚îÄ‚îÄ Deadlines
‚îÇ   ‚îú‚îÄ‚îÄ Documents
‚îÇ   ‚îî‚îÄ‚îÄ Finance
‚îÇ
‚îú‚îÄ‚îÄ 5Ô∏è‚É£ Features Avan√ßadas
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard com gr√°ficos
‚îÇ   ‚îú‚îÄ‚îÄ Filtros e busca
‚îÇ   ‚îú‚îÄ‚îÄ Upload de arquivos
‚îÇ   ‚îî‚îÄ‚îÄ Notifica√ß√µes
‚îÇ
‚îî‚îÄ‚îÄ 6Ô∏è‚É£ Admin da Organiza√ß√£o
    ‚îú‚îÄ‚îÄ Gerenciar offices
    ‚îú‚îÄ‚îÄ Convidar usu√°rios
    ‚îî‚îÄ‚îÄ Atribuir roles

üõ†Ô∏è PASSO 1: SETUP INICIAL DO REACT
1.1 Criar Projeto Vite

No terminal (fora da pasta backend):
bash

# Criar projeto React com Vite
npm create vite@latest frontend -- --template react

# Entrar na pasta
cd frontend

# Instalar depend√™ncias base
npm install

1.2 Instalar Depend√™ncias Principais
bash

# Biblioteca HTTP
npm install axios

# Roteamento
npm install react-router-dom

# Gerenciamento de estado da API
npm install @tanstack/react-query

# Estiliza√ß√£o
npm install tailwindcss postcss autoprefixer
npx tailwindcss init -p

# Componentes UI (Shadcn/ui)
npm install class-variance-authority clsx tailwind-merge
npm install lucide-react

# Formul√°rios
npm install react-hook-form @hookform/resolvers zod

# Utilit√°rios
npm install date-fns

1.3 Configurar Tailwind CSS
javascript

// tailwind.config.js
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#1e40af',
          dark: '#1e3a8a',
        },
        secondary: '#0891b2',
      },
    },
  },
  plugins: [],
}

css

/* src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-gray-50 text-gray-900;
  }
}
```

### **1.4 Estrutura de Pastas**
```
frontend/
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # Configura√ß√£o Axios + endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ axios.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/          # Componentes base (bot√µes, cards, etc)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/      # Layout (Sidebar, Header, etc)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/      # Componentes compartilhados
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ contexts/        # Contexts (Auth, Theme, etc)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.jsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/           # Custom hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useApi.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # P√°ginas/rotas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Login.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Dashboard.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomerList.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomerForm.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CustomerDetail.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deadlines/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Configura√ß√£o de rotas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppRoutes.jsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProtectedRoute.jsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # Utilit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx
‚îÇ   ‚îú‚îÄ‚îÄ main.jsx
‚îÇ   ‚îî‚îÄ‚îÄ index.css
‚îÇ
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ vite.config.js
‚îî‚îÄ‚îÄ tailwind.config.js

üìù PASSO 2: CONFIGURAR AXIOS + API
2.1 Arquivo de configura√ß√£o do Axios
javascript

// src/api/axios.js

import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para adicionar token em todas as requisi√ß√µes
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Interceptor para refresh token autom√°tico
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    // Se erro 401 e n√£o √© retry
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        const refreshToken = localStorage.getItem('refresh_token');
        const response = await axios.post(`${API_URL}/auth/refresh/`, {
          refresh: refreshToken,
        });

        const { access } = response.data;
        localStorage.setItem('access_token', access);

        // Retry request original
        originalRequest.headers.Authorization = `Bearer ${access}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Se refresh falhar, deslogar
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);

export default api;

2.2 Vari√°veis de Ambiente
bash

# .env
VITE_API_URL=http://localhost:8000/api

üîê PASSO 3: AUTENTICA√á√ÉO
3.1 API de Autentica√ß√£o
javascript

// src/api/auth.js

import api from './axios';

export const authAPI = {
  // Login
  login: async (email, password) => {
    const response = await api.post('/auth/login/', { email, password });
    return response.data;
  },

  // Logout
  logout: async (refreshToken) => {
    const response = await api.post('/auth/logout/', { refresh: refreshToken });
    return response.data;
  },

  // Dados do usu√°rio autenticado
  me: async () => {
    const response = await api.get('/auth/me/');
    return response.data;
  },

  // Refresh token
  refresh: async (refreshToken) => {
    const response = await api.post('/auth/refresh/', { refresh: refreshToken });
    return response.data;
  },
};

3.2 Context de Autentica√ß√£o
jsx

// src/contexts/AuthContext.jsx

import { createContext, useState, useEffect } from 'react';
import { authAPI } from '../api/auth';

export const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [memberships, setMemberships] = useState([]);
  const [loading, setLoading] = useState(true);

  // Carregar usu√°rio ao iniciar
  useEffect(() => {
    loadUser();
  }, []);

  const loadUser = async () => {
    const token = localStorage.getItem('access_token');
    if (!token) {
      setLoading(false);
      return;
    }

    try {
      const data = await authAPI.me();
      setUser(data.user);
      setMemberships(data.memberships);
    } catch (error) {
      console.error('Erro ao carregar usu√°rio:', error);
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
    } finally {
      setLoading(false);
    }
  };

  const login = async (email, password) => {
    try {
      const data = await authAPI.login(email, password);
      
      // Salvar tokens
      localStorage.setItem('access_token', data.access);
      localStorage.setItem('refresh_token', data.refresh);
      
      // Salvar usu√°rio
      setUser(data.user);
      setMemberships(data.memberships);
      
      return { success: true };
    } catch (error) {
      return {
        success: false,
        error: error.response?.data?.detail || 'Erro ao fazer login',
      };
    }
  };

  const logout = async () => {
    try {
      const refreshToken = localStorage.getItem('refresh_token');
      if (refreshToken) {
        await authAPI.logout(refreshToken);
      }
    } catch (error) {
      console.error('Erro ao fazer logout:', error);
    } finally {
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
      setUser(null);
      setMemberships([]);
    }
  };

  const value = {
    user,
    memberships,
    loading,
    login,
    logout,
    isAuthenticated: !!user,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};

3.3 Hook useAuth
javascript

// src/hooks/useAuth.js

import { useContext } from 'react';
import { AuthContext } from '../contexts/AuthContext';

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth deve ser usado dentro de AuthProvider');
  }
  return context;
};

üéØ PR√ìXIMO PASSO

Agora que voc√™ tem o setup completo explicado, vou te passar:

    Tela de Login completa
    Sistema de rotas com prote√ß√£o
    Layout principal (Sidebar + Header)

Me responda:

    ‚úÖ Entendeu a estrutura?
    ‚úÖ Quer que eu passe o c√≥digo da tela de login agora?
    ‚úÖ Tem alguma d√∫vida sobre o setup?

Quando voc√™ confirmar, eu passo TODO o c√≥digo do login + rotas + layout para voc√™ copiar e colar! üöÄ

vamos continuar?
11:12
üöÄ CONTINUANDO - Tela de Login + Rotas + Layout

Vamos implementar agora a autentica√ß√£o completa + layout principal!
üîê PASSO 4: TELA DE LOGIN
4.1 P√°gina de Login
jsx

// src/pages/auth/Login.jsx

import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../../hooks/useAuth';

const Login = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  
  const { login } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    const result = await login(email, password);

    if (result.success) {
      navigate('/dashboard');
    } else {
      setError(result.error);
    }

    setLoading(false);
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-900 to-cyan-600 px-4">
      <div className="max-w-md w-full">
        {/* Logo */}
        <div className="text-center mb-8">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-white rounded-full mb-4">
            <svg className="w-8 h-8 text-blue-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
          </div>
          <h1 className="text-3xl font-bold text-white mb-2">JuridicFlow</h1>
          <p className="text-blue-100">Sistema de Gest√£o Jur√≠dica</p>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-2xl shadow-2xl p-8">
          <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">
            Acessar Sistema
          </h2>

          {/* Error Alert */}
          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
              <div className="flex items-center">
                <svg className="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p className="text-sm text-red-800">{error}</p>
              </div>
            </div>
          )}

          {/* Form */}
          <form onSubmit={handleSubmit} className="space-y-6">
            {/* Email */}
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">
                Email
              </label>
              <input
                id="email"
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="seu@email.com"
                disabled={loading}
              />
            </div>

            {/* Password */}
            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">
                Senha
              </label>
              <input
                id="password"
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                disabled={loading}
              />
            </div>

            {/* Submit Button */}
            <button
              type="submit"
              disabled={loading}
              className="w-full bg-blue-900 text-white py-3 rounded-lg font-semibold hover:bg-blue-800 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
              {loading ? (
                <>
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Entrando...
                </>
              ) : (
                'Entrar'
              )}
            </button>
          </form>
        </div>

        {/* Footer */}
        <p className="text-center text-blue-100 text-sm mt-6">
          ¬© 2025 JuridicFlow. Todos os direitos reservados.
        </p>
      </div>
    </div>
  );
};

export default Login;

üõ£Ô∏è PASSO 5: SISTEMA DE ROTAS
5.1 Rota Protegida
jsx

// src/routes/ProtectedRoute.jsx

import { Navigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';

const ProtectedRoute = ({ children }) => {
  const { isAuthenticated, loading } = useAuth();

  // Aguardar carregar usu√°rio
  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mx-auto"></div>
          <p className="mt-4 text-gray-600">Carregando...</p>
        </div>
      </div>
    );
  }

  // Se n√£o autenticado, redirecionar para login
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }

  return children;
};

export default ProtectedRoute;

5.2 Configura√ß√£o de Rotas
jsx

// src/routes/AppRoutes.jsx

import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';

// P√°ginas
import Login from '../pages/auth/Login';
import Dashboard from '../pages/dashboard/Dashboard';
import CustomerList from '../pages/customers/CustomerList';
import CustomerForm from '../pages/customers/CustomerForm';
import CustomerDetail from '../pages/customers/CustomerDetail';
import ProcessList from '../pages/processes/ProcessList';
import DeadlineList from '../pages/deadlines/DeadlineList';
import DocumentList from '../pages/documents/DocumentList';
import FinanceList from '../pages/finance/FinanceList';

// Layout
import Layout from '../components/layout/Layout';
import ProtectedRoute from './ProtectedRoute';

const AppRoutes = () => {
  const { isAuthenticated } = useAuth();

  return (
    <BrowserRouter>
      <Routes>
        {/* Rota p√∫blica - Login */}
        <Route 
          path="/login" 
          element={
            isAuthenticated ? <Navigate to="/dashboard" replace /> : <Login />
          } 
        />

        {/* Rotas protegidas */}
        <Route
          path="/*"
          element={
            <ProtectedRoute>
              <Layout>
                <Routes>
                  {/* Dashboard */}
                  <Route path="/dashboard" element={<Dashboard />} />

                  {/* Customers */}
                  <Route path="/customers" element={<CustomerList />} />
                  <Route path="/customers/new" element={<CustomerForm />} />
                  <Route path="/customers/:id" element={<CustomerDetail />} />
                  <Route path="/customers/:id/edit" element={<CustomerForm />} />

                  {/* Processes */}
                  <Route path="/processes" element={<ProcessList />} />

                  {/* Deadlines */}
                  <Route path="/deadlines" element={<DeadlineList />} />

                  {/* Documents */}
                  <Route path="/documents" element={<DocumentList />} />

                  {/* Finance */}
                  <Route path="/finance" element={<FinanceList />} />

                  {/* Redirect root to dashboard */}
                  <Route path="/" element={<Navigate to="/dashboard" replace />} />
                  
                  {/* 404 */}
                  <Route path="*" element={<Navigate to="/dashboard" replace />} />
                </Routes>
              </Layout>
            </ProtectedRoute>
          }
        />
      </Routes>
    </BrowserRouter>
  );
};

export default AppRoutes;

üé® PASSO 6: LAYOUT PRINCIPAL
6.1 Layout Wrapper
jsx

// src/components/layout/Layout.jsx

import { useState } from 'react';
import Sidebar from './Sidebar';
import Header from './Header';

const Layout = ({ children }) => {
  const [sidebarOpen, setSidebarOpen] = useState(true);

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Sidebar */}
      <Sidebar isOpen={sidebarOpen} setIsOpen={setSidebarOpen} />

      {/* Main Content */}
      <div className={`transition-all duration-300 ${sidebarOpen ? 'ml-64' : 'ml-20'}`}>
        {/* Header */}
        <Header sidebarOpen={sidebarOpen} setSidebarOpen={setSidebarOpen} />

        {/* Page Content */}
        <main className="p-6">
          {children}
        </main>
      </div>
    </div>
  );
};

export default Layout;

6.2 Header
jsx

// src/components/layout/Header.jsx

import { useAuth } from '../../hooks/useAuth';
import { useNavigate } from 'react-router-dom';
import { useState, useRef, useEffect } from 'react';

const Header = ({ sidebarOpen, setSidebarOpen }) => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [dropdownOpen, setDropdownOpen] = useState(false);
  const dropdownRef = useRef(null);

  // Fechar dropdown ao clicar fora
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setDropdownOpen(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  const handleLogout = async () => {
    await logout();
    navigate('/login');
  };

  return (
    <header className="bg-white border-b border-gray-200 sticky top-0 z-10">
      <div className="px-6 py-4 flex items-center justify-between">
        {/* Left - Toggle Sidebar */}
        <button
          onClick={() => setSidebarOpen(!sidebarOpen)}
          className="p-2 rounded-lg hover:bg-gray-100 transition"
        >
          <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>

        {/* Right - User Menu */}
        <div className="flex items-center gap-4">
          {/* Notifications (placeholder) */}
          <button className="p-2 rounded-lg hover:bg-gray-100 transition relative">
            <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            {/* Badge de notifica√ß√µes */}
            <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
          </button>

          {/* User Dropdown */}
          <div className="relative" ref={dropdownRef}>
            <button
              onClick={() => setDropdownOpen(!dropdownOpen)}
              className="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 transition"
            >
              {/* Avatar */}
              <div className="w-8 h-8 bg-blue-900 rounded-full flex items-center justify-center text-white font-semibold">
                {user?.first_name?.[0] || user?.email?.[0]?.toUpperCase() || 'U'}
              </div>
              
              {/* User Info */}
              <div className="text-left hidden sm:block">
                <p className="text-sm font-semibold text-gray-700">
                  {user?.first_name || user?.email}
                </p>
                <p className="text-xs text-gray-500">{user?.email}</p>
              </div>

              {/* Arrow */}
              <svg 
                className={`w-4 h-4 text-gray-600 transition-transform ${dropdownOpen ? 'rotate-180' : ''}`} 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </button>

            {/* Dropdown Menu */}
            {dropdownOpen && (
              <div className="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2">
                <div className="px-4 py-3 border-b border-gray-100">
                  <p className="text-sm font-semibold text-gray-900">{user?.first_name || 'Usu√°rio'}</p>
                  <p className="text-xs text-gray-500 truncate">{user?.email}</p>
                </div>

                <button
                  onClick={() => {
                    setDropdownOpen(false);
                    // Navigate to profile (quando criar)
                  }}
                  className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  Meu Perfil
                </button>

                <button
                  onClick={() => {
                    setDropdownOpen(false);
                    // Navigate to settings (quando criar)
                  }}
                  className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Configura√ß√µes
                </button>

                <div className="border-t border-gray-100 my-2"></div>

                <button
                  onClick={handleLogout}
                  className="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  Sair
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    </header>
  );
};

export default Header;

6.3 Sidebar
jsx

// src/components/layout/Sidebar.jsx

import { NavLink } from 'react-router-dom';

const Sidebar = ({ isOpen, setIsOpen }) => {
  const menuItems = [
    {
      name: 'Dashboard',
      path: '/dashboard',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      ),
    },
    {
      name: 'Clientes',
      path: '/customers',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
      ),
    },
    {
      name: 'Processos',
      path: '/processes',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      ),
    },
    {
      name: 'Prazos',
      path: '/deadlines',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      ),
    },
    {
      name: 'Documentos',
      path: '/documents',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
        </svg>
      ),
    },
    {
      name: 'Financeiro',
      path: '/finance',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      ),
    },
  ];

  return (
    <aside
      className={`fixed left-0 top-0 h-full bg-blue-900 text-white transition-all duration-300 z-20 ${
        isOpen ? 'w-64' : 'w-20'
      }`}
    >
      {/* Logo */}
      <div className="h-16 flex items-center justify-center border-b border-blue-800">
        {isOpen ? (
          <div className="flex items-center gap-2">
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
            <span className="font-bold text-lg">JuridicFlow</span>
          </div>
        ) : (
          <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
          </svg>
        )}
      </div>

      {/* Navigation */}
      <nav className="mt-6 px-3">
        {menuItems.map((item) => (
          <NavLink
            key={item.path}
            to={item.path}
            className={({ isActive }) =>
              `flex items-center gap-3 px-3 py-3 rounded-lg mb-2 transition ${
                isActive
                  ? 'bg-blue-800 text-white'
                  : 'text-blue-100 hover:bg-blue-800 hover:text-white'
              }`
            }
            title={!isOpen ? item.name : ''}
          >
            {item.icon}
            {isOpen && <span className="font-medium">{item.name}</span>}
          </NavLink>
        ))}
      </nav>
    </aside>
  );
};

export default Sidebar;

üéØ PASSO 7: P√ÅGINAS PLACEHOLDER

Vamos criar p√°ginas b√°sicas tempor√°rias para testar o layout:
jsx

// src/pages/dashboard/Dashboard.jsx

const Dashboard = () => {
  return (
    <div>
      <h1 className="text-2xl font-bold text-gray-900 mb-6">Dashboard</h1>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {/* Cards de estat√≠sticas - placeholder */}
        {[
          { title: 'Clientes', value: '0', color: 'blue' },
          { title: 'Processos', value: '0', color: 'green' },
          { title: 'Prazos Hoje', value: '0', color: 'yellow' },
          { title: 'Documentos', value: '0', color: 'purple' },
        ].map((stat) => (
          <div key={stat.title} className="bg-white rounded-lg shadow p-6">
            <h3 className="text-gray-600 text-sm font-medium mb-2">{stat.title}</h3>
            <p className="text-3xl font-bold text-gray-900">{stat.value}</p>
          </div>
        ))}
      </div>
    </div>
  );
};

export default Dashboard;

jsx

// src/pages/customers/CustomerList.jsx

const CustomerList = () => {
  return (
    <div>
      <h1 className="text-2xl font-bold text-gray-900 mb-6">Clientes</h1>
      <div className="bg-white rounded-lg shadow p-6">
        <p className="text-gray-600">Lista de clientes vir√° aqui...</p>
      </div>
    </div>
  );
};

export default CustomerList;

Crie placeholders similares para:

    src/pages/customers/CustomerForm.jsx
    src/pages/customers/CustomerDetail.jsx
    src/pages/processes/ProcessList.jsx
    src/pages/deadlines/DeadlineList.jsx
    src/pages/documents/DocumentList.jsx
    src/pages/finance/FinanceList.jsx

üîß PASSO 8: APP.JSX E MAIN.JSX
jsx

// src/App.jsx

import { AuthProvider } from './contexts/AuthContext';
import AppRoutes from './routes/AppRoutes';

function App() {
  return (
    <AuthProvider>
      <AppRoutes />
    </AuthProvider>
  );
}

export default App;

jsx

// src/main.jsx

import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import './index.css';
import App from './App.jsx';

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />

Parte do seu conte√∫do n√£o p√¥de ser carregado.

Continuar
Claude √© uma IA e pode cometer erros. Por favor, verifique as respostas.

Interface da aplica√ß√£o e painel administrativo - Claude

