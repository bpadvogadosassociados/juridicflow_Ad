window.MarkedLite = {
  render: function(md){
    if(!md) return "";
    let html = md.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    // bold
    html = html.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
    // checkboxes
    html = html.replace(/^\s*-\s*\[ \]\s*(.+)$/gm, '<li class="md-checkbox"><input type="checkbox" disabled> $1</li>');
    html = html.replace(/^\s*-\s*\[x\]\s*(.+)$/gmi, '<li class="md-checkbox"><input type="checkbox" disabled checked> $1</li>');
    // unordered list
    // wrap simple "- item" lines into <ul>
    const lines = html.split("\n");
    let out = [];
    let inUl = false;
    for (let ln of lines){
      const m = ln.match(/^\s*-\s+(.+)$/);
      const isCb = ln.includes('class="md-checkbox"');
      if (m || isCb){
        if(!inUl){ out.push("<ul>"); inUl = true; }
        if(isCb){
          out.push(ln);
        } else {
          out.push("<li>"+m[1]+"</li>");
        }
      } else {
        if(inUl){ out.push("</ul>"); inUl = false; }
        out.push(ln);
      }
    }
    if(inUl) out.push("</ul>");
    html = out.join("\n");
    // newlines -> <br>
    html = html.replace(/\n/g, "<br>");
    return html;
  }
};
